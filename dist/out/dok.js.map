{"version":3,"sources":["../../out/dok.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","define","fixPath","regex","exec","location","pathname","window","history","pushState","search","hash","changeScene","scene","htmlFile","Utils","destroyEverything","replace","handleError","error","soft","Array","isArray","array","i","length","push","console","apply","lastError","Error","combineMethods","firstMethod","secondMethod","expectParams","args","assert","arguments","type","split","indexOf","checkParams","condition","message","cleanUp","setupExit","document","onbeforeunload","onDestroy","callback","definePrototypes","String","trim","requestAnimationFrame","setupRequestAnimationFrame","Float32Array","fill","fill_compat","Uint32Array","Uint16Array","value","start","end","splatter","offset","getFrame","index","Number","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","requestAnimationFrame_compat","timeout","time","setTimeout","timeoutCallback","clearTimeout","dt","Date","now","loadAsyncHelper","src","result","binary","method","data","loadAsync","undefined","xhr","XMLHttpRequest","overrideMimeType","open","addEventListener","readyState","status","responseText","e","send","Roundabout","x","y","left","right","top","bottom","direction","point","reset","current","next","getTitle","title","makeArray","makeArrayHelper","slice","dimensions","slice_chunk","nop","coreLoops","frame","fps","period","Math","floor","nextTime","lastCount","frameCount","loop","Loop","addLoop","beginLoop","removeLoop","splice","loopTime","performance","Object","defineProperty","enumerable","configurable","get","set","IDGenerator","max","recycle","id","pop","gifWorkerCallbacks","generator","GifWorker","onmessage","frameInfo","cData","header","plasterPixels","postMessage","buffer","img","gce","transparency","transparencyGiven","transparencyIndex","disposalMethod","ct","lctFlag","lct","gct","pixels","forEach","pixel","code","toString","substring","lastIndexOf","blob","Blob","gifWorker","Worker","URL","createObjectURL","initializeGifWorker","sendToGifWorker","terminate","bitsToNum","ba","reduce","s","n","byteToBitArr","bite","a","Stream","len","pos","readByte","charCodeAt","readBytes","bytes","read","fromCharCode","readUnsigned","lzwDecode","minCodeSize","readCode","size","output","clearCode","eoiCode","codeSize","dict","clear","last","concat","parseGIF","st","handler","parseCT","entries","readSubBlocks","parseHeader","hdr","sig","ver","width","height","bits","gctFlag","shift","colorRes","sorted","gctSize","bgColor","pixelAspectRatio","parseExt","block","parseGCExt","blockSize","reserved","userInput","delayTime","terminator","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","parseImg","deinterlace","newPixels","rows","cpRow","toRow","fromRow","fromPixels","offsets","steps","pass","leftPos","topPos","interlaced","lctSize","lzwMinCodeSize","lzwData","parseBlock","sentinel","eof","parse","exports","JSGif","gifs","isGif","toLowerCase","getGif","GifImage","self","gifInfo","maxFrameCompleted","framesProcessed","frameInfos","canvases","callbacks","frameSlot","processNextFrame","canvas","createElement","style","position","ctx","getContext","webkitImageSmoothingEnabled","imageSmoothingEnabled","msImageSmoothingEnabled","drawImage","getImageData","processNext","bind","putImageData","ready","_hdr","_gce","cycleTime","currentIndex","_img","content","GifImage_getFrame","totalAnimationTime","cycle","timeInCycle","GifHandler","THREE","gameWidth","innerWidth","gameHeight","innerHeight","camera","camera2d","OrthographicCamera","camera3d","PerspectiveCamera","cameraQuaternionData","forwardMovement","Vector3","version","lastQuat","Quaternion","tempQuat","tempQuatArray","upVector","groundQuat","setFromAxisAngle","PI","getCamera","setCamera3d","copyCamera","updateQuaternionData","quaternion","toArray","applyQuaternion","getCameraQuaternionData","equals","copy","initCameras","isCamera3d","from","to","getCameraPosition","setCameraPosition","is3d","fromArray","updateProjectionMatrix","shadowQuatArray","angle","atan2","z","multiply","quaternionArrays","quaternions","groundQuaternionArray","southQuaternionArray","northQuaternionArray","westQuaternionArray","eastQuaternionArray","ceilingQuaternionArray","checkWindowSize","aspect","Camera","ObjectPool","classObject","pool","create","recycleAll","SpriteObject","quaternionArray","initSpriteObject","spriteObject","light","wave","hasQuaternionArray","visible","objectPool","MAX_TEXTURES","SPRITE_SHEET_SIZE","CHUNKSIZES","chunks","doesFit","tex","xi","yi","findSlot","chunkWidth","ceil","chunkHeight","fillSlot","getSlot","slot","Packer","imageQueue","loadLimit","loading","loadingBar","visualProgress","onLoadCallback","loaded","loadTotal","setOnLoad","onLoad","body","removeChild","getLoadingBar","loadImage","url","image","Image","onload","event","call","checkLoad","crossOrigin","loadFile","getLoadingProgress","refreshLoadingBar","actualProgress","fillRect","round","backgroundColor","border","fillStyle","appendChild","Loader","cuts","cutArray","cutCount","textures","slots","planeGeometry","PlaneBufferGeometry","getCanvas","canCreate","setAttribute","parseInt","Texture","magFilter","NearestFilter","minFilter","LinearMipMapLinearFilter","updateTextureEvent","initCanvas","context","customEvent","detail","evt","createEvent","initCustomEvent","fetchCanvas","urlpipe","join","subpipe","processString","subCanvas","getAttribute","processCanvas","currentTarget","dispatchEvent","isNaN","gif","drawGif","naturalWidth","naturalHeight","outputCanvas","outputCtx","splits","every","num","map","o","drawWidth","min","drawHeight","scale","abs","sign","translate","restore","borderWidth","parseFloat","beginPath","rect","stroke","font","fillText","_i","moveTo","lineTo","getCut","cut","getCutByURL","baseUrl","animated","uv","updateSpritesheetEvent","uvX","uvY","uvW","uvH","uvOrder","attributes","cutcut","u","preLoad","images","root","SpriteSheet","spritesheet","prop","hasOwnProperty","needsUpdate","dispose","getTextures","SIZE","buckets","counts","indexFunction","identity","getMinMax","firstIndex","minNum","maxNum","previousNum","inOrder","min_max_result","turboSort","func","turboSortHelper","arrayInfo","range","bucketSize","voyager","bucketId","newSpot","swap","b","temp","fragmentShader","vertexShader","vertexShaderCommon","Shader","pointCount","count","indices","spriteRenderers","uniforms","indexProcessor","SpriteRenderer","imageOrder","imageCount","mesh","createMesh","curvature","display","SpriteImage","random","j","indexArray","quat","quatDirty","spotArray","positionDirty","vertices","v","verticesDirty","uvDirty","texDirty","lightDirty","waveDirty","destroy","destroySprite","render","updateGraphics","processGraphics","zIndex","spriteRenderer","geometry","BufferGeometry","addAttribute","BufferAttribute","Mesh","MeshBasicMaterial","material","ShaderMaterial","texture","vCam","transparent","depthWrite","depthTest","frustumCulled","sortImages","distanceToManhattan","setIndexProcessor","fun","previousAttribute","copyArray","setDynamic","spot","_indices","geo_quaternion","geo_spot","geo_pos","geo_tex","geo_light","geo_wave","geo_uv","geo_index","quatChanged","positionChanged","texChanged","verticesChanged","uvChanged","lightChanged","waveChanged","drawRange","setDrawRange","Collection","options","getSpriteFunction","getSprite","Grid_forEach","isCollection","find","optionsX","optionsY","optionsWidth","optionsHeight","gridCount","_x","_y","c","spriteFace","spriteInfo","cellSize","sprite","cubeFaces","spriteCube","cube","faces","createSpriteCollection","spriteHash","areaSize","spriteRegistry","spriteFunction","spriteCount","SpriteInfo","uid","enterArea","leaveArea","areaId","getAreaHashId","area","move","getAreaHashIdWithArea","selectedObj","getCamPos","xPos","yPos","spriteCollection","camPos","xArea","yArea","areaRange","_y2","_x2","props","getOwnPropertyNames","pros","wheelCallbacks","zoomCallbacks","touchSpotX","touchSpotY","pinchSize","mdown","onDown","target","touches","changedTouches","touch","pageX","pageY","dx","dy","dist","sqrt","preventDefault","onUp","hasTouch","onMove","buttonDown","buttons","which","button","newX","newY","diff","onWheel","deltaX","deltaY","setOnTouch","deactivateTouch","activateTouch","setOnWheel","setOnZoom","element","removeEventListener","setMainElement","elem","Mouse","Engine","renderer","WebGLRenderer","sortObjects","setPixelRatio","devicePixelRatio","setClearColor","windowResized","Scene","sceneWidth","sceneHeight","domElement","checkResize","parentElement","offsetWidth","offsetHeight","setSize","requirejs","config","paths","threejs","dobuki","jsgif","urlArgs","match","require","DOK"],"mappings":"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","file":"dok.js","sourcesContent":["\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\ndefine('utils',[],function () {\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function fixPath() {\n        var regex = /\\/$|index\\.html$|next\\.html$/g;\n        if (!regex.exec(location.pathname)) {\n            window.history.pushState(null, \"\", location.pathname + \"/\" + location.search + location.hash);\n        }\n    }\n\n    function changeScene(scene, htmlFile) {\n        if (typeof htmlFile === 'undefined') {\n            htmlFile = 'scene.html';\n        }\n        Utils.destroyEverything();\n        location.replace(\"../\" + scene + \"/\" + htmlFile);\n    }\n\n    function handleError(error, soft) {\n        if (Array.isArray(error)) {\n            var array = [];\n            for (var i = 0; i < error.length; i++) {\n                array.push(error[i]);\n                array.push(\"\\n \");\n            }\n            console.error.apply(null, array);\n        } else {\n            console.error(error);\n        }\n        Utils.lastError = error;\n        if (!soft) {\n            throw new Error(\"Last error terminated the process.\");\n        }\n    }\n\n    function combineMethods(firstMethod, secondMethod) {\n        return function () {\n            if (firstMethod) firstMethod();\n            if (secondMethod) secondMethod();\n        };\n    }\n\n    function expectParams(args) {\n        assert((typeof args === \"undefined\" ? \"undefined\" : _typeof(args)) === 'object', \"Pass 'arguments' to expectParams\");\n\n        for (var i = 1; i < arguments.length; i++) {\n            var type = args[i - 1] === null ? 'null' : Array.isArray(args[i - 1]) ? 'array' : _typeof(args[i - 1]);\n            assert(arguments[i].split(\"|\").indexOf(type) >= 0, [\"Expected argument \" + (i - 1) + \" to be \" + arguments[i] + \" NOT \" + type, args]);\n        }\n    }\n\n    function checkParams(args) {\n        assert((typeof args === \"undefined\" ? \"undefined\" : _typeof(args)) === 'object', \"Pass 'arguments' to expectParams\");\n\n        for (var i = 1; i < arguments.length; i++) {\n            var type = args[i - 1] === null ? 'null' : Array.isArray(args[i - 1]) ? 'array' : _typeof(args[i - 1]);\n            if (arguments[i].split(\"|\").indexOf(type) < 0) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    function assert(condition, message) {\n        if (!condition) {\n            handleError(message ? message : \"Assert failed: condition not met.\");\n        }\n    }\n\n    function cleanUp() {\n        Utils.destroyEverything();\n    }\n\n    function setupExit() {\n        document.onbeforeunload = window.onbeforeunload = cleanUp;\n    }\n\n    var destroyEverything = function destroyEverything() {};\n    function onDestroy(callback) {\n        destroyEverything = Utils.combineMethods(callback, destroyEverything);\n    }\n\n    function definePrototypes() {\n        if (typeof String.prototype.trim === \"undefined\") {\n            String.prototype.trim = function () {\n                return String(this).replace(/^\\s+|\\s+$/g, '');\n            };\n        }\n\n        if (!window.requestAnimationFrame) {\n            setupRequestAnimationFrame();\n        }\n\n        if (typeof Float32Array.prototype.fill === 'undefined') {\n            Float32Array.prototype.fill = fill_compat;\n        }\n\n        if (typeof Uint32Array.prototype.fill === 'undefined') {\n            Uint32Array.prototype.fill = fill_compat;\n        }\n\n        if (typeof Uint16Array.prototype.fill === 'undefined') {\n            Uint16Array.prototype.fill = fill_compat;\n        }\n\n        function fill_compat(value, start, end) {\n            start = start || 0;\n            end = end || this.length;\n            for (var i = start; i < end; i++) {\n                this[i] = value;\n            }\n            return this;\n        }\n\n        function splatter(array, offset) {\n            for (var i = this.length - 1; i >= 0; i--) {\n                array[offset + i] = this[i];\n            }\n            return this;\n        }\n\n        Float32Array.prototype.splatter = splatter;\n        Uint32Array.prototype.splatter = splatter;\n        Uint16Array.prototype.splatter = splatter;\n\n        Array.prototype.getFrame = function (index) {\n            index = index | 0;\n            return this[index % this.length];\n        };\n        Number.prototype.getFrame = function () {\n            return this;\n        };\n    }\n\n    function setupRequestAnimationFrame() {\n        window.requestAnimationFrame = function () {\n            return window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || requestAnimationFrame_compat;\n        }();\n\n        var timeout = void 0,\n            time = 0;\n        function requestAnimationFrame_compat(callback) {\n            timeout = setTimeout(timeoutCallback, 1000 / 60, callback);\n        }\n\n        function timeoutCallback(callback) {\n            clearTimeout(timeout);\n            var dt = Date.now() - time;\n            callback(dt);\n            time = Date.now();\n        }\n    }\n\n    function loadAsyncHelper(src, result, index, callback, binary, method, data) {\n        loadAsync(src, function (value) {\n            result[index] = value;\n            for (var i = 0; i < result.length; i++) {\n                if (result[i] === undefined) {\n                    return;\n                }\n            }\n            callback.apply(null, result);\n        }, binary, method, data);\n    }\n\n    function loadAsync(src, callback, binary, method, data) {\n        if (Array.isArray(src)) {\n            var result = new Array(src.length);\n            for (var i = 0; i < src.length; i++) {\n                loadAsyncHelper(src[i], result, i, callback);\n            }\n        } else {\n            var xhr = new XMLHttpRequest();\n            xhr.overrideMimeType(binary ? \"text/plain; charset=x-user-defined\" : \"text/plain; charset=UTF-8\");\n            xhr.open(method ? method : \"GET\", src, true);\n            xhr.addEventListener('load', function () {\n                if (xhr.readyState === 4) {\n                    if (xhr.status === 200) {\n                        callback(xhr.responseText);\n                    } else {\n                        handleError(xhr.responseText);\n                    }\n                }\n            });\n            xhr.addEventListener('error', function (e) {\n                handleError(e);\n            });\n            xhr.send(data);\n        }\n    }\n\n    //      C\n    //     748\n    //    B3019\n    //     625\n    //      A\n\n\n    function Roundabout() {\n        this.x = 0;\n        this.y = 0;\n        this.left = -1;\n        this.right = 1;\n        this.top = -1;\n        this.bottom = 1;\n        this.direction = 0; //  0-right, 1-bottom, 2-left, 3-up\n\n        var point = [0, 0];\n\n        this.reset = function () {\n            this.x = 0;\n            this.y = 0;\n            this.left = -1;\n            this.right = 1;\n            this.top = -1;\n            this.bottom = 1;\n            this.direction = 0; //  0-right, 1-bottom, 2-left, 3-up\n        };\n\n        this.current = function () {\n            point[0] = this.x;\n            point[1] = this.y;\n            return point;\n        };\n\n        this.next = function () {\n            var point = this.current();\n            switch (this.direction) {\n                case 0:\n                    this.x++;\n                    if (this.x >= this.right) {\n                        this.right++;\n                        this.direction = (this.direction + 1) % 4; //  change dir\n                    }\n                    break;\n                case 1:\n                    this.y++;\n                    if (this.y >= this.bottom) {\n                        this.bottom++;\n                        this.direction = (this.direction + 1) % 4;\n                    }\n                    break;\n                case 2:\n                    this.x--;\n                    if (this.x <= this.left) {\n                        this.left--;\n                        this.direction = (this.direction + 1) % 4; //  change dir\n                    }\n                    break;\n                case 3:\n                    this.y--;\n                    if (this.y <= this.top) {\n                        this.top--;\n                        this.direction = (this.direction + 1) % 4; //  change dir\n                    }\n                    break;\n            }\n            return point;\n        };\n    }\n\n    function getTitle() {\n        return title;\n    }\n\n    function makeArray() {\n        //  call like makArray(1,2) => [ [], [] ]\n        return makeArrayHelper(Array.prototype.slice.apply(arguments));\n    }\n\n    function makeArrayHelper(dimensions) {\n        var array = [];\n        array.length = dimensions[0];\n        if (dimensions.length > 1) {\n            var slice_chunk = dimensions.slice(1);\n            for (var i = 0; i < array.length; i++) {\n                array[i] = makeArrayHelper(slice_chunk);\n            }\n        }\n        return array;\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    var title = \"\";\n\n    function Utils() {\n        this.lastError = null;\n    }\n    Utils.handleError = handleError;\n    Utils.changeScene = changeScene;\n    Utils.destroyEverything = destroyEverything;\n    Utils.combineMethods = combineMethods;\n    Utils.expectParams = expectParams;\n    Utils.checkParams = checkParams;\n    Utils.assert = assert;\n    Utils.fixPath = fixPath;\n    Utils.onDestroy = onDestroy;\n    Utils.loadAsync = loadAsync;\n    Utils.Roundabout = Roundabout;\n    Utils.getTitle = getTitle;\n    Utils.makeArray = makeArray;\n    Utils.nop = function () {};\n\n    /**\n     *   PROCESSES\n     */\n    setupExit();\n    definePrototypes();\n\n    /*\n    \n         function addLinkToHeadTag(rel, href) {\n             const link = document.createElement(\"link\");\n             link.setAttribute(\"rel\", rel);\n             link.href = href;\n             document.head.appendChild(link);\n         }\n    \n    \n         loadAsync(\"package.json\", function(str) {\n            try {\n                var object = JSON.parse(str);\n                var icon = object.window.icon || require.toUrl('images/logo.ico');\n                document.title = object.window.title || 'Dobuki Game';\n                addLinkToHeadTag(\"shortcut icon\", icon);\n                addLinkToHeadTag(\"apple-touch-icon\", object.window['apple-touch-icon'] || icon);\n            } catch(e) {\n            }\n        });\n    */\n\n    return Utils;\n});\n//# sourceMappingURL=utils.js.map;\n\n\ndefine('loop',['utils'], function (Utils) {\n    'use strict';\n\n    var coreLoops = null;\n    var frame = 0;\n    var fps = 0;\n    var period = Math.floor(1000 / 60);\n    var nextTime = 0;\n    var lastCount = 0;\n\n    var frameCount = 0;\n\n    /**\n    *  FUNCTION DEFINITIONS\n    */\n    function loop(time) {\n        if (coreLoops) {\n            requestAnimationFrame(loop);\n            if (time <= Loop.time + period) {\n                return;\n            }\n            Loop.time = Math.floor(time / period) * period;\n            for (var i = 0; coreLoops && i < coreLoops.length; i++) {\n                coreLoops[i]();\n            }\n            frameCount++;\n            if (time - lastCount > 1000) {\n                fps = frameCount;\n                frameCount = 0;\n                lastCount = time;\n            }\n        }\n    }\n\n    function addLoop(callback) {\n        if (coreLoops === null) {\n            coreLoops = [];\n            beginLoop();\n        }\n        coreLoops.push(callback);\n    }\n\n    function removeLoop(callback) {\n        if (coreLoops) {\n            var index = coreLoops.indexOf(callback);\n            coreLoops.splice(index, 1);\n            if (coreLoops.length === 0) {\n                coreLoops = null;\n            }\n        }\n    }\n\n    function beginLoop() {\n        loop(0);\n    }\n\n    function loopTime() {\n        return performance.now() - Loop.time;\n    }\n\n    function destroyEverything() {\n        coreLoops = null;\n        frame = 0;\n        fps = 0;\n        period = Math.floor(1000 / 60);\n        nextTime = 0;\n        lastCount = 0;\n        frameCount = 0;\n    }\n\n    /**\n    *  PUBLIC DECLARATIONS\n    */\n    function Loop() {}\n\n    Loop.addLoop = addLoop;\n    Loop.removeLoop = removeLoop;\n    Utils.onDestroy(Loop);\n\n    Object.defineProperty(Loop, \"fps\", {\n        enumerable: false,\n        configurable: false,\n        get: function get() {\n            return fps;\n        },\n        set: function set(value) {\n            period = Math.floor(1000 / value);\n        }\n    });\n\n    /**\n    *   PROCESSES\n    */\n    Loop.time = 0;\n\n    return Loop;\n});\n//# sourceMappingURL=loop.js.map;\n\n\ndefine('IDGenerator',[],function () {\n    function IDGenerator() {\n        var array = [];\n        var max = 1;\n        this.recycle = function (id) {\n            array.push(id);\n        };\n        this.get = function () {\n            if (array.length) {\n                return array.pop();\n            }\n            return max++;\n        };\n    }\n    IDGenerator.prototype.recycle = null;\n    IDGenerator.prototype.get = null;\n    return IDGenerator;\n});\n//# sourceMappingURL=IDGenerator.js.map;\n\n\ndefine('gifworker',['utils', 'loop', 'IDGenerator'], function (Utils, Loop, IDGenerator) {\n    var gifWorkerCallbacks = [];\n    var generator = new IDGenerator();\n\n    function GifWorker() {\n        onmessage = function onmessage(e) {\n            var frameInfo = e.data.frameInfo;\n            var cData = e.data.cData;\n            var header = e.data.header;\n            var id = e.data.id;\n\n            if (frameInfo && cData && header) {\n                plasterPixels(frameInfo, cData, header);\n            }\n            postMessage({ id: id, cData: cData, frameInfo: frameInfo }, [cData.data.buffer]);\n        };\n\n        function plasterPixels(frameInfo, cData, header) {\n            var img = frameInfo.img;\n            var gce = frameInfo.gce;\n            var transparency = gce.transparencyGiven ? gce.transparencyIndex : null;\n            var disposalMethod = gce.disposalMethod;\n\n            var ct = img.lctFlag ? img.lct : header.gct;\n\n            img.pixels.forEach(function (pixel, i) {\n                if (transparency !== pixel) {\n                    // This includes null, if no transparency was defined.\n                    cData.data[i * 4] = ct[pixel][0];\n                    cData.data[i * 4 + 1] = ct[pixel][1];\n                    cData.data[i * 4 + 2] = ct[pixel][2];\n                    cData.data[i * 4 + 3] = 255; // Opaque.\n                } else if (disposalMethod === 2 || disposalMethod === 3) {\n                    cData.data[i * 4 + 3] = 0; // Transparent.\n                }\n            });\n        }\n    }\n\n    var code = GifWorker.toString();\n    code = code.substring(code.indexOf(\"{\") + 1, code.lastIndexOf(\"}\"));\n\n    var blob = new Blob([code], { type: \"application/javascript\" });\n    var gifWorker = new Worker(URL.createObjectURL(blob));\n\n    function initializeGifWorker(gifWorker) {\n        gifWorker.onmessage = function (e) {\n            gifWorkerCallbacks[e.data.id](e.data.cData, e.data.frameInfo);\n            generator.recycle(e.data.id);\n            delete gifWorkerCallbacks[e.data.id];\n        };\n    }\n\n    function sendToGifWorker(frameInfo, cData, header, callback) {\n        var id = generator.get();\n        gifWorkerCallbacks[id] = callback;\n        gifWorker.postMessage({\n            frameInfo: frameInfo,\n            cData: cData,\n            header: header,\n            id: id\n        }, [cData.data.buffer]);\n    }\n\n    initializeGifWorker(gifWorker);\n\n    gifWorker.send = sendToGifWorker;\n\n    function destroyEverything() {\n        if (gifWorker) {\n            gifWorker.terminate();\n        }\n        gifWorker = null;\n        gifWorkerCallbacks = null;\n        generator = null;\n    }\n\n    Utils.onDestroy(destroyEverything);\n\n    return gifWorker;\n});\n//# sourceMappingURL=gifworker.js.map;\n\n\ndefine('jsgif/gif',[],function () {\n    // Generic functions\n    var bitsToNum = function bitsToNum(ba) {\n        return ba.reduce(function (s, n) {\n            return s * 2 + n;\n        }, 0);\n    };\n\n    var byteToBitArr = function byteToBitArr(bite) {\n        var a = [];\n        for (var i = 7; i >= 0; i--) {\n            a.push(!!(bite & 1 << i));\n        }\n        return a;\n    };\n\n    // Stream\n    /**\n     * @constructor\n     */ // Make compiler happy.\n    var Stream = function Stream(data) {\n        this.data = data;\n        this.len = this.data.length;\n        this.pos = 0;\n\n        this.readByte = function () {\n            if (this.pos >= this.data.length) {\n                throw new Error('Attempted to read past end of stream.');\n            }\n            return data.charCodeAt(this.pos++) & 0xFF;\n        };\n\n        this.readBytes = function (n) {\n            var bytes = [];\n            for (var i = 0; i < n; i++) {\n                bytes.push(this.readByte());\n            }\n            return bytes;\n        };\n\n        this.read = function (n) {\n            var s = '';\n            for (var i = 0; i < n; i++) {\n                s += String.fromCharCode(this.readByte());\n            }\n            return s;\n        };\n\n        this.readUnsigned = function () {\n            // Little-endian.\n            var a = this.readBytes(2);\n            return (a[1] << 8) + a[0];\n        };\n    };\n\n    var lzwDecode = function lzwDecode(minCodeSize, data) {\n        // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n        var pos = 0; // Maybe this streaming thing should be merged with the Stream?\n\n        var readCode = function readCode(size) {\n            var code = 0;\n            for (var i = 0; i < size; i++) {\n                if (data.charCodeAt(pos >> 3) & 1 << (pos & 7)) {\n                    code |= 1 << i;\n                }\n                pos++;\n            }\n            return code;\n        };\n\n        var output = [];\n\n        var clearCode = 1 << minCodeSize;\n        var eoiCode = clearCode + 1;\n\n        var codeSize = minCodeSize + 1;\n\n        var dict = [];\n\n        var clear = function clear() {\n            dict = [];\n            codeSize = minCodeSize + 1;\n            for (var i = 0; i < clearCode; i++) {\n                dict[i] = [i];\n            }\n            dict[clearCode] = [];\n            dict[eoiCode] = null;\n        };\n\n        var code;\n        var last;\n\n        while (true) {\n            last = code;\n            code = readCode(codeSize);\n\n            if (code === clearCode) {\n                clear();\n                continue;\n            }\n            if (code === eoiCode) break;\n\n            if (code < dict.length) {\n                if (last !== clearCode) {\n                    dict.push(dict[last].concat(dict[code][0]));\n                }\n            } else {\n                if (code !== dict.length) throw new Error('Invalid LZW code.');\n                dict.push(dict[last].concat(dict[last][0]));\n            }\n            output.push.apply(output, dict[code]);\n\n            if (dict.length === 1 << codeSize && codeSize < 12) {\n                // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n                codeSize++;\n            }\n        }\n\n        // I don't know if this is technically an error, but some GIFs do it.\n        //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n        return output;\n    };\n\n    // The actual parsing; returns an object with properties.\n    var parseGIF = function parseGIF(st, handler) {\n        handler || (handler = {});\n\n        // LZW (GIF-specific)\n        var parseCT = function parseCT(entries) {\n            // Each entry is 3 bytes, for RGB.\n            var ct = [];\n            for (var i = 0; i < entries; i++) {\n                ct.push(st.readBytes(3));\n            }\n            return ct;\n        };\n\n        var readSubBlocks = function readSubBlocks() {\n            var size, data;\n            data = '';\n            do {\n                size = st.readByte();\n                data += st.read(size);\n            } while (size !== 0);\n            return data;\n        };\n\n        var parseHeader = function parseHeader() {\n            var hdr = {};\n            hdr.sig = st.read(3);\n            hdr.ver = st.read(3);\n            if (hdr.sig !== 'GIF') throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n\n            hdr.width = st.readUnsigned();\n            hdr.height = st.readUnsigned();\n\n            var bits = byteToBitArr(st.readByte());\n            hdr.gctFlag = bits.shift();\n            hdr.colorRes = bitsToNum(bits.splice(0, 3));\n            hdr.sorted = bits.shift();\n            hdr.gctSize = bitsToNum(bits.splice(0, 3));\n\n            hdr.bgColor = st.readByte();\n            hdr.pixelAspectRatio = st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n\n            if (hdr.gctFlag) {\n                hdr.gct = parseCT(1 << hdr.gctSize + 1);\n            }\n            handler.hdr && handler.hdr(hdr);\n        };\n\n        var parseExt = function parseExt(block) {\n            var parseGCExt = function parseGCExt(block) {\n                var blockSize = st.readByte(); // Always 4\n\n                var bits = byteToBitArr(st.readByte());\n                block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n                block.disposalMethod = bitsToNum(bits.splice(0, 3));\n                block.userInput = bits.shift();\n                block.transparencyGiven = bits.shift();\n\n                block.delayTime = st.readUnsigned();\n\n                block.transparencyIndex = st.readByte();\n\n                block.terminator = st.readByte();\n\n                handler.gce && handler.gce(block);\n            };\n\n            var parseComExt = function parseComExt(block) {\n                block.comment = readSubBlocks();\n                handler.com && handler.com(block);\n            };\n\n            var parsePTExt = function parsePTExt(block) {\n                // No one *ever* uses this. If you use it, deal with parsing it yourself.\n                var blockSize = st.readByte(); // Always 12\n                block.ptHeader = st.readBytes(12);\n                block.ptData = readSubBlocks();\n                handler.pte && handler.pte(block);\n            };\n\n            var parseAppExt = function parseAppExt(block) {\n                var parseNetscapeExt = function parseNetscapeExt(block) {\n                    var blockSize = st.readByte(); // Always 3\n                    block.unknown = st.readByte(); // ??? Always 1? What is this?\n                    block.iterations = st.readUnsigned();\n                    block.terminator = st.readByte();\n                    handler.app && handler.app.NETSCAPE && handler.app.NETSCAPE(block);\n                };\n\n                var parseUnknownAppExt = function parseUnknownAppExt(block) {\n                    block.appData = readSubBlocks();\n                    // FIXME: This won't work if a handler wants to match on any identifier.\n                    handler.app && handler.app[block.identifier] && handler.app[block.identifier](block);\n                };\n\n                var blockSize = st.readByte(); // Always 11\n                block.identifier = st.read(8);\n                block.authCode = st.read(3);\n                switch (block.identifier) {\n                    case 'NETSCAPE':\n                        parseNetscapeExt(block);\n                        break;\n                    default:\n                        parseUnknownAppExt(block);\n                        break;\n                }\n            };\n\n            var parseUnknownExt = function parseUnknownExt(block) {\n                block.data = readSubBlocks();\n                handler.unknown && handler.unknown(block);\n            };\n\n            block.label = st.readByte();\n            switch (block.label) {\n                case 0xF9:\n                    block.extType = 'gce';\n                    parseGCExt(block);\n                    break;\n                case 0xFE:\n                    block.extType = 'com';\n                    parseComExt(block);\n                    break;\n                case 0x01:\n                    block.extType = 'pte';\n                    parsePTExt(block);\n                    break;\n                case 0xFF:\n                    block.extType = 'app';\n                    parseAppExt(block);\n                    break;\n                default:\n                    block.extType = 'unknown';\n                    parseUnknownExt(block);\n                    break;\n            }\n        };\n\n        var parseImg = function parseImg(img) {\n            var deinterlace = function deinterlace(pixels, width) {\n                // Of course this defeats the purpose of interlacing. And it's *probably*\n                // the least efficient way it's ever been implemented. But nevertheless...\n\n                var newPixels = new Array(pixels.length);\n                var rows = pixels.length / width;\n                var cpRow = function cpRow(toRow, fromRow) {\n                    var fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n                    newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n                };\n\n                // See appendix E.\n                var offsets = [0, 4, 2, 1];\n                var steps = [8, 8, 4, 2];\n\n                var fromRow = 0;\n                for (var pass = 0; pass < 4; pass++) {\n                    for (var toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n                        cpRow(toRow, fromRow);\n                        fromRow++;\n                    }\n                }\n\n                return newPixels;\n            };\n\n            img.leftPos = st.readUnsigned();\n            img.topPos = st.readUnsigned();\n            img.width = st.readUnsigned();\n            img.height = st.readUnsigned();\n\n            var bits = byteToBitArr(st.readByte());\n            img.lctFlag = bits.shift();\n            img.interlaced = bits.shift();\n            img.sorted = bits.shift();\n            img.reserved = bits.splice(0, 2);\n            img.lctSize = bitsToNum(bits.splice(0, 3));\n\n            if (img.lctFlag) {\n                img.lct = parseCT(1 << img.lctSize + 1);\n            }\n\n            img.lzwMinCodeSize = st.readByte();\n\n            var lzwData = readSubBlocks();\n\n            img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n            if (img.interlaced) {\n                // Move\n                img.pixels = deinterlace(img.pixels, img.width);\n            }\n\n            handler.img && handler.img(img);\n        };\n\n        var parseBlock = function parseBlock() {\n            var block = {};\n            block.sentinel = st.readByte();\n\n            switch (String.fromCharCode(block.sentinel)) {// For ease of matching\n                case '!':\n                    block.type = 'ext';\n                    parseExt(block);\n                    break;\n                case ',':\n                    block.type = 'img';\n                    parseImg(block);\n                    break;\n                case ';':\n                    block.type = 'eof';\n                    handler.eof && handler.eof(block);\n                    break;\n                default:\n                    throw new Error('Unknown block: 0x' + block.sentinel.toString(16)); // TODO: Pad this with a 0.\n            }\n\n            if (block.type !== 'eof') setTimeout(parseBlock, 0);\n        };\n\n        var parse = function parse() {\n            parseHeader();\n            setTimeout(parseBlock, 0);\n        };\n\n        parse();\n    };\n\n    // BEGIN_NON_BOOKMARKLET_CODE\n    if (typeof exports !== 'undefined') {\n        exports.Stream = Stream;\n        exports.parseGIF = parseGIF;\n    }\n    // END_NON_BOOKMARKLET_CODE\n\n\n    return { Stream: Stream, parseGIF: parseGIF };\n});\n//# sourceMappingURL=gif.js.map;\n\n\ndefine('gifHandler',['utils', 'loop', 'gifworker', 'jsgif/gif'], function (Utils, Loop, gifWorker, JSGif) {\n    'use strict';\n\n    var gifs = {};\n\n    /**\n     *  CLASS DEFINITIONS\n     */\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function isGif(src) {\n        return gifs[src] && gifs[src].block || src.split(\"?\")[0].slice(-4).toLowerCase() === \".gif\" || src.indexOf(\"data:image/gif;\") === 0;\n    }\n\n    function getGif(src) {\n        if (!gifs[src]) {\n            gifs[src] = new GifImage(src);\n        }\n        return gifs[src];\n    }\n\n    function GifImage(src) {\n        var self = this;\n\n        var gifInfo = {\n            maxFrameCompleted: 0,\n            framesProcessed: 0,\n            header: null,\n            frameInfos: [],\n            block: null,\n            canvases: [],\n            callbacks: [],\n            frameSlot: null,\n            processNextFrame: function processNextFrame() {\n                var frame = this.framesProcessed;\n                var frameInfo = this.frameInfos[frame];\n\n                if (frameInfo && frameInfo.gce && frameInfo.img && this.header) {\n                    var canvas = document.createElement(\"canvas\");\n                    canvas.style.position = \"absolute\";\n                    canvas.style.left = 0;\n                    canvas.style.top = 0;\n                    canvas.width = this.header.width;\n                    canvas.height = this.header.height;\n                    var ctx = canvas.getContext(\"2d\");\n                    ctx.webkitImageSmoothingEnabled = false;\n                    ctx.imageSmoothingEnabled = false;\n                    ctx.msImageSmoothingEnabled = false;\n\n                    this.canvases[frame] = canvas;\n                    if (frame > 0) {\n                        //  copy previous frame. That's how gifs work\n                        ctx.drawImage(this.canvases[frame - 1], 0, 0);\n                    }\n\n                    var cData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n                    var self = this;\n                    var processNext = this.processNextFrame.bind(this);\n                    gifWorker.send(frameInfo, cData, this.header, function (cData, frameInfo) {\n                        ctx.putImageData(cData, 0, 0);\n                        if (self.callbacks[frameInfo.frame]) {\n                            self.callbacks[frameInfo.frame]();\n                        }\n                        self.maxFrameCompleted = frameInfo.frame;\n                        self.frameInfos[frameInfo.frame].ready = true;\n                        processNext();\n                    });\n                    this.framesProcessed++;\n                    //                    document.body.appendChild(canvas);\n                }\n            },\n            hdr: function hdr(_hdr) {\n                this.header = _hdr;\n                self.width = this.header.width;\n                self.height = this.header.height;\n            },\n            gce: function gce(_gce) {\n                if (this.frameInfos.length === 0 || this.frameInfos[this.frameInfos.length - 1].gce) {\n                    this.frameInfos.push({\n                        gce: null,\n                        cycleTime: null,\n                        img: null,\n                        frame: this.frameInfos.length,\n                        ready: false\n                    });\n                }\n                var currentIndex = this.frameInfos.length - 1;\n                this.frameInfos[currentIndex].gce = _gce;\n                if (!_gce.delayTime) {\n                    _gce.delayTime = 1;\n                }\n                this.frameInfos[currentIndex].cycleTime = _gce.delayTime * 10 + (currentIndex === 0 ? 0 : this.frameInfos[currentIndex - 1].cycleTime);\n                this.processNextFrame();\n            },\n            img: function img(_img) {\n                if (this.frameInfos.length === 0 || this.frameInfos[this.frameInfos.length - 1].img) {\n                    this.frameInfos.push({});\n                }\n                this.frameInfos[this.frameInfos.length - 1].img = _img;\n                this.processNextFrame();\n            },\n            eof: function eof(block) {\n                this.block = block;\n                this.processNextFrame();\n            }\n        };\n\n        Utils.loadAsync(src, function (content) {\n            JSGif.parseGIF(new JSGif.Stream(content), gifInfo);\n        }, true);\n\n        this.frameInfos = gifInfo.frameInfos;\n        this.canvases = gifInfo.canvases;\n        this.callbacks = gifInfo.callbacks;\n        this.gifInfo = gifInfo;\n    }\n    GifImage.prototype.width = 0;\n    GifImage.prototype.height = 0;\n    GifImage.prototype.frameInfos = [];\n    GifImage.prototype.canvases = [];\n    GifImage.prototype.callbacks = [];\n    GifImage.prototype.gifInfo = null;\n    GifImage.prototype.getFrame = GifImage_getFrame;\n\n    function GifImage_getFrame(time) {\n        var gifInfo = this.gifInfo;\n\n        if (gifInfo.block) {\n            var totalAnimationTime = this.frameInfos[this.frameInfos.length - 1].cycleTime;\n            if (!gifInfo.frameSlot) {\n                gifInfo.frameSlot = [];\n                var cycle = 0;\n                for (var frame = 0; frame < this.frameInfos.length; frame++) {\n                    while (gifInfo.frameSlot.length < this.frameInfos[frame].cycleTime) {\n                        gifInfo.frameSlot.push(frame);\n                    }\n                }\n            }\n            var timeInCycle = Math.floor(time % totalAnimationTime);\n            return gifInfo.frameSlot[timeInCycle];\n        }\n        return gifInfo.maxFrameCompleted;\n    }\n\n    function destroyEverything() {\n        gifs = {};\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    function GifHandler() {}\n\n    GifHandler.getGif = getGif;\n    GifHandler.isGif = isGif;\n    Utils.onDestroy(destroyEverything);\n\n    return GifHandler;\n});\n//# sourceMappingURL=gifhandler.js.map;\n\n\ndefine('camera',['threejs', 'loop'], function (THREE, Loop) {\n    'use strict';\n\n    var gameWidth = innerWidth,\n        gameHeight = innerHeight;\n    var camera = void 0;\n    var camera2d = new THREE.OrthographicCamera(-gameWidth / 2, gameWidth / 2, gameHeight / 2, -gameHeight / 2, 0.1, 1000000);\n    var camera3d = new THREE.PerspectiveCamera(75, gameWidth / gameHeight, 0.1, 1000000);\n    var cameraQuaternionData = {\n        array: new Float32Array(4),\n        forwardMovement: new THREE.Vector3(0, 0, 1),\n        version: 0\n    },\n        lastQuat = new THREE.Quaternion(),\n        tempQuat = new THREE.Quaternion(),\n        tempQuatArray = new Float32Array(4),\n        upVector = new THREE.Vector3(0, 1, 0);\n    var groundQuat = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1, 0, 0), -Math.PI / 2);\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function getCamera() {\n        return camera;\n    }\n\n    function nop() {}\n\n    function setCamera3d(value) {\n        if (value && camera !== camera3d) {\n            camera = camera3d;\n            copyCamera(camera2d, camera);\n        } else if (!value && camera === camera3d) {\n            camera = camera2d;\n            copyCamera(camera3d, camera);\n        }\n        updateQuaternionData();\n    }\n\n    function updateQuaternionData() {\n        camera.quaternion.toArray(cameraQuaternionData.array);\n        cameraQuaternionData.forwardMovement.set(0, 0, 1);\n        cameraQuaternionData.forwardMovement.applyQuaternion(camera.quaternion);\n    }\n\n    function getCameraQuaternionData() {\n        if (!camera.quaternion.equals(lastQuat)) {\n            updateQuaternionData();\n            lastQuat.copy(camera.quaternion);\n        }\n        return cameraQuaternionData;\n    }\n\n    function initCameras() {\n        camera2d.position.set(0, 0, 400);\n        camera3d.position.set(0, 0, 400);\n    }\n\n    function isCamera3d() {\n        return camera === camera3d;\n    }\n\n    function copyCamera(from, to) {\n        to.position.copy(from.position);\n        to.quaternion.copy(from.quaternion);\n    }\n\n    function getCameraPosition() {\n        return {\n            'is3d': isCamera3d(),\n            'position': camera.position.toArray(),\n            'quaternion': camera.quaternion.toArray()\n        };\n    }\n\n    function setCameraPosition(data) {\n        setCamera3d(data.is3d);\n        camera.quaternion.fromArray(data.quaternion);\n        camera.position.fromArray(data.position);\n        camera.updateProjectionMatrix();\n    }\n\n    function shadowQuatArray(x, y) {\n        var angle = -Math.atan2(y - camera.position.z, x - camera.position.x) - Math.PI / 2;\n        tempQuat.setFromAxisAngle(upVector, angle);\n        tempQuat.multiply(groundQuat);\n        return tempQuat.toArray(tempQuatArray);\n    }\n\n    function quaternionArrays() {\n        var quaternions = {};\n        quaternions.groundQuaternionArray = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1, 0, 0), -Math.PI / 2).toArray(new Float32Array(4));\n        quaternions.southQuaternionArray = new THREE.Quaternion().toArray(new Float32Array(4));\n        quaternions.northQuaternionArray = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 1, 0), -Math.PI).toArray(new Float32Array(4));\n        quaternions.westQuaternionArray = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 1, 0), -Math.PI / 2).toArray(new Float32Array(4));\n        quaternions.eastQuaternionArray = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 1, 0), Math.PI / 2).toArray(new Float32Array(4));\n        quaternions.ceilingQuaternionArray = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1, 0, 0), Math.PI / 2).toArray(new Float32Array(4));\n        return quaternions;\n    }\n\n    function checkWindowSize(width, height) {\n        if (gameWidth !== width || gameHeight !== height) {\n            gameWidth = width;\n            gameHeight = height;\n            camera2d.left = -gameWidth / 2;\n            camera2d.right = gameWidth / 2;\n            camera2d.top = gameHeight / 2;\n            camera2d.bottom = -gameHeight / 2;\n            camera2d.updateProjectionMatrix();\n            camera3d.aspect = gameWidth / gameHeight;\n            camera3d.updateProjectionMatrix();\n        }\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    function Camera() {}\n\n    Camera.setCamera3d = setCamera3d;\n    Camera.isCamera3d = isCamera3d;\n    Camera.getCamera = getCamera;\n    Camera.setCameraPosition = setCameraPosition;\n    Camera.getCameraPosition = getCameraPosition;\n    Camera.getCameraQuaternionData = getCameraQuaternionData;\n    Camera.shadowQuatArray = shadowQuatArray;\n    Camera.quaternions = quaternionArrays();\n    Camera.checkWindowSize = checkWindowSize;\n\n    /**\n     *   PROCESSES\n     */\n    initCameras();\n    setCamera3d(true);\n\n    return Camera;\n});\n//# sourceMappingURL=camera.js.map;\n\n\ndefine('objectpool',['utils'], function (Utils) {\n\n    /**\n     *  CLASS DEFINITIONS\n     */\n    function ObjectPool(classObject) {\n        this.pool = [];\n        this.classObject = classObject;\n    }\n    ObjectPool.prototype.classObject = null;\n    ObjectPool.prototype.pool = null;\n    ObjectPool.prototype.index = 0;\n    ObjectPool.prototype.create = create;\n    ObjectPool.prototype.recycleAll = recycleAll;\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function create() {\n        if (this.index >= this.pool.length) {\n            this.pool.push(new this.classObject());\n        }\n        return this.pool[this.index++];\n    }\n\n    function recycleAll() {\n        this.index = 0;\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    return ObjectPool;\n});\n//# sourceMappingURL=objectpool.js.map;\n\n\ndefine('spriteobject',['threejs', 'objectpool'], function (THREE, ObjectPool) {\n    'use strict';\n\n    function SpriteObject() {\n        this.position = new THREE.Vector3();\n        this.size = new Float32Array(3).fill(0);\n        this.size[2] = 1;\n        this.quaternionArray = new Float32Array(4).fill(0);\n    }\n\n    function initSpriteObject(spriteObject, x, y, z, width, height, quaternionArray, img, light, wave) {\n        spriteObject.position.x = x;\n        spriteObject.position.y = y;\n        spriteObject.position.z = z;\n        spriteObject.size[0] = width;\n        spriteObject.size[1] = height;\n        spriteObject.hasQuaternionArray = quaternionArray !== null;\n        if (spriteObject.hasQuaternionArray) {\n            spriteObject.quaternionArray[0] = quaternionArray[0];\n            spriteObject.quaternionArray[1] = quaternionArray[1];\n            spriteObject.quaternionArray[2] = quaternionArray[2];\n            spriteObject.quaternionArray[3] = quaternionArray[3];\n        }\n        spriteObject.img = img;\n        spriteObject.light = light;\n        spriteObject.wave = wave;\n    }\n\n    SpriteObject.prototype.position = null;\n    SpriteObject.prototype.size = null;\n    SpriteObject.prototype.hasQuaternionArray = false;\n    SpriteObject.prototype.quaternionArray = null;\n    SpriteObject.prototype.light = 1;\n    SpriteObject.prototype.wave = 0;\n    SpriteObject.prototype.img = -1;\n    SpriteObject.prototype.offset = null;\n    SpriteObject.prototype.visible = true;\n\n    var objectPool = new ObjectPool(SpriteObject);\n\n    SpriteObject.create = function (x, y, z, width, height, quaternionArray, img, light, wave) {\n        var spriteObject = objectPool.create();\n        initSpriteObject(spriteObject, x, y, z, width, height, quaternionArray, img, light, wave);\n        return spriteObject;\n    };\n\n    SpriteObject.clear = function () {\n        objectPool.recycleAll();\n    };\n\n    return SpriteObject;\n});\n//# sourceMappingURL=spriteobject.js.map;\n\n\ndefine('packer',['utils'], function (Utils) {\n\n    'use strict';\n\n    var MAX_TEXTURES = 16;\n    var SPRITE_SHEET_SIZE = 2048;\n    var CHUNKSIZES = 8;\n\n    var chunks = [];\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n\n    function doesFit(tex, x, y, width, height) {\n        if (x + width > SPRITE_SHEET_SIZE || y + height > SPRITE_SHEET_SIZE) return false;\n\n        if (chunks[tex]) {\n            for (var xi = 0; xi < width; xi++) {\n                if (chunks[tex][x + xi]) {\n                    for (var yi = 0; yi < height; yi++) {\n                        if (chunks[tex][x + xi][y + yi]) {\n                            return false;\n                        }\n                    }\n                }\n            }\n        }\n\n        return true;\n    }\n\n    function findSlot(canvas) {\n        if (canvas.width <= 1 && canvas.height <= 1) {\n            return null;\n        }\n        if (canvas.width > SPRITE_SHEET_SIZE || canvas.height > SPRITE_SHEET_SIZE) {\n            return null;\n        }\n        var chunkWidth = Math.ceil(canvas.width / CHUNKSIZES);\n        var chunkHeight = Math.ceil(canvas.height / CHUNKSIZES);\n\n        for (var tex = 0; tex < MAX_TEXTURES; tex++) {\n            for (var x = 0; x < SPRITE_SHEET_SIZE / CHUNKSIZES - chunkWidth; x++) {\n                for (var y = 0; y < SPRITE_SHEET_SIZE / CHUNKSIZES - chunkHeight; y++) {\n                    if (doesFit(tex, x, y, chunkWidth, chunkHeight)) {\n                        return { tex: tex, x: x * CHUNKSIZES, y: y * CHUNKSIZES };\n                    }\n                }\n            }\n        }\n        return null;\n    }\n\n    function fillSlot(tex, x, y, canvas) {\n        if (!chunks[tex]) chunks[tex] = [];\n        var chunkWidth = Math.ceil((canvas.width + 1) / CHUNKSIZES);\n        var chunkHeight = Math.ceil((canvas.height + 1) / CHUNKSIZES);\n\n        for (var xi = 0; xi < chunkWidth; xi++) {\n            if (!chunks[tex][x / CHUNKSIZES + xi]) chunks[tex][x / CHUNKSIZES + xi] = [];\n            for (var yi = 0; yi < chunkHeight; yi++) {\n                chunks[tex][x / CHUNKSIZES + xi][y / CHUNKSIZES + yi] = canvas;\n            }\n        }\n    }\n\n    function getSlot(canvas) {\n        var slot = findSlot(canvas);\n        if (slot) {\n            fillSlot(slot.tex, slot.x, slot.y, canvas);\n        }\n        return slot;\n    }\n\n    function destroyEverything() {\n        chunks.length = 0;\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    function Packer() {}\n\n    Packer.getSlot = getSlot;\n\n    Utils.onDestroy(destroyEverything);\n\n    /**\n     *   PROCESSES\n     */\n\n    return Packer;\n});\n//# sourceMappingURL=packer.js.map;\n\n\ndefine('gifhandler',['utils', 'loop', 'gifworker', 'jsgif/gif'], function (Utils, Loop, gifWorker, JSGif) {\n    'use strict';\n\n    var gifs = {};\n\n    /**\n     *  CLASS DEFINITIONS\n     */\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function isGif(src) {\n        return gifs[src] && gifs[src].block || src.split(\"?\")[0].slice(-4).toLowerCase() === \".gif\" || src.indexOf(\"data:image/gif;\") === 0;\n    }\n\n    function getGif(src) {\n        if (!gifs[src]) {\n            gifs[src] = new GifImage(src);\n        }\n        return gifs[src];\n    }\n\n    function GifImage(src) {\n        var self = this;\n\n        var gifInfo = {\n            maxFrameCompleted: 0,\n            framesProcessed: 0,\n            header: null,\n            frameInfos: [],\n            block: null,\n            canvases: [],\n            callbacks: [],\n            frameSlot: null,\n            processNextFrame: function processNextFrame() {\n                var frame = this.framesProcessed;\n                var frameInfo = this.frameInfos[frame];\n\n                if (frameInfo && frameInfo.gce && frameInfo.img && this.header) {\n                    var canvas = document.createElement(\"canvas\");\n                    canvas.style.position = \"absolute\";\n                    canvas.style.left = 0;\n                    canvas.style.top = 0;\n                    canvas.width = this.header.width;\n                    canvas.height = this.header.height;\n                    var ctx = canvas.getContext(\"2d\");\n                    ctx.webkitImageSmoothingEnabled = false;\n                    ctx.imageSmoothingEnabled = false;\n                    ctx.msImageSmoothingEnabled = false;\n\n                    this.canvases[frame] = canvas;\n                    if (frame > 0) {\n                        //  copy previous frame. That's how gifs work\n                        ctx.drawImage(this.canvases[frame - 1], 0, 0);\n                    }\n\n                    var cData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n                    var self = this;\n                    var processNext = this.processNextFrame.bind(this);\n                    gifWorker.send(frameInfo, cData, this.header, function (cData, frameInfo) {\n                        ctx.putImageData(cData, 0, 0);\n                        if (self.callbacks[frameInfo.frame]) {\n                            self.callbacks[frameInfo.frame]();\n                        }\n                        self.maxFrameCompleted = frameInfo.frame;\n                        self.frameInfos[frameInfo.frame].ready = true;\n                        processNext();\n                    });\n                    this.framesProcessed++;\n                    //                    document.body.appendChild(canvas);\n                }\n            },\n            hdr: function hdr(_hdr) {\n                this.header = _hdr;\n                self.width = this.header.width;\n                self.height = this.header.height;\n            },\n            gce: function gce(_gce) {\n                if (this.frameInfos.length === 0 || this.frameInfos[this.frameInfos.length - 1].gce) {\n                    this.frameInfos.push({\n                        gce: null,\n                        cycleTime: null,\n                        img: null,\n                        frame: this.frameInfos.length,\n                        ready: false\n                    });\n                }\n                var currentIndex = this.frameInfos.length - 1;\n                this.frameInfos[currentIndex].gce = _gce;\n                if (!_gce.delayTime) {\n                    _gce.delayTime = 1;\n                }\n                this.frameInfos[currentIndex].cycleTime = _gce.delayTime * 10 + (currentIndex === 0 ? 0 : this.frameInfos[currentIndex - 1].cycleTime);\n                this.processNextFrame();\n            },\n            img: function img(_img) {\n                if (this.frameInfos.length === 0 || this.frameInfos[this.frameInfos.length - 1].img) {\n                    this.frameInfos.push({});\n                }\n                this.frameInfos[this.frameInfos.length - 1].img = _img;\n                this.processNextFrame();\n            },\n            eof: function eof(block) {\n                this.block = block;\n                this.processNextFrame();\n            }\n        };\n\n        Utils.loadAsync(src, function (content) {\n            JSGif.parseGIF(new JSGif.Stream(content), gifInfo);\n        }, true);\n\n        this.frameInfos = gifInfo.frameInfos;\n        this.canvases = gifInfo.canvases;\n        this.callbacks = gifInfo.callbacks;\n        this.gifInfo = gifInfo;\n    }\n    GifImage.prototype.width = 0;\n    GifImage.prototype.height = 0;\n    GifImage.prototype.frameInfos = [];\n    GifImage.prototype.canvases = [];\n    GifImage.prototype.callbacks = [];\n    GifImage.prototype.gifInfo = null;\n    GifImage.prototype.getFrame = GifImage_getFrame;\n\n    function GifImage_getFrame(time) {\n        var gifInfo = this.gifInfo;\n\n        if (gifInfo.block) {\n            var totalAnimationTime = this.frameInfos[this.frameInfos.length - 1].cycleTime;\n            if (!gifInfo.frameSlot) {\n                gifInfo.frameSlot = [];\n                var cycle = 0;\n                for (var frame = 0; frame < this.frameInfos.length; frame++) {\n                    while (gifInfo.frameSlot.length < this.frameInfos[frame].cycleTime) {\n                        gifInfo.frameSlot.push(frame);\n                    }\n                }\n            }\n            var timeInCycle = Math.floor(time % totalAnimationTime);\n            return gifInfo.frameSlot[timeInCycle];\n        }\n        return gifInfo.maxFrameCompleted;\n    }\n\n    function destroyEverything() {\n        gifs = {};\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    function GifHandler() {}\n\n    GifHandler.getGif = getGif;\n    GifHandler.isGif = isGif;\n    Utils.onDestroy(destroyEverything);\n\n    return GifHandler;\n});\n//# sourceMappingURL=gifhandler.js.map;\n\n\ndefine('loader',['utils', 'loop'], function (Utils, Loop) {\n    'use strict';\n\n    var index = 0;\n    var imageQueue = [];\n    var loadLimit = 3;\n    var loading = 0;\n    var loadingBar = null;\n    var visualProgress = 0;\n    var onLoadCallback = null;\n    var loaded = 0;\n    var loadTotal = 0;\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function setOnLoad(onLoad) {\n        onLoadCallback = onLoad;\n        document.body.removeChild(getLoadingBar());\n    }\n\n    function loadImage(url, onLoad) {\n        var image = new Image();\n        image.onload = function (event) {\n            onLoad.call(image, event);\n            loading--;\n            loaded++;\n            checkLoad();\n        };\n        image.crossOrigin = '';\n        imageQueue.push({\n            image: image,\n            url: url\n        });\n        loadTotal++;\n        checkLoad();\n        return image;\n    }\n\n    function loadFile(url, onLoad) {\n        loadTotal++;\n        Utils.loadAsync(url, function (result) {\n            loaded++;\n            onLoad(result);\n        });\n    }\n\n    function checkLoad() {\n        while (index < imageQueue.length && loading < loadLimit) {\n            imageQueue[index].image.src = imageQueue[index].url;\n            index++;\n            loading++;\n        }\n        if (index === imageQueue.length) {\n            index = 0;\n            imageQueue.length = 0;\n            loaded = 0;\n            loadTotal = 0;\n        }\n    }\n\n    function getLoadingProgress() {\n        return !loadTotal ? 1 : loaded / loadTotal;\n    }\n\n    function refreshLoadingBar() {\n        if (loadingBar) {\n            var ctx = loadingBar.getContext(\"2d\");\n            var actualProgress = getLoadingProgress();\n            visualProgress = Math.max(0, visualProgress + (actualProgress - visualProgress) / 10);\n            if (actualProgress >= 1) {\n                visualProgress = 1;\n                Loop.removeLoop(refreshLoadingBar);\n            }\n            ctx.fillRect(10, 10, (loadingBar.width - 20) * visualProgress, loadingBar.height - 20);\n\n            if (actualProgress >= 1) {\n                if (onLoadCallback) {\n                    setTimeout(onLoadCallback, 100);\n                }\n            }\n        }\n    }\n\n    function getLoadingBar() {\n        if (!loadingBar) {\n            loadingBar = document.createElement(\"canvas\");\n            loadingBar.id = \"loading\";\n            loadingBar.width = Math.round(innerWidth * 2 * 2 / 3);\n            loadingBar.height = 50;\n            loadingBar.style.left = innerWidth / 2 - loadingBar.width / 4 + \"px\";\n            loadingBar.style.top = innerHeight / 2 - loadingBar.height / 4 + \"px\";\n            loadingBar.style.width = loadingBar.width / 2 + \"px\";\n            loadingBar.style.height = loadingBar.height / 2 + \"px\";\n            loadingBar.style.position = \"absolute\";\n            loadingBar.style.backgroundColor = \"white\";\n            loadingBar.style.border = \"10px double #00DDDD\";\n            var ctx = loadingBar.getContext(\"2d\");\n            ctx.fillStyle = \"#0066aa\";\n            Loop.addLoop(refreshLoadingBar);\n        }\n        document.body.appendChild(loadingBar);\n        return loadingBar;\n    }\n\n    function destroyEverything() {\n        imageQueue.length = 0;\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    function Loader() {}\n\n    Loader.loadImage = loadImage;\n    Loader.loadFile = loadFile;\n    Loader.getLoadingProgress = getLoadingProgress;\n    Loader.getLoadingBar = getLoadingBar;\n    Loader.setOnLoad = setOnLoad;\n\n    Utils.onDestroy(destroyEverything);\n\n    return Loader;\n});\n//# sourceMappingURL=loader.js.map;\n\n\ndefine('spritesheet',['threejs', 'utils', 'gifhandler', 'loader', 'packer'], function (THREE, Utils, GifHandler, Loader, Packer) {\n    'use strict';\n\n    var canvases = {};\n    var cuts = {};\n    var cutArray = [];\n    var cutCount = 0;\n\n    var textures = [null];\n    var slots = {};\n    var SPRITE_SHEET_SIZE = 2048;\n    var planeGeometry = new THREE.PlaneBufferGeometry(1, 1);\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function getCanvas(url, canCreate) {\n        if (!canvases[url] && canCreate) {\n            var canvas = canvases[url] = document.createElement('canvas');\n            canvas.setAttribute(\"url\", url);\n            if (url.indexOf(\"tex-\") === 0) {\n                canvas.width = canvas.height = SPRITE_SHEET_SIZE;\n                var index = parseInt(url.split(\"-\").pop());\n                var tex = new THREE.Texture(canvas);\n                tex.magFilter = THREE.NearestFilter;\n                tex.minFilter = THREE.LinearMipMapLinearFilter;\n                canvas.addEventListener(\"update\", updateTextureEvent);\n                textures[index] = tex;\n                canvas.setAttribute(\"texture\", index.toString());\n                canvas.style.position = \"absolute\";\n                canvas.style.left = 0;\n                canvas.style.top = 0;\n\n                //                document.body.appendChild(canvas);\n            } else {\n                canvas.width = canvas.height = 1;\n            }\n            initCanvas(canvas);\n        }\n        return canvases[url];\n    }\n\n    function initCanvas(canvas) {\n        var context = canvas.getContext(\"2d\");\n        context.webkitImageSmoothingEnabled = false;\n        context.imageSmoothingEnabled = false;\n        context.msImageSmoothingEnabled = false;\n    }\n\n    function customEvent(type, detail) {\n        var evt = document.createEvent(\"CustomEvent\");\n        evt.initCustomEvent(type, false, false, detail || {});\n        return evt;\n    }\n\n    function fetchCanvas(urlpipe, frame) {\n        var canvas = getCanvas(frame + \":\" + urlpipe.join(\"|\"));\n        if (canvas) {\n            return canvas;\n        }\n\n        if (urlpipe.length > 1) {\n            canvas = getCanvas(frame + \":\" + urlpipe.join(\"|\"), true);\n            var subpipe = urlpipe.slice(0, urlpipe.length - 1);\n            var processString = urlpipe[urlpipe.length - 1];\n            var subCanvas = fetchCanvas(subpipe, frame);\n            canvas.setAttribute(\"base-url\", subCanvas.getAttribute(\"base-url\"));\n            processCanvas(subCanvas, processString, canvas);\n            subCanvas.addEventListener(\"update\", function (event) {\n                var subCanvas = event.currentTarget;\n                processCanvas(subCanvas, processString, canvas);\n                canvas.dispatchEvent(customEvent(\"update\"));\n            });\n            return canvas;\n        } else {\n            var url = urlpipe[0];\n            canvas = getCanvas(frame + \":\" + url, true);\n\n            //  check for width x height\n            var size = url.split(\"x\");\n            if (size.length === 2 && !isNaN(parseInt(size[0])) && !isNaN(parseInt(size[1]))) {\n                canvas.width = parseInt(size[0]);\n                canvas.height = parseInt(size[1]);\n            } else if (GifHandler.isGif(url)) {\n                var gif = GifHandler.getGif(url);\n                canvas.setAttribute(\"animated\", true);\n                canvas.setAttribute(\"base-url\", url);\n                if (gif.frameInfos[frame] && gif.frameInfos[frame].ready) {\n                    drawGif(gif, frame, canvas);\n                } else {\n                    gif.callbacks[frame] = drawGif.bind(null, gif, frame, canvas);\n                }\n            } else {\n                canvas.setAttribute(\"base-url\", url);\n                var image = Loader.loadImage(url, function () {\n                    canvas.width = image.naturalWidth;\n                    canvas.height = image.naturalHeight;\n                    initCanvas(canvas);\n                    canvas.getContext(\"2d\").drawImage(image, 0, 0);\n                    //                    document.body.appendChild(canvas);\n                    canvas.dispatchEvent(customEvent(\"update\"));\n                });\n            }\n            return canvas;\n        }\n    }\n\n    function drawGif(gif, frame, canvas) {\n        canvas.width = gif.width;\n        canvas.height = gif.height;\n        initCanvas(canvas);\n        canvas.getContext(\"2d\").drawImage(gif.canvases[frame], 0, 0);\n        canvas.dispatchEvent(customEvent(\"update\"));\n    }\n\n    function processCanvas(canvas, processString, outputCanvas) {\n        //  check size split\n        processString = processString.split(\"?\")[0];\n        var outputCtx = outputCanvas.getContext(\"2d\");\n        var splits = processString.split(\",\");\n        if (splits.length === 4 && splits.every(function (num) {\n            return !isNaN(num);\n        })) {\n            splits = splits.map(function (o) {\n                return parseInt(o);\n            });\n            var drawWidth = Math.min(canvas.width - splits[0], splits[2]);\n            var drawHeight = Math.min(canvas.height - splits[1], splits[3]);\n            if (drawWidth > 0 && drawHeight > 0) {\n                outputCanvas.width = drawWidth;\n                outputCanvas.height = drawHeight;\n                initCanvas(outputCanvas);\n                outputCtx.drawImage(canvas, splits[0], splits[1], drawWidth, drawHeight, 0, 0, drawWidth, drawHeight);\n            }\n        } else if (processString.indexOf(\"scale:\") === 0) {\n            if (canvas.width > 1 && canvas.height > 1) {\n                var scale = processString.split(\":\")[1].split(\",\");\n                outputCanvas.width = Math.ceil(canvas.width * Math.abs(scale[0]));\n                outputCanvas.height = Math.ceil(canvas.height * Math.abs(scale[1 % scale.length]));\n                initCanvas(outputCanvas);\n                if (scale[0] < 0 || scale[1 % scale.length] < 0) {\n                    var sign = [scale[0] < 0 ? -1 : 1, scale[1 % scale.length] < 0 ? -1 : 1];\n                    outputCtx.translate(sign[0] < 0 ? outputCanvas.width : 0, sign[1] < 0 ? outputCanvas.height : 0);\n                    outputCtx.scale(sign[0], sign[1]);\n                }\n                outputCtx.drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, outputCanvas.width, outputCanvas.height);\n                outputCtx.restore();\n            }\n        } else if (processString.indexOf(\"border\") === 0) {\n            outputCanvas.width = canvas.width;\n            outputCanvas.height = canvas.height;\n            initCanvas(outputCanvas);\n            var borderWidth = processString.split(\":\")[1] || 1;\n            if (borderWidth.indexOf(\"%\") > 0) {\n                borderWidth = Math.round(parseFloat(borderWidth.split(\"%\")[0]) / 100 * Math.min(outputCanvas.width, outputCanvas.height));\n            }\n            outputCtx.drawImage(canvas, 0, 0);\n            outputCtx.beginPath();\n            for (var i = 0; i < borderWidth; i++) {\n                outputCtx.rect(i, i, canvas.width - 1 - i * 2, canvas.height - 1 - i * 2);\n            }\n            outputCtx.stroke();\n        } else if (processString.indexOf(\"text:\") === 0) {\n            outputCanvas.width = canvas.width;\n            outputCanvas.height = canvas.height;\n            initCanvas(outputCanvas);\n            outputCtx.fillStyle = \"#000000\";\n            outputCtx.font = '18px Comic';\n            outputCtx.fillText(processString.split(\"text:\")[1], 0, canvas.height);\n        } else if (processString.indexOf(\"shadow\") === 0) {\n            outputCanvas.width = canvas.width;\n            outputCanvas.height = canvas.height;\n            initCanvas(outputCanvas);\n            var ctx = canvas.getContext(\"2d\");\n            var data = ctx.getImageData(0, 0, canvas.width, canvas.height);\n            for (var _i = 0; _i < data.data.length; _i += 4) {\n                if (data.data[_i + 3] !== 0) {\n                    data.data[_i] = 0;\n                    data.data[_i + 1] = 0;\n                    data.data[_i + 2] = 0;\n                    data.data[_i + 3] = 127;\n                }\n            }\n            outputCtx.putImageData(data, 0, 0);\n        } else if (processString.indexOf(\"cross\") === 0) {\n            outputCanvas.width = canvas.width;\n            outputCanvas.height = canvas.height;\n            initCanvas(outputCanvas);\n            outputCtx.drawImage(canvas, 0, 0);\n            outputCtx.beginPath();\n            outputCtx.moveTo(canvas.width / 2, 0);\n            outputCtx.lineTo(canvas.width / 2, canvas.height);\n            outputCtx.moveTo(0, canvas.height / 2);\n            outputCtx.lineTo(canvas.width, canvas.height / 2);\n            outputCtx.stroke();\n        }\n    }\n\n    function getCut(index, time) {\n        var cut = cutArray[index];\n        var frame = cut && cut.gif ? cut.gif.getFrame(time) : 0;\n        if (cut && cut.cut[frame] && cut.cut[frame].ready) {\n            return cut.cut[frame];\n        }\n        if (cut && cut.url) {\n            cut = getCutByURL(cut.url, frame);\n            return cut.cut[frame];\n        }\n        return null;\n    }\n\n    function getCutByURL(url, frame) {\n        if (cuts[url] && cuts[url].cut[frame] && cuts[url].cut[frame].ready) {\n            return cuts[url];\n        }\n\n        var canvas = fetchCanvas(url.split(\"|\"), frame);\n        var slot = Packer.getSlot(canvas);\n\n        var cut = cuts[url];\n        if (!cut) {\n            cut = {\n                index: cutCount++,\n                url: url,\n                baseUrl: null,\n                cut: [],\n                animated: false\n            };\n            cuts[url] = cut;\n            cutArray[cut.index] = cut;\n        }\n        if (!cut.cut[frame]) {\n            cut.cut[frame] = {\n                tex: 0, uv: null, ready: false,\n                url: url, baseUrl: null\n            };\n        }\n\n        if (slot) {\n            slots[canvas.getAttribute(\"url\")] = slot;\n            canvas.addEventListener(\"update\", updateSpritesheetEvent);\n            canvas.dispatchEvent(customEvent(\"update\"));\n\n            var uvX = slot.x / SPRITE_SHEET_SIZE;\n            var uvY = slot.y / SPRITE_SHEET_SIZE;\n            var uvW = (canvas.width - 1) / SPRITE_SHEET_SIZE;\n            var uvH = (canvas.height - 1) / SPRITE_SHEET_SIZE;\n            var uvOrder = planeGeometry.attributes.uv.array;\n\n            var cutcut = [uvX, 1 - uvY - uvH, uvX + uvW, 1 - uvY];\n\n            cut.gif = canvas.getAttribute(\"animated\") === \"true\" ? GifHandler.getGif(cut.url) : null;\n            cut.cut[frame].baseUrl = cut.baseUrl = canvas.getAttribute(\"base-url\");\n            cut.cut[frame].tex = slot.tex;\n            cut.cut[frame].uv = new Float32Array(uvOrder.length);\n            for (var u = 0; u < uvOrder.length; u++) {\n                cut.cut[frame].uv[u] = cutcut[uvOrder[u] * 2 + u % 2];\n            }\n            cut.cut[frame].ready = true;\n            return cut;\n        } else {\n            return cut;\n        }\n    }\n\n    function preLoad(images, root) {\n        if (root === undefined) {\n            root = SpriteSheet.spritesheet;\n        }\n        if (typeof images === \"string\") {\n            var cut = getCutByURL(images, 0);\n            if (cut) {\n                return cut.index;\n            }\n        } else {\n            for (var prop in images) {\n                if (images.hasOwnProperty(prop)) {\n                    if (!root[prop]) {\n                        root[prop] = [];\n                    }\n                    var index = SpriteSheet.preLoad(images[prop], root[prop]);\n                    if (index !== null) {\n                        root[prop] = index;\n                    }\n                }\n            }\n            return root;\n        }\n    }\n\n    function updateSpritesheetEvent(event) {\n        var canvas = event.currentTarget;\n        var url = canvas.getAttribute(\"url\");\n        var slot = slots[url];\n        var spritesheet = getCanvas(\"tex-\" + slot.tex, true);\n        spritesheet.getContext(\"2d\").drawImage(canvas, slot.x, slot.y);\n        spritesheet.dispatchEvent(customEvent(\"update\"));\n    }\n\n    function updateTextureEvent(event) {\n        var canvas = event.currentTarget;\n        textures[parseInt(canvas.getAttribute(\"texture\"))].needsUpdate = true;\n    }\n\n    function destroyEverything() {\n        textures.forEach(function (tex) {\n            if (tex) tex.dispose();\n        });\n        canvases = {};\n        cuts = {};\n        slots = {};\n        textures = [null];\n    }\n\n    function getTextures() {\n        return textures;\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    function SpriteSheet() {}\n\n    SpriteSheet.getCut = getCut;\n    SpriteSheet.getTextures = getTextures;\n    SpriteSheet.preLoad = preLoad;\n    SpriteSheet.fetchCanvas = fetchCanvas;\n    SpriteSheet.spritesheet = {};\n\n    Utils.onDestroy(destroyEverything);\n\n    return SpriteSheet;\n});\n//# sourceMappingURL=spritesheet.js.map;\n\n\ndefine('turbosort',[],function () {\n\n    var SIZE = 1000000;\n    var buckets = new Uint32Array(SIZE + 1);\n    var counts = new Uint32Array(SIZE + 1);\n    var indexFunction = identity;\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function getMinMax(array, offset, length) {\n        var firstIndex = indexFunction(array[offset]);\n        var minNum = firstIndex;\n        var maxNum = firstIndex;\n        var previousNum = firstIndex;\n        var inOrder = true;\n        for (var i = 1; i < length; i++) {\n            var index = indexFunction(array[offset + i]);\n            if (previousNum > index) {\n                inOrder = false;\n                if (index < minNum) {\n                    minNum = index;\n                }\n            } else {\n                if (index > maxNum) {\n                    maxNum = index;\n                }\n            }\n            previousNum = index;\n        }\n        min_max_result.min = minNum;\n        min_max_result.max = maxNum;\n        min_max_result.inOrder = inOrder;\n        return min_max_result;\n    }\n    var min_max_result = {\n        min: 0,\n        max: 0,\n        inOrder: false\n    };\n\n    function identity(a) {\n        return a;\n    }\n\n    function turboSort(array, size, func) {\n        if (array) {\n            size = size ? Math.min(size, array.length) : array.length;\n            if (size > 1) {\n                indexFunction = func ? func : identity;\n                turboSortHelper(array, 0, size ? size : array.length);\n            }\n        }\n    }\n\n    function turboSortHelper(array, offset, length) {\n        var arrayInfo = getMinMax(array, offset, length);\n        if (arrayInfo.inOrder) {\n            return;\n        }\n        var min = arrayInfo.min;\n        var max = arrayInfo.max;\n        var range = max - min;\n        if (range === 0) {\n            return;\n        }\n\n        var bucketSize = Math.min(length, SIZE);\n\n        var i = void 0,\n            index = void 0;\n        for (i = 0; i < bucketSize; i++) {\n            counts[i] = 0;\n        }\n        counts[bucketSize] = 1;\n        for (i = 0; i < length; i++) {\n            index = Math.floor((bucketSize - 1) * (indexFunction(array[i + offset]) - min) / range);\n            counts[index]++;\n        }\n\n        for (i = 0; i < bucketSize; i++) {\n            buckets[i] = 0;\n        }\n        buckets[bucketSize] = offset + length;\n        buckets[0] = offset;\n        for (i = 1; i < bucketSize; i++) {\n            buckets[i] = buckets[i - 1] + counts[i - 1];\n        }\n\n        var voyager = offset,\n            bucketId = 0;\n        while (bucketId < bucketSize) {\n            index = Math.floor((bucketSize - 1) * (indexFunction(array[voyager]) - min) / range);\n            var newSpot = buckets[index] + --counts[index];\n            swap(array, voyager, newSpot);\n            while (!counts[bucketId]) {\n                bucketId++;\n            }\n            voyager = buckets[bucketId];\n        }\n        for (i = 0; i < bucketSize; i++) {\n            counts[i] = buckets[i + 1] - buckets[i];\n        }\n        for (i = 0; i < bucketSize; i++) {\n            if (counts[i] > 1) {\n                turboSortHelper(array, buckets[i], counts[i]);\n            }\n        }\n    }\n\n    function swap(array, a, b) {\n        var temp = array[a];\n        array[a] = array[b];\n        array[b] = temp;\n    }\n    return turboSort;\n});\n//# sourceMappingURL=turbosort.js.map;\n\n\ndefine('shaders/fragment-shader.glsl',[],function () {\n    return \"\\n    \\nuniform sampler2D texture[ 16 ];\\nvarying vec2 vUv;\\nvarying float vTex;\\nvarying float vLight;\\n\\nvoid main() {\\n    vec2 uv = vUv;\\n\\n    int iTex = int(vTex);\\n\\n    if(iTex==0) {\\n        gl_FragColor = texture2D( texture[0],  uv);\\n    } else if(iTex==1) {\\n        gl_FragColor = texture2D( texture[1],  uv);\\n    } else if(iTex==2) {\\n        gl_FragColor = texture2D( texture[2],  uv);\\n    } else if(iTex==3) {\\n        gl_FragColor = texture2D( texture[3],  uv);\\n    } else if(iTex==4) {\\n        gl_FragColor = texture2D( texture[4],  uv);\\n    } else if(iTex==5) {\\n        gl_FragColor = texture2D( texture[5],  uv);\\n    } else if(iTex==6) {\\n        gl_FragColor = texture2D( texture[6],  uv);\\n    } else if(iTex==7) {\\n        gl_FragColor = texture2D( texture[7],  uv);\\n    } else if(iTex==8) {\\n        gl_FragColor = texture2D( texture[8],  uv);\\n    } else if(iTex==9) {\\n        gl_FragColor = texture2D( texture[9],  uv);\\n    } else if(iTex==10) {\\n        gl_FragColor = texture2D( texture[10],  uv);\\n    } else if(iTex==11) {\\n        gl_FragColor = texture2D( texture[11],  uv);\\n    } else if(iTex==12) {\\n        gl_FragColor = texture2D( texture[12],  uv);\\n    } else if(iTex==13) {\\n        gl_FragColor = texture2D( texture[13],  uv);\\n    } else if(iTex==14) {\\n        gl_FragColor = texture2D( texture[14],  uv);\\n    } else if(iTex==15) {\\n        gl_FragColor = texture2D( texture[15],  uv);\\n    }\\n\\n    gl_FragColor.x *= vLight;\\n    gl_FragColor.y *= vLight;\\n    gl_FragColor.z *= vLight;\\n//        gl_FragColor.w *= vLight;\\n//    gl_FragColor.w = .5;\\n}\\n\\n    \";\n});\n//# sourceMappingURL=fragment-shader.glsl.js.map;\n\n\ndefine('shaders/vertex-shader.glsl',[],function () {\n    return \"\\n    \\nvarying vec2 vUv;\\nattribute float tex;\\nattribute float light;\\nattribute float wave;\\nattribute vec3 spot;\\nattribute vec4 quaternion;\\nvarying float vTex;\\nvarying float vLight;\\nuniform vec3 vCam;\\nuniform float curvature;\\nuniform float time;\\n\\nvoid main()  {\\n    vTex = tex;\\n    vUv = uv;\\n\\n    vec3 newPosition = rotateVectorByQuaternion( position - spot, quaternion ) + spot;\\n    vLight = 1.0/ sqrt(500.0 / distance(newPosition, vCam)) * light;\\n\\n    float dist = distance(newPosition, vCam);\\n    if (curvature > 0.0) {\\n        newPosition.z = newPosition.z - curvature * (dist*dist)/20000.0;\\n    }\\n    if (wave > 0.0) {\\n        newPosition.z = newPosition.z + wave * sin(newPosition.x*5.0 - newPosition.y*7.0 + time);\\n    }\\n\\n    vec4 mvPosition = modelViewMatrix * vec4(newPosition, 1.0 );\\n    gl_Position = projectionMatrix * mvPosition;\\n}    \\n\\n    \";\n});\n//# sourceMappingURL=vertex-shader.glsl.js.map;\n\n\ndefine('shaders/vertex-shader-common.glsl',[],function () {\n    return \"\\n\\nvec3 rotateVectorByQuaternion( in vec3 v, in vec4 q ) {\\n\\n    vec3 dest = vec3( 0.0 );\\n\\n    float x = v.x, y  = v.y, z  = v.z;\\n    float qx = q.x, qy = q.y, qz = q.z, qw = q.w;\\n\\n    // calculate quaternion * vector\\n\\n    float ix =  qw * x + qy * z - qz * y,\\n          iy =  qw * y + qz * x - qx * z,\\n          iz =  qw * z + qx * y - qy * x,\\n          iw = -qx * x - qy * y - qz * z;\\n\\n    // calculate result * inverse quaternion\\n\\n    dest.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\\n    dest.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\\n    dest.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\\n\\n    return dest;\\n\\n}\\n\\nvec4 axisAngleToQuaternion( in vec3 axis, in float angle ) {\\n\\n    vec4 dest = vec4( 0.0 );\\n\\n    float halfAngle = angle / 2.0,\\n          s = sin( halfAngle );\\n\\n    dest.x = axis.x * s;\\n    dest.y = axis.y * s;\\n    dest.z = axis.z * s;\\n    dest.w = cos( halfAngle );\\n\\n    return dest;\\n\\n}    \\n    \\n    \";\n});\n//# sourceMappingURL=vertex-shader-common.glsl.js.map;\n\n\ndefine('shader',['shaders/fragment-shader.glsl', 'shaders/vertex-shader.glsl', 'shaders/vertex-shader-common.glsl'], function (fragmentShader, vertexShader, vertexShaderCommon) {\n    return {\n        fragmentShader: fragmentShader,\n        vertexShader: vertexShaderCommon + vertexShader\n    };\n});\n//# sourceMappingURL=shader.js.map;\n\n\ndefine('spriterenderer',['threejs', 'utils', 'spriteobject', 'spritesheet', 'camera', 'turbosort', 'shader', 'loop'], function (THREE, Utils, SpriteObject, SpriteSheet, Camera, turboSort, Shader, Loop) {\n    'use strict';\n\n    var planeGeometry = new THREE.PlaneBufferGeometry(1, 1);\n    var pointCount = planeGeometry.attributes.position.count;\n    var indices = planeGeometry.index.array;\n    var spriteRenderers = [];\n    var uniforms = null;\n    var indexProcessor = function indexProcessor() {};\n\n    /**\n     *  CLASS DEFINITIONS\n     */\n\n    function SpriteRenderer() {\n        this.images = [];\n        this.imageOrder = [];\n        this.imageCount = 0;\n        this.mesh = createMesh(this);\n        this.curvature = 0;\n\n        var self = this;\n\n        this.display = function (spriteObject) {\n            var index = self.imageCount;\n            var image = self.images[index];\n\n            var cut = spriteObject && spriteObject.visible ? SpriteSheet.getCut(spriteObject.img, image ? image.time + Loop.time : Loop.time) : null;\n            if (cut && cut.ready) {\n                if (!image) {\n                    image = self.images[index] = new SpriteImage();\n                    image.index = index;\n                    image.time = Math.random() * 10000 + Loop.time;\n\n                    for (var j = 0; j < indices.length; j++) {\n                        image.indexArray[j] = indices[j] + image.index * 4;\n                    }\n                }\n\n                var quat = spriteObject.hasQuaternionArray ? spriteObject.quaternionArray : Camera.getCameraQuaternionData().array;\n                if (image.quaternionArray[0] !== quat[0] || image.quaternionArray[1] !== quat[1] || image.quaternionArray[2] !== quat[2] || image.quaternionArray[3] !== quat[3]) {\n                    quat.splatter(image.quaternionArray, 0).splatter(image.quaternionArray, 4).splatter(image.quaternionArray, 8).splatter(image.quaternionArray, 12);\n                    image.quatDirty = true;\n                }\n\n                if (spriteObject.position.x !== image.position.x || spriteObject.position.y !== image.position.y || spriteObject.position.z !== image.position.z) {\n                    image.position.x = spriteObject.position.x;\n                    image.position.y = spriteObject.position.y;\n                    image.position.z = spriteObject.position.z;\n                    for (var i = 0; i < 4; i++) {\n                        image.spotArray[i * 3] = image.position.x;\n                        image.spotArray[i * 3 + 1] = image.position.y;\n                        image.spotArray[i * 3 + 2] = image.position.z;\n                    }\n                    image.positionDirty = true;\n                }\n\n                if (spriteObject.size[0] !== image.size[0] || spriteObject.size[1] !== image.size[1] || spriteObject.size[2] !== image.size[2] || image.positionDirty) {\n                    image.size[0] = spriteObject.size[0];\n                    image.size[1] = spriteObject.size[1];\n                    image.size[2] = spriteObject.size[2];\n                    var vertices = planeGeometry.attributes.position.array;\n                    for (var v = 0; v < vertices.length; v++) {\n                        image.vertices[v] = vertices[v] * spriteObject.size[v % 3] + image.spotArray[v];\n                    }\n                    image.verticesDirty = true;\n                }\n\n                if (image.uv !== cut.uv) {\n                    image.uv = cut.uv;\n                    image.uvDirty = true;\n                }\n\n                if (image.tex !== cut.tex) {\n                    image.tex = cut.tex;\n                    image.texDirty = true;\n                }\n\n                if (image.light !== spriteObject.light) {\n                    image.light = spriteObject.light;\n                    image.lightDirty = true;\n                }\n\n                if (image.wave !== spriteObject.wave) {\n                    image.wave = spriteObject.wave;\n                    image.waveDirty = true;\n                }\n\n                image.spriteObject = spriteObject;\n                self.imageOrder[index] = image;\n                self.imageCount++;\n            }\n            return image;\n        };\n\n        spriteRenderers.push(this);\n    }\n\n    SpriteRenderer.prototype.destroy = destroySprite;\n    SpriteRenderer.prototype.render = render;\n    SpriteRenderer.prototype.updateGraphics = updateGraphics;\n    SpriteRenderer.prototype.clear = clear;\n    SpriteRenderer.prototype.processGraphics = processGraphics;\n\n    function SpriteImage() {\n        this.position = new THREE.Vector3();\n        this.spotArray = new Float32Array(3 * pointCount);\n        this.size = new Float32Array(3);\n        this.vertices = new Float32Array(planeGeometry.attributes.position.array.length);\n        this.quaternionArray = new Float32Array(4 * pointCount);\n        this.indexArray = new Uint16Array(indices.length);\n    }\n    SpriteImage.prototype.index = 0;\n    SpriteImage.prototype.position = null;\n    SpriteImage.prototype.spotArray = null;\n    SpriteImage.prototype.indexArray = null;\n    SpriteImage.prototype.tex = -1;\n    SpriteImage.prototype.size = null;\n    SpriteImage.prototype.uv = null;\n    SpriteImage.prototype.vertices = null;\n    SpriteImage.prototype.light = 1;\n    SpriteImage.prototype.wave = 0;\n    SpriteImage.prototype.zIndex = 0;\n    SpriteImage.prototype.quaternionArray = null;\n    SpriteImage.prototype.positionDirty = true;\n    SpriteImage.prototype.verticesDirty = true;\n    SpriteImage.prototype.texDirty = true;\n    SpriteImage.prototype.uvDirty = true;\n    SpriteImage.prototype.lightDirty = true;\n    SpriteImage.prototype.waveDirty = true;\n    SpriteImage.prototype.quatDirty = true;\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n\n    function clear() {\n        this.imageCount = 0;\n        SpriteObject.clear();\n    }\n\n    function createMesh(spriteRenderer) {\n        var geometry = new THREE.BufferGeometry();\n        var vertices = new Float32Array([-1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, 1.0]);\n        geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\n        var mesh = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial());\n\n        mesh.material = new THREE.ShaderMaterial({\n            uniforms: uniforms = {\n                texture: {\n                    type: 'tv',\n                    get value() {\n                        return SpriteSheet.getTextures();\n                    }\n                },\n                vCam: {\n                    type: \"v3\",\n                    get value() {\n                        return Camera.getCamera().position;\n                    }\n                },\n                curvature: {\n                    type: \"f\",\n                    get value() {\n                        return spriteRenderer.curvature || 0;\n                    }\n                },\n                time: {\n                    type: \"f\",\n                    get value() {\n                        return performance.now() / 100;\n                    }\n                }\n            },\n            vertexShader: Shader.vertexShader,\n            fragmentShader: Shader.fragmentShader,\n            transparent: true,\n            depthWrite: false,\n            depthTest: true\n        });\n\n        mesh.frustumCulled = false;\n        return mesh;\n    }\n\n    function sortImages(images, count) {\n        var camera = Camera.getCamera();\n        for (var i = 0; i < count; i++) {\n            images[i].zIndex = -camera.position.distanceToManhattan(images[i].position);\n        }\n        indexProcessor(images, count);\n        turboSort(images, count, indexFunction);\n    }\n\n    function setIndexProcessor(fun) {\n        indexProcessor = fun ? fun : function () {};\n    }\n\n    function indexFunction(a) {\n        return a.zIndex;\n    }\n\n    function render() {\n        var imageCount = this.imageCount;\n        var pointCount = planeGeometry.attributes.position.count;\n        var previousAttribute = void 0;\n\n        var mesh = this.mesh;\n        var geometry = mesh.geometry;\n        if (!geometry.attributes.position || geometry.attributes.position.count < imageCount * pointCount) {\n            previousAttribute = geometry.attributes.position;\n            geometry.attributes.position = new THREE.BufferAttribute(new Float32Array(imageCount * pointCount * 3), 3);\n            if (previousAttribute) geometry.attributes.position.copyArray(previousAttribute.array);\n            geometry.attributes.position.setDynamic(true);\n        }\n        if (!geometry.attributes.spot || geometry.attributes.spot.count < imageCount * pointCount) {\n            previousAttribute = geometry.attributes.spot;\n            geometry.attributes.spot = new THREE.BufferAttribute(new Float32Array(imageCount * pointCount * 3), 3);\n            if (previousAttribute) geometry.attributes.spot.copyArray(previousAttribute.array);\n            geometry.attributes.spot.setDynamic(true);\n        }\n        if (!geometry.attributes.quaternion || geometry.attributes.quaternion.count < imageCount * pointCount) {\n            previousAttribute = geometry.attributes.quaternion;\n            geometry.attributes.quaternion = new THREE.BufferAttribute(new Float32Array(imageCount * pointCount * 4), 4);\n            if (previousAttribute) geometry.attributes.quaternion.copyArray(previousAttribute.array);\n            geometry.attributes.quaternion.setDynamic(true);\n        }\n        if (!geometry.attributes.uv || geometry.attributes.uv.count < imageCount * pointCount) {\n            previousAttribute = geometry.attributes.uv;\n            geometry.attributes.uv = new THREE.BufferAttribute(new Float32Array(imageCount * pointCount * 2), 2);\n            if (previousAttribute) geometry.attributes.uv.copyArray(previousAttribute.array);\n            geometry.attributes.uv.setDynamic(true);\n        }\n        if (!geometry.attributes.tex || geometry.attributes.tex.count < imageCount * pointCount) {\n            previousAttribute = geometry.attributes.tex;\n            geometry.attributes.tex = new THREE.BufferAttribute(new Float32Array(imageCount * pointCount), 1);\n            if (previousAttribute) geometry.attributes.tex.copyArray(previousAttribute.array);\n            geometry.attributes.tex.setDynamic(true);\n        }\n        if (!geometry.attributes.light || geometry.attributes.light.count < imageCount * pointCount) {\n            previousAttribute = geometry.attributes.light;\n            geometry.attributes.light = new THREE.BufferAttribute(new Float32Array(imageCount * pointCount), 1);\n            if (previousAttribute) geometry.attributes.light.copyArray(previousAttribute.array);\n            geometry.attributes.light.setDynamic(true);\n        }\n        if (!geometry.attributes.wave || geometry.attributes.wave.count < imageCount * pointCount) {\n            previousAttribute = geometry.attributes.wave;\n            geometry.attributes.wave = new THREE.BufferAttribute(new Float32Array(imageCount * pointCount), 1);\n            if (previousAttribute) geometry.attributes.wave.copyArray(previousAttribute.array);\n            geometry.attributes.wave.setDynamic(true);\n        }\n        if (!geometry.index || geometry.index.count < imageCount * planeGeometry.index.array.length) {\n            previousAttribute = geometry.index;\n            var _indices = planeGeometry.index.array;\n            geometry.index = new THREE.BufferAttribute(new Uint16Array(imageCount * _indices.length), 1);\n            if (previousAttribute) geometry.index.copyArray(previousAttribute.array);\n            geometry.index.setDynamic(true);\n        }\n\n        sortImages(this.imageOrder, imageCount);\n    }\n\n    function updateGraphics() {\n        this.render();\n        this.processGraphics();\n    }\n\n    function processGraphics() {\n        var images = this.images;\n        var imageOrder = this.imageOrder;\n        var imageCount = this.imageCount;\n        var geometry = this.mesh.geometry;\n        var geo_quaternion = geometry.attributes.quaternion.array;\n        var geo_spot = geometry.attributes.spot.array;\n        var geo_pos = geometry.attributes.position.array;\n        var geo_tex = geometry.attributes.tex.array;\n        var geo_light = geometry.attributes.light.array;\n        var geo_wave = geometry.attributes.wave.array;\n        var geo_uv = geometry.attributes.uv.array;\n        var geo_index = geometry.index.array;\n\n        var quatChanged = false;\n        var positionChanged = false;\n        var texChanged = false;\n        var verticesChanged = false;\n        var uvChanged = false;\n        var lightChanged = false;\n        var waveChanged = false;\n\n        for (var i = 0; i < imageCount; i++) {\n            var image = images[i];\n            var index = image.index;\n\n            if (image.quatDirty) {\n                image.quaternionArray.splatter(geo_quaternion, index * 16);\n                image.quatDirty = false;\n                quatChanged = true;\n            }\n\n            if (image.positionDirty) {\n                image.spotArray.splatter(geo_spot, index * 12);\n                image.positionDirty = false;\n                positionChanged = true;\n            }\n\n            if (image.verticesDirty) {\n                image.vertices.splatter(geo_pos, index * 12);\n                image.verticesDirty = false;\n                verticesChanged = true;\n            }\n\n            if (image.uvDirty) {\n                image.uv.splatter(geo_uv, index * 8);\n                image.uvDirty = false;\n                uvChanged = true;\n            }\n\n            if (image.texDirty) {\n                geo_tex.fill(image.tex, index * 4, index * 4 + 4);\n                image.texDirty = false;\n                texChanged = true;\n            }\n\n            if (image.lightDirty) {\n                geo_light.fill(image.light, index * 4, index * 4 + 4);\n                image.lightDirty = false;\n                lightChanged = true;\n            }\n\n            if (image.waveDirty) {\n                geo_wave.fill(image.wave, index * 4, index * 4 + 4);\n                image.waveDirty = false;\n                waveChanged = true;\n            }\n        }\n\n        for (var _i = 0; _i < imageCount; _i++) {\n            imageOrder[_i].indexArray.splatter(geo_index, _i * 6);\n        }\n\n        if (geometry.drawRange.start !== 0 || geometry.drawRange.count !== imageCount * planeGeometry.index.count) {\n            geometry.setDrawRange(0, imageCount * planeGeometry.index.count);\n        }\n\n        if (lightChanged) {\n            geometry.attributes.light.needsUpdate = true;\n        }\n        if (waveChanged) {\n            geometry.attributes.wave.needsUpdate = true;\n        }\n        if (quatChanged) {\n            geometry.attributes.quaternion.needsUpdate = true;\n        }\n        if (positionChanged) {\n            geometry.attributes.spot.needsUpdate = true;\n        }\n        if (verticesChanged) {\n            geometry.attributes.position.needsUpdate = true;\n        }\n        if (texChanged) {\n            geometry.attributes.tex.needsUpdate = true;\n        }\n        if (uvChanged) {\n            geometry.attributes.uv.needsUpdate = true;\n        }\n        geometry.index.needsUpdate = true;\n        this.clear();\n    }\n\n    function destroyEverything() {\n        for (var i = 0; i < spriteRenderers.length; i++) {\n            spriteRenderers[i].destroy();\n        }\n        spriteRenderers.length = 0;\n    }\n\n    function destroySprite() {\n        if (this.mesh) {\n            this.mesh.geometry.dispose();\n            this.mesh.material.dispose();\n        }\n        this.mesh = null;\n        this.images.length = 0;\n        this.imageCount = 0;\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    SpriteRenderer.setIndexProcessor = setIndexProcessor;\n    Utils.onDestroy(destroyEverything);\n\n    /**\n     *   PROCESSES\n     */\n\n    return SpriteRenderer;\n});\n//# sourceMappingURL=spriterenderer.js.map;\n\n\ndefine('collection',['utils', 'spritesheet', 'spriteobject', 'camera'], function (Utils, SpriteSheet, SpriteObject, Camera) {\n\n    'use strict';\n\n    function Collection(options, getSpriteFunction, forEach) {\n        this.options = options || {};\n        this.getSprite = getSpriteFunction ? getSpriteFunction : Utils.nop;\n        if (forEach) {\n            this.forEach = forEach.bind(this);\n        } else {\n            switch (this.options.type) {\n                case \"grid\":\n                    break;\n                default:\n                    Utils.handleError('Collection type not recognized');\n                    break;\n            }\n        }\n    }\n    Collection.prototype.pos = null;\n    Collection.prototype.size = null;\n    Collection.prototype.getSprite = Utils.nop;\n    Collection.prototype.forEach = Grid_forEach;\n    Collection.prototype.options = null;\n    Collection.prototype.getSprite = Utils.nop;\n    Collection.prototype.isCollection = true;\n    Collection.prototype.get = Utils.nop;\n    Collection.prototype.find = Utils.nop;\n    Collection.prototype.create = Utils.nop;\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function Grid_forEach(callback) {\n        var optionsX = this.options.x;\n        var optionsY = this.options.y;\n        var optionsWidth = this.options.width;\n        var optionsHeight = this.options.height;\n        var gridCount = optionsWidth * optionsHeight;\n        var count = this.options.count || 1;\n        var length = gridCount * count;\n\n        for (var i = 0; i < length; i++) {\n            var _x = optionsX + i % optionsWidth;\n            var _y = optionsY + Math.floor(i / optionsWidth) % optionsHeight;\n            var c = Math.floor(i / gridCount);\n            var obj = this.getSprite(_x, _y, c);\n            if (obj) {\n                if (obj.forEach) {\n                    obj.forEach(callback);\n                } else {\n                    callback(obj);\n                }\n            }\n        }\n    }\n\n    function destroyEverything() {}\n\n    function spriteFace(spriteInfo) {\n        var x = spriteInfo.x;\n        var y = spriteInfo.y;\n        var index = spriteInfo.index;\n        var size = cellSize;\n        var light = 1;\n        var img = SpriteSheet.spritesheet.sprite[index];\n\n        return SpriteObject.create(x * cellSize, y * cellSize, size / 2, size, size, null, light, img);\n    }\n\n    var cubeFaces = [];\n    function spriteCube(spriteInfo) {\n        cubeFaces.length = 0;\n\n        cube.faces.push(SpriteObject.create(x * cellSize, y * cellSize, size / 2, size, size, Camera.quaternions.southQuaternionArray, light, img));\n\n        return cubeFaces;\n    }\n\n    function createSpriteCollection(options) {\n        var spriteHash = [];spriteHash.length = 1000000;\n        var areaSize = 50;\n        var spriteRegistry = [];\n        var cellSize = 64;\n\n        var spriteFunction = function spriteFunction(spriteInfo) {\n            switch (spriteInfo.type) {\n                case 'face':\n                    return spriteFace(spriteInfo);\n                    break;\n                case 'cube':\n                    return spriteCube(spriteInfo);\n                    break;\n            }\n        };\n        if (options.spriteFunction) {\n            spriteFunction = options.spriteFunction;\n        }\n\n        var spriteCount = 0;\n        function SpriteInfo(x, y, index) {\n            this.uid = ++spriteCount;\n            spriteRegistry[this.uid] = this;\n            this.index = index;\n            this.enterArea(x, y);\n        }\n        SpriteInfo.prototype.leaveArea = function () {\n            var areaId = getAreaHashId(this.x, this.y);\n            var area = spriteHash[areaId];\n            if (area) {\n                if (area[this.uid]) delete area[this.uid];\n            }\n        };\n        SpriteInfo.prototype.enterArea = function (x, y) {\n            this.x = x;this.y = y;\n            var areaId = getAreaHashId(this.x, this.y);\n            var area = spriteHash[areaId] || (spriteHash[areaId] = {});\n            area[this.uid] = this;\n        };\n        SpriteInfo.prototype.move = function (x, y) {\n            this.leaveArea();\n            this.enterArea(x, y);\n        };\n\n        function getAreaHashIdWithArea(x, y) {\n            return Math.abs(x * 1331 ^ 312 + y * 131) % spriteHash.length;\n        }\n\n        function getAreaHashId(x, y) {\n            x = Math.floor(x / areaSize);\n            y = Math.floor(y / areaSize);\n            return getAreaHashIdWithArea(x, y);\n        }\n\n        var selectedObj = { x: 0, y: 0 };\n        function getCamPos() {\n            var camera = Camera.getCamera();\n            var xPos = camera.position.x;\n            var yPos = camera.position.y;\n\n            selectedObj.x = Math.round(xPos / cellSize);\n            selectedObj.y = Math.round(yPos / cellSize) + 6;\n            return selectedObj;\n        }\n\n        var spriteCollection = new Collection(options, spriteFunction, function (callback) {\n            var camPos = getCamPos();\n            var xArea = Math.floor(camPos.x / areaSize);\n            var yArea = Math.floor(camPos.y / areaSize);\n            var areaRange = 1;\n            for (var _y2 = yArea - areaRange; _y2 <= yArea + areaRange; _y2++) {\n                for (var _x2 = xArea - areaRange; _x2 <= xArea + areaRange; _x2++) {\n                    var areaId = getAreaHashIdWithArea(_x2, _y2);\n                    var area = spriteHash[areaId];\n                    if (area) {\n                        for (var a in area) {\n                            var sprite = area[a];\n                            var obj = this.getSprite(sprite);\n                            if (Array.isArray(obj)) {\n                                obj.forEach(callback);\n                            } else {\n                                callback(obj);\n                            }\n                        }\n                    }\n                }\n            }\n        });\n        spriteCollection.create = function (x, y, index) {\n            return new SpriteInfo(x, y, index);\n        };\n\n        var array = [];\n        spriteCollection.get = function (x, y) {\n            var areaId = getAreaHashId(x, y);\n            var area = spriteHash[areaId];\n            array.length = 0;\n            if (area) {\n                var props = area.getOwnPropertyNames();\n                for (var i = 0; i < pros.length; i++) {\n                    var sprite = area[props[i]];\n                    if (Math.floor(sprite.x) === x && Math.floor(sprite.y) === y) {\n                        array.push(sprite);\n                    }\n                }\n            }\n            return array.length ? array : null;\n        };\n        spriteCollection.find = function (uid) {\n            return spriteRegistry[uid];\n        };\n        return spriteCollection;\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    Collection.createSpriteCollection = createSpriteCollection;\n\n    /**\n     *   PROCESSES\n     */\n    Utils.onDestroy(destroyEverything);\n\n    return Collection;\n});\n//# sourceMappingURL=collection.js.map;\n\n\ndefine('mouse',['utils'], function (Utils) {\n\n    'use strict';\n\n    var spot = { x: 0, y: 0 },\n        callbacks = [],\n        wheelCallbacks = [],\n        zoomCallbacks = [];\n    var touchSpotX = {},\n        touchSpotY = {},\n        pinchSize = 0;\n    var mdown = false;\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function onDown(e) {\n        if (e.target.attributes['tap'] === undefined) {\n            var touches = e.changedTouches;\n            if (touches) {\n                for (var i = 0; i < touches.length; i++) {\n                    var touch = touches[i];\n                    touchSpotX[touch.identifier] = touch.pageX;\n                    touchSpotY[touch.identifier] = touch.pageY;\n                }\n            } else {\n                spot.x = e.pageX;\n                spot.y = e.pageY;\n            }\n            mdown = true;\n            for (var i = 0; i < callbacks.length; i++) {\n                callbacks[i](null, null, true, e.pageX, e.pageY);\n            }\n            if (touches && touches.length === 2) {\n                var dx = touches[0].pageX - touches[1].pageY;\n                var dy = touches[0].pageY - touches[1].pageY;\n                var dist = Math.sqrt(dx * dx + dy * dy);\n                pinchSize = dist;\n            }\n        }\n        e.preventDefault();\n    }\n\n    function onUp(e) {\n\n        var hasTouch = false;\n        if (e.changedTouches) {\n            var touches = e.changedTouches;\n            for (var i = 0; i < touches.length; i++) {\n                var touch = touches[i];\n                delete touchSpotX[touch.identifier];\n                delete touchSpotY[touch.identifier];\n            }\n            for (var i in touchSpotX) {\n                hasTouch = true;\n            }\n        }\n\n        for (var i = 0; i < callbacks.length; i++) {\n            callbacks[i](null, null, hasTouch, e.pageX, e.pageY);\n        }\n        mdown = false;\n        e.preventDefault();\n    }\n\n    function onMove(e) {\n        e = e || event;\n        var touches = e.changedTouches;\n        if (!touches) {\n            var buttonDown = 'buttons' in e && e.buttons === 1 || (e.which || e.button) === 1;\n\n            if (buttonDown && mdown) {\n                var newX = e.pageX;\n                var newY = e.pageY;\n                var dx = newX - spot.x;\n                var dy = newY - spot.y;\n                spot.x = newX;\n                spot.y = newY;\n                for (var i = 0; i < callbacks.length; i++) {\n                    callbacks[i](dx, dy, true, e.pageX, e.pageY);\n                }\n            } else {\n                mdown = false;\n                for (var i = 0; i < callbacks.length; i++) {\n                    callbacks[i](dx, dy, false, e.pageX, e.pageY);\n                }\n            }\n        } else if (mdown) {\n            var dx = 0,\n                dy = 0;\n            for (var i = 0; i < touches.length; i++) {\n                var touch = touches[i];\n                dx += touch.pageX - touchSpotX[touch.identifier];\n                dy += touch.pageY - touchSpotY[touch.identifier];\n                touchSpotX[touch.identifier] = touch.pageX;\n                touchSpotY[touch.identifier] = touch.pageY;\n            }\n            for (var i = 0; i < callbacks.length; i++) {\n                callbacks[i](dx, dy, true, e.pageX, e.pageY);\n            }\n            if (zoomCallbacks.length && touches.length === 2) {\n                var dx = touches[0].pageX - touches[1].pageY;\n                var dy = touches[0].pageY - touches[1].pageY;\n                var dist = Math.sqrt(dx * dx + dy * dy);\n                var diff = dist - pinchSize;\n                for (var i = 0; i < zoomCallbacks.length; i++) {\n                    zoomCallbacks[i](diff);\n                }\n                pinchSize = dist;\n            }\n        }\n        e.preventDefault();\n    }\n\n    function onWheel(e) {\n        e = e || event;\n        for (var i = 0; i < wheelCallbacks.length; i++) {\n            wheelCallbacks[i](e.deltaX, e.deltaY);\n        }\n    }\n\n    function setOnTouch(func) {\n        deactivateTouch();\n        activateTouch();\n        callbacks.push(func);\n    }\n\n    function setOnWheel(func) {\n        deactivateTouch();\n        activateTouch();\n        wheelCallbacks.push(func);\n    }\n\n    function setOnZoom(func) {\n        deactivateTouch();\n        activateTouch();\n        zoomCallbacks.push(func);\n    }\n\n    var element = document;\n\n    function activateTouch() {\n        element.addEventListener(\"mousedown\", onDown);\n        element.addEventListener(\"touchstart\", onDown);\n        element.addEventListener(\"mouseup\", onUp);\n        element.addEventListener(\"touchend\", onUp);\n        element.addEventListener(\"touchcancel\", onUp);\n        element.addEventListener(\"mousemove\", onMove);\n        element.addEventListener(\"touchmove\", onMove);\n        element.addEventListener(\"wheel\", onWheel);\n    }\n\n    function deactivateTouch() {\n        element.removeEventListener(\"mousedown\", onDown);\n        element.removeEventListener(\"touchstart\", onDown);\n        element.removeEventListener(\"mouseup\", onUp);\n        element.removeEventListener(\"touchend\", onUp);\n        element.removeEventListener(\"touchcancel\", onUp);\n        element.removeEventListener(\"mousemove\", onMove);\n        element.removeEventListener(\"touchmove\", onMove);\n        element.removeEventListener(\"wheel\", onWheel);\n    }\n\n    function setMainElement(elem) {\n        deactivateTouch();\n        element = elem;\n        activateTouch();\n    }\n\n    function destroyEverything() {\n        callbacks = [];\n        wheelCallbacks = [];\n        zoomCallbacks = [];\n        deactivateTouch();\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    function Mouse() {}\n    Mouse.setOnTouch = setOnTouch;\n    Mouse.setOnWheel = setOnWheel;\n    Mouse.setOnZoom = setOnZoom;\n    Mouse.setMainElement = setMainElement;\n\n    Utils.onDestroy(destroyEverything);\n\n    return Mouse;\n});\n//# sourceMappingURL=mouse.js.map;\n\n\ndefine('engine',['threejs', 'loader', 'loop', 'camera'], function (THREE, Loader, Loop, Camera) {\n    function Engine(options) {\n        var self = this;\n        options = options || {};\n        var renderer = this.renderer = new THREE.WebGLRenderer({\n            canvas: options.canvas\n        });\n        this.renderer.sortObjects = false;\n        this.renderer.setPixelRatio(window.devicePixelRatio);\n        this.renderer.setClearColor('white', 1);\n        window.addEventListener(\"resize\", function (e) {\n            windowResized = true;\n        });\n        var scene = this.scene = new THREE.Scene();\n        var sceneWidth = 0,\n            sceneHeight = 0,\n            windowResized = true;\n        this.renderer.domElement.style.display = \"none\";\n        Loader.setOnLoad(function () {\n            renderer.domElement.style.display = \"\";\n            Loop.addLoop(function () {\n                checkResize();\n                renderer.render(scene, Camera.getCamera());\n            });\n            self.ready = true;\n        });\n\n        function checkResize() {\n            if (!windowResized) {\n                return;\n            }\n            var width = renderer.domElement.parentElement.offsetWidth;\n            var height = renderer.domElement.parentElement.offsetHeight;\n            if (sceneWidth !== width || sceneHeight !== height) {\n                sceneWidth = width;\n                sceneHeight = height;\n                renderer.setSize(width, height);\n                Camera.checkWindowSize(width, height);\n            }\n            windowResized = false;\n        }\n    }\n    Engine.prototype.renderer = null;\n    Engine.prototype.scene = null;\n    Engine.prototype.ready = false;\n\n    return Engine;\n});\n//# sourceMappingURL=engine.js.map;\n\n\ndefine('dobuki',['utils', 'loop', 'gifHandler', 'camera', 'objectpool', 'spriteobject', 'packer', 'spritesheet', 'spriterenderer', 'collection', 'mouse', 'loader', 'engine'], function (Utils, Loop, GifHandler, Camera, ObjectPool, SpriteObject, Packer, SpriteSheet, SpriteRenderer, Collection, Mouse, Loader, Engine) {\n\n    return {\n        Utils: Utils,\n        Loop: Loop,\n        GifHandler: GifHandler,\n        Camera: Camera,\n        ObjectPool: ObjectPool,\n        SpriteObject: SpriteObject,\n        SpriteSheet: SpriteSheet,\n        SpriteRenderer: SpriteRenderer,\n        Collection: Collection,\n        Mouse: Mouse,\n        Loader: Loader,\n        Engine: Engine\n    };\n});\n//# sourceMappingURL=dobuki.js.map;\n\n\nrequirejs.config({\n    paths: {\n        threejs: 'https://cdnjs.cloudflare.com/ajax/libs/three.js/85/three.min',\n        dobuki: 'dobuki',\n        jsgif: 'jsgif/gif'\n    },\n    urlArgs: location.search.match(/\\bdebug\\b|\\bdisable_cache\\b/g) ? \"time=\" + Date.now() : ''\n});\n\nrequire([\"dobuki\"], function (DOK) {});\n//# sourceMappingURL=main.js.map;\ndefine(\"main\", function(){});\n\n"]}