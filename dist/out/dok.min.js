"use strict";

var _typeof2 = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _typeof = "function" == typeof Symbol && "symbol" == _typeof2(Symbol.iterator) ? function (t) {
  return typeof t === "undefined" ? "undefined" : _typeof2(t);
} : function (t) {
  return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t === "undefined" ? "undefined" : _typeof2(t);
};define("utils", [], function () {
  function t() {
    var t = /\/$|index\.html$|next\.html$/g;t.exec(location.pathname) || window.history.pushState(null, "", location.pathname + "/" + location.search + location.hash);
  }function e(t, e) {
    "undefined" == typeof e && (e = "scene.html"), v.destroyEverything(), location.replace("../" + t + "/" + e);
  }function r(t, e) {
    if (Array.isArray(t)) {
      for (var r = [], n = 0; n < t.length; n++) {
        r.push(t[n]), r.push("\n ");
      }console.error.apply(null, r);
    } else console.error(t);if (v.lastError = t, !e) throw new Error("Last error terminated the process.");
  }function n(t, e) {
    return function () {
      t && t(), e && e();
    };
  }function i(t) {
    o("object" === ("undefined" == typeof t ? "undefined" : _typeof(t)), "Pass 'arguments' to expectParams");for (var e = 1; e < arguments.length; e++) {
      var r = null === t[e - 1] ? "null" : Array.isArray(t[e - 1]) ? "array" : _typeof(t[e - 1]);o(arguments[e].split("|").indexOf(r) >= 0, ["Expected argument " + (e - 1) + " to be " + arguments[e] + " NOT " + r, t]);
    }
  }function a(t) {
    o("object" === ("undefined" == typeof t ? "undefined" : _typeof(t)), "Pass 'arguments' to expectParams");for (var e = 1; e < arguments.length; e++) {
      var r = null === t[e - 1] ? "null" : Array.isArray(t[e - 1]) ? "array" : _typeof(t[e - 1]);if (arguments[e].split("|").indexOf(r) < 0) return !1;
    }return !0;
  }function o(t, e) {
    t || r(e ? e : "Assert failed: condition not met.");
  }function s() {
    v.destroyEverything();
  }function u() {
    document.onbeforeunload = window.onbeforeunload = s;
  }function l(t) {
    x = v.combineMethods(t, x);
  }function h() {
    function t(t, e, r) {
      e = e || 0, r = r || this.length;for (var n = e; n < r; n++) {
        this[n] = t;
      }return this;
    }function e(t, e) {
      for (var r = this.length - 1; r >= 0; r--) {
        t[e + r] = this[r];
      }return this;
    }"undefined" == typeof String.prototype.trim && (String.prototype.trim = function () {
      return String(this).replace(/^\s+|\s+$/g, "");
    }), window.requestAnimationFrame || f(), "undefined" == typeof Float32Array.prototype.fill && (Float32Array.prototype.fill = t), "undefined" == typeof Uint32Array.prototype.fill && (Uint32Array.prototype.fill = t), "undefined" == typeof Uint16Array.prototype.fill && (Uint16Array.prototype.fill = t), Float32Array.prototype.splatter = e, Uint32Array.prototype.splatter = e, Uint16Array.prototype.splatter = e, Array.prototype.getFrame = function (t) {
      return t |= 0, this[t % this.length];
    }, Number.prototype.getFrame = function () {
      return this;
    };
  }function f() {
    function t(t) {
      r = setTimeout(e, 1e3 / 60, t);
    }function e(t) {
      clearTimeout(r);var e = Date.now() - n;t(e), n = Date.now();
    }window.requestAnimationFrame = function () {
      return window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || t;
    }();var r = void 0,
        n = 0;
  }function c(t, e, r, n, i, a, o) {
    d(t, function (t) {
      e[r] = t;for (var i = 0; i < e.length; i++) {
        if (void 0 === e[i]) return;
      }n.apply(null, e);
    }, i, a, o);
  }function d(t, e, n, i, a) {
    if (Array.isArray(t)) for (var o = new Array(t.length), s = 0; s < t.length; s++) {
      c(t[s], o, s, e);
    } else {
      var u = new XMLHttpRequest();u.overrideMimeType(n ? "text/plain; charset=x-user-defined" : "text/plain; charset=UTF-8"), u.open(i ? i : "GET", t, !0), u.addEventListener("load", function () {
        4 === u.readyState && (200 === u.status ? e(u.responseText) : r(u.responseText));
      }), u.addEventListener("error", function (t) {
        r(t);
      }), u.send(a);
    }
  }function p() {
    this.x = 0, this.y = 0, this.left = -1, this.right = 1, this.top = -1, this.bottom = 1, this.direction = 0;var t = [0, 0];this.reset = function () {
      this.x = 0, this.y = 0, this.left = -1, this.right = 1, this.top = -1, this.bottom = 1, this.direction = 0;
    }, this.current = function () {
      return t[0] = this.x, t[1] = this.y, t;
    }, this.next = function () {
      var t = this.current();switch (this.direction) {case 0:
          this.x++, this.x >= this.right && (this.right++, this.direction = (this.direction + 1) % 4);break;case 1:
          this.y++, this.y >= this.bottom && (this.bottom++, this.direction = (this.direction + 1) % 4);break;case 2:
          this.x--, this.x <= this.left && (this.left--, this.direction = (this.direction + 1) % 4);break;case 3:
          this.y--, this.y <= this.top && (this.top--, this.direction = (this.direction + 1) % 4);}return t;
    };
  }function g() {
    return w;
  }function y() {
    return m(Array.prototype.slice.apply(arguments));
  }function m(t) {
    var e = [];if (e.length = t[0], t.length > 1) for (var r = t.slice(1), n = 0; n < e.length; n++) {
      e[n] = m(r);
    }return e;
  }function v() {
    this.lastError = null;
  }var x = function x() {},
      w = "";return v.handleError = r, v.changeScene = e, v.destroyEverything = x, v.combineMethods = n, v.expectParams = i, v.checkParams = a, v.assert = o, v.fixPath = t, v.onDestroy = l, v.loadAsync = d, v.Roundabout = p, v.getTitle = g, v.makeArray = y, v.nop = function () {}, u(), h(), v;
}), define("loop", ["utils"], function (t) {
  "use strict";
  function e(t) {
    if (o) {
      if (requestAnimationFrame(e), t <= a.time + u) return;a.time = Math.floor(t / u) * u;for (var r = 0; o && r < o.length; r++) {
        o[r]();
      }h++, t - l > 1e3 && (s = h, h = 0, l = t);
    }
  }function r(t) {
    null === o && (o = [], i()), o.push(t);
  }function n(t) {
    if (o) {
      var e = o.indexOf(t);o.splice(e, 1), 0 === o.length && (o = null);
    }
  }function i() {
    e(0);
  }function a() {}var o = null,
      s = 0,
      u = Math.floor(1e3 / 60),
      l = 0,
      h = 0;return a.addLoop = r, a.removeLoop = n, t.onDestroy(a), Object.defineProperty(a, "fps", { enumerable: !1, configurable: !1, get: function get() {
      return s;
    }, set: function set(t) {
      u = Math.floor(1e3 / t);
    } }), a.time = 0, a;
}), define("gifworker", ["utils", "loop"], function (t, e) {
  function r() {
    function t(t, e, r) {
      var n = t.img,
          i = t.gce,
          a = i.transparencyGiven ? i.transparencyIndex : null,
          o = i.disposalMethod,
          s = n.lctFlag ? n.lct : r.gct;n.pixels.forEach(function (t, r) {
        a !== t ? (e.data[4 * r] = s[t][0], e.data[4 * r + 1] = s[t][1], e.data[4 * r + 2] = s[t][2], e.data[4 * r + 3] = 255) : 2 !== o && 3 !== o || (e.data[4 * r + 3] = 0);
      });
    }onmessage = function onmessage(e) {
      var r = e.data.frameInfo,
          n = e.data.cData,
          i = e.data.header,
          a = e.data.id;r && n && i && t(r, n, i), postMessage({ id: a, cData: n, frameInfo: r }, [n.data.buffer]);
    };
  }function n(t) {
    t.onmessage = function (t) {
      o[t.data.id](t.data.cData, t.data.frameInfo), delete o[t.data.id];
    };
  }function i(t, r, n, i) {
    require(["https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.7.0/js/md5.min.js"], function (a) {
      var s = a(Math.random() + "" + e.time);o[s] = i, l.postMessage({ frameInfo: t, cData: r, header: n, id: s }, [r.data.buffer]);
    });
  }function a() {
    l && l.terminate(), l = null, o = null;
  }var o = {},
      s = r.toString();s = s.substring(s.indexOf("{") + 1, s.lastIndexOf("}"));var u = new Blob([s], { type: "application/javascript" }),
      l = new Worker(URL.createObjectURL(u));return n(l), l.send = i, t.onDestroy(a), l;
}), define("jsgif/gif", [], function () {
  var t = function t(_t) {
    return _t.reduce(function (t, e) {
      return 2 * t + e;
    }, 0);
  },
      e = function e(t) {
    for (var e = [], r = 7; r >= 0; r--) {
      e.push(!!(t & 1 << r));
    }return e;
  },
      r = function r(t) {
    this.data = t, this.len = this.data.length, this.pos = 0, this.readByte = function () {
      if (this.pos >= this.data.length) throw new Error("Attempted to read past end of stream.");return 255 & t.charCodeAt(this.pos++);
    }, this.readBytes = function (t) {
      for (var e = [], r = 0; r < t; r++) {
        e.push(this.readByte());
      }return e;
    }, this.read = function (t) {
      for (var e = "", r = 0; r < t; r++) {
        e += String.fromCharCode(this.readByte());
      }return e;
    }, this.readUnsigned = function () {
      var t = this.readBytes(2);return (t[1] << 8) + t[0];
    };
  },
      n = function n(t, e) {
    for (var r, n, i = 0, a = function a(t) {
      for (var r = 0, n = 0; n < t; n++) {
        e.charCodeAt(i >> 3) & 1 << (7 & i) && (r |= 1 << n), i++;
      }return r;
    }, o = [], s = 1 << t, u = s + 1, l = t + 1, h = [], f = function f() {
      h = [], l = t + 1;for (var e = 0; e < s; e++) {
        h[e] = [e];
      }h[s] = [], h[u] = null;
    };;) {
      if (n = r, r = a(l), r !== s) {
        if (r === u) break;if (r < h.length) n !== s && h.push(h[n].concat(h[r][0]));else {
          if (r !== h.length) throw new Error("Invalid LZW code.");h.push(h[n].concat(h[n][0]));
        }o.push.apply(o, h[r]), h.length === 1 << l && l < 12 && l++;
      } else f();
    }return o;
  },
      i = function i(r, _i2) {
    _i2 || (_i2 = {});var a = function a(t) {
      for (var e = [], n = 0; n < t; n++) {
        e.push(r.readBytes(3));
      }return e;
    },
        o = function o() {
      var t, e;e = "";do {
        t = r.readByte(), e += r.read(t);
      } while (0 !== t);return e;
    },
        s = function s() {
      var n = {};if (n.sig = r.read(3), n.ver = r.read(3), "GIF" !== n.sig) throw new Error("Not a GIF file.");n.width = r.readUnsigned(), n.height = r.readUnsigned();var o = e(r.readByte());n.gctFlag = o.shift(), n.colorRes = t(o.splice(0, 3)), n.sorted = o.shift(), n.gctSize = t(o.splice(0, 3)), n.bgColor = r.readByte(), n.pixelAspectRatio = r.readByte(), n.gctFlag && (n.gct = a(1 << n.gctSize + 1)), _i2.hdr && _i2.hdr(n);
    },
        u = function u(n) {
      var a = function a(n) {
        var a = (r.readByte(), e(r.readByte()));n.reserved = a.splice(0, 3), n.disposalMethod = t(a.splice(0, 3)), n.userInput = a.shift(), n.transparencyGiven = a.shift(), n.delayTime = r.readUnsigned(), n.transparencyIndex = r.readByte(), n.terminator = r.readByte(), _i2.gce && _i2.gce(n);
      },
          s = function s(t) {
        t.comment = o(), _i2.com && _i2.com(t);
      },
          u = function u(t) {
        r.readByte();t.ptHeader = r.readBytes(12), t.ptData = o(), _i2.pte && _i2.pte(t);
      },
          l = function l(t) {
        var e = function e(t) {
          r.readByte();t.unknown = r.readByte(), t.iterations = r.readUnsigned(), t.terminator = r.readByte(), _i2.app && _i2.app.NETSCAPE && _i2.app.NETSCAPE(t);
        },
            n = function n(t) {
          t.appData = o(), _i2.app && _i2.app[t.identifier] && _i2.app[t.identifier](t);
        };r.readByte();switch (t.identifier = r.read(8), t.authCode = r.read(3), t.identifier) {case "NETSCAPE":
            e(t);break;default:
            n(t);}
      },
          h = function h(t) {
        t.data = o(), _i2.unknown && _i2.unknown(t);
      };switch (n.label = r.readByte(), n.label) {case 249:
          n.extType = "gce", a(n);break;case 254:
          n.extType = "com", s(n);break;case 1:
          n.extType = "pte", u(n);break;case 255:
          n.extType = "app", l(n);break;default:
          n.extType = "unknown", h(n);}
    },
        l = function l(s) {
      var u = function u(t, e) {
        for (var r = new Array(t.length), n = t.length / e, i = function i(n, _i) {
          var a = t.slice(_i * e, (_i + 1) * e);r.splice.apply(r, [n * e, e].concat(a));
        }, a = [0, 4, 2, 1], o = [8, 8, 4, 2], s = 0, u = 0; u < 4; u++) {
          for (var l = a[u]; l < n; l += o[u]) {
            i(l, s), s++;
          }
        }return r;
      };s.leftPos = r.readUnsigned(), s.topPos = r.readUnsigned(), s.width = r.readUnsigned(), s.height = r.readUnsigned();var l = e(r.readByte());s.lctFlag = l.shift(), s.interlaced = l.shift(), s.sorted = l.shift(), s.reserved = l.splice(0, 2), s.lctSize = t(l.splice(0, 3)), s.lctFlag && (s.lct = a(1 << s.lctSize + 1)), s.lzwMinCodeSize = r.readByte();var h = o();s.pixels = n(s.lzwMinCodeSize, h), s.interlaced && (s.pixels = u(s.pixels, s.width)), _i2.img && _i2.img(s);
    },
        h = function t() {
      var e = {};switch (e.sentinel = r.readByte(), String.fromCharCode(e.sentinel)) {case "!":
          e.type = "ext", u(e);break;case ",":
          e.type = "img", l(e);break;case ";":
          e.type = "eof", _i2.eof && _i2.eof(e);break;default:
          throw new Error("Unknown block: 0x" + e.sentinel.toString(16));}"eof" !== e.type && setTimeout(t, 0);
    },
        f = function f() {
      s(), setTimeout(h, 0);
    };f();
  };return "undefined" != typeof exports && (exports.Stream = r, exports.parseGIF = i), { Stream: r, parseGIF: i };
}), define("gifHandler", ["utils", "loop", "gifworker", "jsgif/gif"], function (t, e, r, n) {
  "use strict";
  function i(t) {
    return h[t] && h[t].block || ".gif" === t.split("?")[0].slice(-4).toLowerCase() || 0 === t.indexOf("data:image/gif;");
  }function a(t) {
    return h[t] || (h[t] = new o(t)), h[t];
  }function o(e) {
    var i = this,
        a = { currentFrame: 0, maxFrameCompleted: 0, renderTime: 0, framesProcessed: 0, header: null, frameInfos: [], block: null, canvases: [], callbacks: [], processNextFrame: function processNextFrame() {
        var t = this.framesProcessed,
            e = this.frameInfos[t];if (e && e.gce && e.img && this.header) {
          var n = document.createElement("canvas");n.style.position = "absolute", n.style.left = 0, n.style.top = 0, n.width = this.header.width, n.height = this.header.height;var i = n.getContext("2d");i.webkitImageSmoothingEnabled = !1, i.imageSmoothingEnabled = !1, i.msImageSmoothingEnabled = !1, this.canvases[t] = n, t > 0 && i.drawImage(this.canvases[t - 1], 0, 0);var a = i.getImageData(0, 0, n.width, n.height),
              o = this,
              s = this.processNextFrame.bind(this);r.send(e, a, this.header, function (t, e) {
            i.putImageData(t, 0, 0), o.callbacks[e.frame] && o.callbacks[e.frame](), o.maxFrameCompleted = e.frame, o.frameInfos[e.frame].ready = !0, s();
          }), this.currentFrame = this.framesProcessed, this.framesProcessed++;
        }
      }, hdr: function hdr(t) {
        this.header = t, i.width = this.header.width, i.height = this.header.height;
      }, gce: function gce(t) {
        (0 == this.frameInfos.length || this.frameInfos[this.frameInfos.length - 1].gce) && this.frameInfos.push({ gce: null, cycleTime: null, img: null, frame: this.frameInfos.length, ready: !1 });var e = this.frameInfos.length - 1;this.frameInfos[e].gce = t, t.delayTime || (t.delayTime = 1), this.frameInfos[e].cycleTime = 10 * t.delayTime + (0 === e ? 0 : this.frameInfos[e - 1].cycleTime), this.processNextFrame();
      }, img: function img(t) {
        (0 === this.frameInfos.length || this.frameInfos[this.frameInfos.length - 1].img) && this.frameInfos.push({}), this.frameInfos[this.frameInfos.length - 1].img = t, this.processNextFrame();
      }, eof: function eof(t) {
        this.block = t, this.processNextFrame();
      } };t.loadAsync(e, function (t) {
      n.parseGIF(new n.Stream(t), a);
    }, !0), this.frameInfos = a.frameInfos, this.canvases = a.canvases, this.callbacks = a.callbacks, this.gifInfo = a;
  }function s() {
    var t = this.gifInfo;if (t.block && e.time > t.renderTime) {
      t.currentFrame = (t.currentFrame + 1) % this.frameInfos.length;var r = this.frameInfos[this.frameInfos.length - 1].cycleTime;t.renderTime = Math.floor(e.time / r) * r + this.frameInfos[t.currentFrame].cycleTime;
    }return Math.min(t.currentFrame, t.maxFrameCompleted);
  }function u() {
    h = {};
  }function l() {}var h = {};return o.prototype.width = 0, o.prototype.height = 0, o.prototype.frameInfos = [], o.prototype.canvases = [], o.prototype.callbacks = [], o.prototype.gifInfo = null, o.prototype.getFrame = s, l.getGif = a, l.isGif = i, t.onDestroy(u), l;
}), define("camera", ["threejs", "loop"], function (t, e) {
  "use strict";
  function r() {
    return g;
  }function n(t) {
    t && g !== m ? (g = m, u(y, g)) : t || g !== m || (g = y, u(m, g)), i();
  }function i() {
    g.quaternion.toArray(v.array), v.forwardMovement.set(0, 0, 1), v.forwardMovement.applyQuaternion(g.quaternion);
  }function a() {
    return g.quaternion.equals(x) || (i(), x.copy(g.quaternion)), v;
  }function o() {
    y.position.set(0, 0, 400), m.position.set(0, 0, 400);
  }function s() {
    return g === m;
  }function u(t, e) {
    e.position.copy(t.position), e.quaternion.copy(t.quaternion);
  }function l() {
    return { is3d: s(), position: g.position.toArray(), quaternion: g.quaternion.toArray() };
  }function h(t) {
    n(t.is3d), g.quaternion.fromArray(t.quaternion), g.position.fromArray(t.position), g.updateProjectionMatrix();
  }function f(t, e) {
    var r = -Math.atan2(e - g.position.z, t - g.position.x) - Math.PI / 2;return w.setFromAxisAngle(A, r), w.multiply(I), w.toArray(b);
  }function c() {
    var e = {};return e.groundQuaternionArray = new t.Quaternion().setFromAxisAngle(new t.Vector3(1, 0, 0), -Math.PI / 2).toArray(new Float32Array(4)), e.southQuaternionArray = new t.Quaternion().toArray(new Float32Array(4)), e.northQuaternionArray = new t.Quaternion().setFromAxisAngle(new t.Vector3(0, 1, 0), -Math.PI).toArray(new Float32Array(4)), e.westQuaternionArray = new t.Quaternion().setFromAxisAngle(new t.Vector3(0, 1, 0), -Math.PI / 2).toArray(new Float32Array(4)), e.eastQuaternionArray = new t.Quaternion().setFromAxisAngle(new t.Vector3(0, 1, 0), Math.PI / 2).toArray(new Float32Array(4)), e.ceilingQuaternionArray = new t.Quaternion().setFromAxisAngle(new t.Vector3(1, 0, 0), Math.PI / 2).toArray(new Float32Array(4)), e;
  }function d() {
    var t = innerWidth,
        e = innerHeight;y.left = -t / 2, y.right = t / 2, y.top = e / 2, y.bottom = -e / 2, y.updateProjectionMatrix(), m.aspect = t / e, m.updateProjectionMatrix();
  }function p() {}var g,
      y = new t.OrthographicCamera(-innerWidth / 2, innerWidth / 2, innerHeight / 2, -innerHeight / 2, .1, 1e6),
      m = new t.PerspectiveCamera(75, innerWidth / innerHeight, .1, 1e6),
      v = { array: new Float32Array(4), forwardMovement: new t.Vector3(0, 0, 1), version: 0 },
      x = new t.Quaternion(),
      w = new t.Quaternion(),
      b = new Float32Array(4),
      A = new t.Vector3(0, 1, 0),
      I = new t.Quaternion().setFromAxisAngle(new t.Vector3(1, 0, 0), -Math.PI / 2);return p.setCamera3d = n, p.isCamera3d = s, p.getCamera = r, p.setCameraPosition = h, p.getCameraPosition = l, p.getCameraQuaternionData = a, p.shadowQuatArray = f, p.quaternions = c(), o(), n(!0), e.addLoop(d), p;
}), define("objectpool", ["utils"], function (t) {
  function e(t) {
    this.pool = [], this.classObject = t;
  }function r() {
    return this.index >= this.pool.length && this.pool.push(new this.classObject()), this.pool[this.index++];
  }function n() {
    this.index = 0;
  }return e.prototype.classObject = null, e.prototype.pool = null, e.prototype.index = 0, e.prototype.create = r, e.prototype.recycleAll = n, e;
}), define("spriteobject", ["threejs", "objectpool"], function (t, e) {
  "use strict";
  function r() {
    this.position = new t.Vector3(), this.size = new Float32Array([0, 0, 1]), this.quaternionArray = new Float32Array(4).fill(0);
  }r.prototype.init = function (t, e, r, n, i, a, o, s) {
    return this.position.set(t, e, r), this.size[0] = n, this.size[1] = i, this.hasQuaternionArray = null !== a, this.hasQuaternionArray && (this.quaternionArray[0] = a[0], this.quaternionArray[1] = a[1], this.quaternionArray[2] = a[2], this.quaternionArray[3] = a[3]), this.light = o, this.img = s, this;
  }, r.prototype.position = null, r.prototype.size = null, r.prototype.hasQuaternionArray = !1, r.prototype.quaternionArray = null, r.prototype.light = 1, r.prototype.img = -1, r.prototype.offset = null;var n = new e(r);return r.create = function (t, e, r, i, a, o, s, u) {
    return n.create().init(t, e, r, i, a, o, s, u);
  }, r.clear = function () {
    n.recycleAll();
  }, r;
}), define("packer", ["utils"], function (t) {
  "use strict";
  function e(t, e, r, n, i) {
    if (e + n > u || r + i > u) return !1;if (h[t]) for (var a = 0; a < n; a++) {
      if (h[t][e + a]) for (var o = 0; o < i; o++) {
        if (h[t][e + a][r + o]) return !1;
      }
    }return !0;
  }function r(t) {
    if (t.width <= 1 && t.height <= 1) return null;if (t.width > u || t.height > u) return null;for (var r = Math.ceil(t.width / l), n = Math.ceil(t.height / l), i = 0; i < s; i++) {
      for (var a = 0; a < u / l - r; a++) {
        for (var o = 0; o < u / l - n; o++) {
          if (e(i, a, o, r, n)) return { tex: i, x: a * l, y: o * l };
        }
      }
    }return null;
  }function n(t, e, r, n) {
    h[t] || (h[t] = []);for (var i = Math.ceil((n.width + 1) / l), a = Math.ceil((n.height + 1) / l), o = 0; o < i; o++) {
      h[t][e / l + o] || (h[t][e / l + o] = []);for (var s = 0; s < a; s++) {
        h[t][e / l + o][r / l + s] = n;
      }
    }
  }function i(t) {
    var e = r(t);return e && n(e.tex, e.x, e.y, t), e;
  }function a() {
    h.length = 0;
  }function o() {}var s = 16,
      u = 2048,
      l = 8,
      h = [];return o.getSlot = i, t.onDestroy(a), o;
}), define("gifhandler", ["utils", "loop", "gifworker", "jsgif/gif"], function (t, e, r, n) {
  "use strict";
  function i(t) {
    return h[t] && h[t].block || ".gif" === t.split("?")[0].slice(-4).toLowerCase() || 0 === t.indexOf("data:image/gif;");
  }function a(t) {
    return h[t] || (h[t] = new o(t)), h[t];
  }function o(e) {
    var i = this,
        a = { currentFrame: 0, maxFrameCompleted: 0, renderTime: 0, framesProcessed: 0, header: null, frameInfos: [], block: null, canvases: [], callbacks: [], processNextFrame: function processNextFrame() {
        var t = this.framesProcessed,
            e = this.frameInfos[t];if (e && e.gce && e.img && this.header) {
          var n = document.createElement("canvas");n.style.position = "absolute", n.style.left = 0, n.style.top = 0, n.width = this.header.width, n.height = this.header.height;var i = n.getContext("2d");i.webkitImageSmoothingEnabled = !1, i.imageSmoothingEnabled = !1, i.msImageSmoothingEnabled = !1, this.canvases[t] = n, t > 0 && i.drawImage(this.canvases[t - 1], 0, 0);var a = i.getImageData(0, 0, n.width, n.height),
              o = this,
              s = this.processNextFrame.bind(this);r.send(e, a, this.header, function (t, e) {
            i.putImageData(t, 0, 0), o.callbacks[e.frame] && o.callbacks[e.frame](), o.maxFrameCompleted = e.frame, o.frameInfos[e.frame].ready = !0, s();
          }), this.currentFrame = this.framesProcessed, this.framesProcessed++;
        }
      }, hdr: function hdr(t) {
        this.header = t, i.width = this.header.width, i.height = this.header.height;
      }, gce: function gce(t) {
        (0 == this.frameInfos.length || this.frameInfos[this.frameInfos.length - 1].gce) && this.frameInfos.push({ gce: null, cycleTime: null, img: null, frame: this.frameInfos.length, ready: !1 });var e = this.frameInfos.length - 1;this.frameInfos[e].gce = t, t.delayTime || (t.delayTime = 1), this.frameInfos[e].cycleTime = 10 * t.delayTime + (0 === e ? 0 : this.frameInfos[e - 1].cycleTime), this.processNextFrame();
      }, img: function img(t) {
        (0 === this.frameInfos.length || this.frameInfos[this.frameInfos.length - 1].img) && this.frameInfos.push({}), this.frameInfos[this.frameInfos.length - 1].img = t, this.processNextFrame();
      }, eof: function eof(t) {
        this.block = t, this.processNextFrame();
      } };t.loadAsync(e, function (t) {
      n.parseGIF(new n.Stream(t), a);
    }, !0), this.frameInfos = a.frameInfos, this.canvases = a.canvases, this.callbacks = a.callbacks, this.gifInfo = a;
  }function s() {
    var t = this.gifInfo;if (t.block && e.time > t.renderTime) {
      t.currentFrame = (t.currentFrame + 1) % this.frameInfos.length;var r = this.frameInfos[this.frameInfos.length - 1].cycleTime;t.renderTime = Math.floor(e.time / r) * r + this.frameInfos[t.currentFrame].cycleTime;
    }return Math.min(t.currentFrame, t.maxFrameCompleted);
  }function u() {
    h = {};
  }function l() {}var h = {};return o.prototype.width = 0, o.prototype.height = 0, o.prototype.frameInfos = [], o.prototype.canvases = [], o.prototype.callbacks = [], o.prototype.gifInfo = null, o.prototype.getFrame = s, l.getGif = a, l.isGif = i, t.onDestroy(u), l;
}), define("loader", ["utils", "loop"], function (t, e) {
  "use strict";
  function r(t) {
    m = t, document.body.removeChild(u());
  }function n(t, e) {
    var r = new Image();return r.onload = function (t) {
      e.call(r, t), p--, v++, a();
    }, r.crossOrigin = "", c.push({ image: r, url: t }), x++, a(), r;
  }function i(e, r) {
    x++, t.loadAsync(e, function (t) {
      v++, r(t);
    });
  }function a() {
    for (; f < c.length && p < d;) {
      c[f].image.src = c[f].url, f++, p++;
    }f === c.length && (f = 0, c.length = 0, v = 0, x = 0);
  }function o() {
    return x ? v / x : 1;
  }function s() {
    if (g) {
      var t = g.getContext("2d"),
          r = o();y = Math.max(0, y + (r - y) / 10), r >= 1 && (y = 1, e.removeLoop(s)), t.fillRect(10, 10, (g.width - 20) * y, g.height - 20), r >= 1 && m && setTimeout(m, 100);
    }
  }function u() {
    if (!g) {
      g = document.createElement("canvas"), g.id = "loading", g.width = Math.round(2 * innerWidth * 2 / 3), g.height = 50, g.style.left = innerWidth / 2 - g.width / 4 + "px", g.style.top = innerHeight / 2 - g.height / 4 + "px", g.style.width = g.width / 2 + "px", g.style.height = g.height / 2 + "px", g.style.position = "absolute", g.style.backgroundColor = "white", g.style.border = "10px double #00DDDD";var t = g.getContext("2d");t.fillStyle = "#0066aa", e.addLoop(s);
    }return document.body.appendChild(g), g;
  }function l() {
    c.length = 0;
  }function h() {}var f = 0,
      c = [],
      d = 3,
      p = 0,
      g = null,
      y = 0,
      m = null,
      v = 0,
      x = 0;return h.loadImage = n, h.loadFile = i, h.getLoadingProgress = o, h.getLoadingBar = u, h.setOnLoad = r, t.onDestroy(l), h;
}), define("spritesheet", ["threejs", "utils", "gifhandler", "loader", "packer"], function (t, e, r, n, i) {
  "use strict";
  function a(e, r) {
    if (!x[e] && r) {
      var n = x[e] = document.createElement("canvas");if (n.setAttribute("url", e), 0 === e.indexOf("tex-")) {
        n.width = n.height = q;var i = parseInt(e.split("-").pop()),
            a = new t.Texture(n);a.magFilter = t.NearestFilter, a.minFilter = t.LinearMipMapLinearFilter, n.addEventListener("update", g), I[i] = a, n.setAttribute("texture", i.toString()), n.style.position = "absolute", n.style.left = 0, n.style.top = 0;
      } else n.width = n.height = 1;o(n);
    }return x[e];
  }function o(t) {
    var e = t.getContext("2d");e.webkitImageSmoothingEnabled = !1, e.imageSmoothingEnabled = !1, e.msImageSmoothingEnabled = !1;
  }function s(t, e) {
    var r = document.createEvent("CustomEvent");return r.initCustomEvent(t, !1, !1, e || {}), r;
  }function u(t, e) {
    var i = a(e + ":" + t.join("|"));if (i) return i;if (t.length > 1) {
      i = a(e + ":" + t.join("|"), !0);var f = t.slice(0, t.length - 1),
          c = t[t.length - 1],
          d = u(f, e);return i.setAttribute("base-url", d.getAttribute("base-url")), h(d, c, i), d.addEventListener("update", function (t) {
        var e = t.currentTarget;h(e, c, i), i.dispatchEvent(s("update"));
      }), i;
    }var p = t[0];i = a(e + ":" + p, !0);var g = p.split("x");if (2 !== g.length || isNaN(parseInt(g[0])) || isNaN(parseInt(g[1]))) {
      if (r.isGif(p)) {
        var y = r.getGif(p);i.setAttribute("animated", !0), i.setAttribute("base-url", p), y.frameInfos[e] && y.frameInfos[e].ready ? l(y, e, i) : y.callbacks[e] = l.bind(null, y, e, i);
      } else {
        i.setAttribute("base-url", p);var m = n.loadImage(p, function () {
          i.width = m.naturalWidth, i.height = m.naturalHeight, o(i), i.getContext("2d").drawImage(m, 0, 0), i.dispatchEvent(s("update"));
        });
      }
    } else i.width = parseInt(g[0]), i.height = parseInt(g[1]);return i;
  }function l(t, e, r) {
    r.width = t.width, r.height = t.height, o(r), r.getContext("2d").drawImage(t.canvases[e], 0, 0), r.dispatchEvent(s("update"));
  }function h(t, e, r) {
    var n = r.getContext("2d"),
        i = e.split(",");if (4 === i.length && i.every(function (t) {
      return !isNaN(t);
    })) {
      i = i.map(function (t) {
        return parseInt(t);
      });var a = Math.min(t.width - i[0], i[2]),
          s = Math.min(t.height - i[1], i[3]);a > 0 && s > 0 && (r.width = a, r.height = s, o(r), n.drawImage(t, i[0], i[1], a, s, 0, 0, a, s));
    } else if (0 === e.indexOf("scale:")) {
      if (t.width > 1 && t.height > 1) {
        var u = e.split(":")[1].split(",");if (r.width = Math.ceil(t.width * Math.abs(u[0])), r.height = Math.ceil(t.height * Math.abs(u[1 % u.length])), o(r), u[0] < 0 || u[1 % u.length] < 0) {
          var l = [u[0] < 0 ? -1 : 1, u[1 % u.length] < 0 ? -1 : 1];n.translate(l[0] < 0 ? r.width : 0, l[1] < 0 ? r.height : 0), n.scale(l[0], l[1]);
        }n.drawImage(t, 0, 0, t.width, t.height, 0, 0, r.width, r.height), n.restore();
      }
    } else if (0 === e.indexOf("border")) {
      r.width = t.width, r.height = t.height, o(r);var h = e.split(":")[1] || 1;h.indexOf("%") > 0 && (h = Math.round(parseFloat(h.split("%")[0]) / 100 * Math.min(r.width, r.height))), n.drawImage(t, 0, 0), n.beginPath();for (var f = 0; f < h; f++) {
        n.rect(f, f, t.width - 1 - 2 * f, t.height - 1 - 2 * f);
      }n.stroke();
    } else if (0 === e.indexOf("text:")) r.width = t.width, r.height = t.height, o(r), n.fillStyle = "#000000", n.font = "18px Comic", n.fillText(e.split("text:")[1], 0, t.height);else if (0 === e.indexOf("shadow")) {
      r.width = t.width, r.height = t.height, o(r);for (var c = t.getContext("2d"), d = c.getImageData(0, 0, t.width, t.height), f = 0; f < d.data.length; f += 4) {
        0 !== d.data[f + 3] && (d.data[f] = 0, d.data[f + 1] = 0, d.data[f + 2] = 0, d.data[f + 3] = 127);
      }n.putImageData(d, 0, 0);
    } else 0 === e.indexOf("cross") && (r.width = t.width, r.height = t.height, o(r), n.drawImage(t, 0, 0), n.beginPath(), n.moveTo(t.width / 2, 0), n.lineTo(t.width / 2, t.height), n.moveTo(0, t.height / 2), n.lineTo(t.width, t.height / 2), n.stroke());
  }function f(t) {
    var e = b[t],
        r = e && e.gif ? e.gif.getFrame() : 0;return e && e.cut[r] && e.cut[r].ready ? e.cut[r] : e && e.url ? (e = c(e.url, r), e.cut[r]) : null;
  }function c(t, e) {
    if (w[t] && w[t].cut[e] && w[t].cut[e].ready) return w[t];var n = u(t.split("|"), e),
        a = i.getSlot(n),
        o = w[t];if (o || (o = { index: A++, url: t, baseUrl: null, cut: [], animated: !1 }, w[t] = o, b[o.index] = o), o.cut[e] || (o.cut[e] = { tex: 0, uv: null, ready: !1, url: t, baseUrl: null }), a) {
      F[n.getAttribute("url")] = a, n.addEventListener("update", p), n.dispatchEvent(s("update"));var l = a.x / q,
          h = a.y / q,
          f = n.width / q,
          c = n.height / q,
          d = C.attributes.uv.array,
          g = [l, 1 - h - c, l + f, 1 - h];o.gif = "true" === n.getAttribute("animated") ? r.getGif(o.url) : null, o.cut[e].baseUrl = o.baseUrl = n.getAttribute("base-url"), o.cut[e].tex = a.tex, o.cut[e].uv = new Float32Array(d.length);for (var y = 0; y < d.length; y++) {
        o.cut[e].uv[y] = g[2 * d[y] + y % 2];
      }return o.cut[e].ready = !0, o;
    }return o;
  }function d(t, e) {
    if (void 0 === e && (e = v.spritesheet), "string" != typeof t) {
      for (var r in t) {
        if (t.hasOwnProperty(r)) {
          e[r] || (e[r] = []);var n = v.preLoad(t[r], e[r]);null !== n && (e[r] = n);
        }
      }return console.log(e), e;
    }var i = c(t, 0);if (i) return i.index;
  }function p(t) {
    var e = t.currentTarget,
        r = e.getAttribute("url"),
        n = F[r],
        i = a("tex-" + n.tex, !0);i.getContext("2d").drawImage(e, n.x, n.y), i.dispatchEvent(s("update"));
  }function g(t) {
    var e = t.currentTarget;I[parseInt(e.getAttribute("texture"))].needsUpdate = !0;
  }function y() {
    I.forEach(function (t) {
      t && t.dispose();
    }), x = {}, w = {}, F = {}, I = [null];
  }function m() {
    return I;
  }function v() {}var x = {},
      w = {},
      b = [],
      A = 0,
      I = [null],
      F = {},
      q = 2048,
      C = new t.PlaneBufferGeometry(1, 1);return v.getCut = f, v.getTextures = m, v.preLoad = d, v.fetchCanvas = u, v.spritesheet = {}, e.onDestroy(y), v;
}), define("turbosort", [], function () {
  function t(t) {
    l || (l = new Uint32Array(t + 1), h = new Uint32Array(t + 1));
  }function e(t, e, r) {
    for (var n = f(t[e]), i = n, a = n, o = n, s = !0, u = 1; u < r; u++) {
      var l = f(t[e + u]);o > l ? (s = !1, l < i && (i = l)) : l > a && (a = l), o = l;
    }return d.min = i, d.max = a, d.inOrder = s, d;
  }function r(t) {
    return t;
  }function n(t, e, n) {
    t && (e = e ? Math.min(e, t.length) : t.length, e > 1 && (f = n ? n : r, a(t, 0, e ? e : t.length)));
  }function i(t, e) {
    return f(t) - f(e);
  }function a(t, r, n) {
    if (n < 200) return void s(t, r, r + n - 1, i);var u = e(t, r, n);if (!u.inOrder) {
      var d = u.min,
          p = u.max,
          g = p - d;if (0 !== g) {
        var y, m;for (h.fill(0), h[c] = 1, y = 0; y < n; y++) {
          m = Math.floor((c - 1) * (f(t[y + r]) - d) / g), h[m]++;
        }for (l.fill(0), l[c] = n, l[0] = r, y = 1; y < c; y++) {
          l[y] = l[y - 1] + h[y - 1];
        }for (var v = r, x = 0; x < c;) {
          m = Math.floor((c - 1) * (f(t[v]) - d) / g);var w = l[m] + --h[m];for (o(t, v, w); !h[x];) {
            x++;
          }v = l[x];
        }for (y = 0; y < c; y++) {
          h[y] = l[y + 1] - l[y];
        }for (y = 0; y < c; y++) {
          h[y] > 1 && a(t, l[y], h[y]);
        }
      }
    }
  }function o(t, e, r) {
    var n = t[e];t[e] = t[r], t[r] = n;
  }function s(t, e, r, n) {
    t.length;if (e < r) {
      var i = u(t, r, e, r, n);s(t, e, i - 1, n), s(t, i + 1, r, n);
    }return t;
  }function u(t, e, r, n, i) {
    for (var a = t[e], s = r, u = r; u < n; u++) {
      i(t[u], a) < 0 && (o(t, u, s), s++);
    }return o(t, n, s), s;
  }var l,
      h,
      f,
      c = 1e3,
      d = { min: 0, max: 0, inOrder: !1 };return t(c), n;
}), define("shaders/fragment-shader.glsl", [], function () {
  return "\n    \nuniform sampler2D texture[ 16 ];\nvarying vec2 vUv;\nvarying float vTex;\nvarying float vLight;\n\nvoid main() {\n    vec2 uv = vUv;\n\n    int iTex = int(vTex);\n\n    if(iTex==0) {\n        gl_FragColor = texture2D( texture[0],  uv);\n    } else if(iTex==1) {\n        gl_FragColor = texture2D( texture[1],  uv);\n    } else if(iTex==2) {\n        gl_FragColor = texture2D( texture[2],  uv);\n    } else if(iTex==3) {\n        gl_FragColor = texture2D( texture[3],  uv);\n    } else if(iTex==4) {\n        gl_FragColor = texture2D( texture[4],  uv);\n    } else if(iTex==5) {\n        gl_FragColor = texture2D( texture[5],  uv);\n    } else if(iTex==6) {\n        gl_FragColor = texture2D( texture[6],  uv);\n    } else if(iTex==7) {\n        gl_FragColor = texture2D( texture[7],  uv);\n    } else if(iTex==8) {\n        gl_FragColor = texture2D( texture[8],  uv);\n    } else if(iTex==9) {\n        gl_FragColor = texture2D( texture[9],  uv);\n    } else if(iTex==10) {\n        gl_FragColor = texture2D( texture[10],  uv);\n    } else if(iTex==11) {\n        gl_FragColor = texture2D( texture[11],  uv);\n    } else if(iTex==12) {\n        gl_FragColor = texture2D( texture[12],  uv);\n    } else if(iTex==13) {\n        gl_FragColor = texture2D( texture[13],  uv);\n    } else if(iTex==14) {\n        gl_FragColor = texture2D( texture[14],  uv);\n    } else if(iTex==15) {\n        gl_FragColor = texture2D( texture[15],  uv);\n    }\n\n    gl_FragColor.x *= vLight;\n    gl_FragColor.y *= vLight;\n    gl_FragColor.z *= vLight;\n//        gl_FragColor.w *= vLight;\n//    gl_FragColor.w = .5;\n}\n\n    ";
}), define("shaders/vertex-shader.glsl", [], function () {
  return "\n    \nvarying vec2 vUv;\nattribute float tex;\nattribute float light;\nattribute vec3 spot;\nattribute vec4 quaternion;\nvarying float vTex;\nvarying float vLight;\nuniform vec3 vCam;\nuniform float curvature;\n\nvoid main()  {\n    vTex = tex;\n    vUv = uv;\n\n    vec3 newPosition = rotateVectorByQuaternion( position - spot, quaternion ) + spot;\n    vLight = 1.0/ sqrt(500.0 / distance(newPosition, vCam)) * light;\n\n    float dist = distance(newPosition, vCam);\n    newPosition.z = newPosition.z - curvature * (dist*dist)/20000.0;\n\n    vec4 mvPosition = modelViewMatrix * vec4(newPosition, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n}    \n\n    ";
}), define("shaders/vertex-shader-common.glsl", [], function () {
  return "\n\nvec3 rotateVectorByQuaternion( in vec3 v, in vec4 q ) {\n\n    vec3 dest = vec3( 0.0 );\n\n    float x = v.x, y  = v.y, z  = v.z;\n    float qx = q.x, qy = q.y, qz = q.z, qw = q.w;\n\n    // calculate quaternion * vector\n\n    float ix =  qw * x + qy * z - qz * y,\n          iy =  qw * y + qz * x - qx * z,\n          iz =  qw * z + qx * y - qy * x,\n          iw = -qx * x - qy * y - qz * z;\n\n    // calculate result * inverse quaternion\n\n    dest.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n    dest.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n    dest.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n\n    return dest;\n\n}\n\nvec4 axisAngleToQuaternion( in vec3 axis, in float angle ) {\n\n    vec4 dest = vec4( 0.0 );\n\n    float halfAngle = angle / 2.0,\n          s = sin( halfAngle );\n\n    dest.x = axis.x * s;\n    dest.y = axis.y * s;\n    dest.z = axis.z * s;\n    dest.w = cos( halfAngle );\n\n    return dest;\n\n}    \n    \n    ";
}), define("shader", ["shaders/fragment-shader.glsl", "shaders/vertex-shader.glsl", "shaders/vertex-shader-common.glsl"], function (t, e, r) {
  return { fragmentShader: t, vertexShader: r + e };
}), define("spriterenderer", ["threejs", "utils", "spriteobject", "spritesheet", "camera", "turbosort", "shader"], function (t, e, r, n, i, a, o) {
  "use strict";
  function s() {
    this.images = [], this.imageOrder = [], this.imageCount = 0, this.mesh = h(this), this.curvature = 0;var t = this;this.display = function (e) {
      var r = null,
          a = e && e.visible !== !1 ? n.getCut(e.img) : null;if (a && a.ready) {
        var o = t.imageCount;t.images[o] || (t.images[o] = new u(), t.images[o].index = o), r = t.images[o];for (var s = 0; s < w.length; s++) {
          r.indexArray[s] = w[s] + 4 * r.index;
        }var l = e.hasQuaternionArray ? e.quaternionArray : i.getCameraQuaternionData().array;if (r.quaternionArray[0] === l[0] && r.quaternionArray[1] === l[1] && r.quaternionArray[2] === l[2] && r.quaternionArray[3] === l[3] || (l.splatter(r.quaternionArray, 0).splatter(r.quaternionArray, 4).splatter(r.quaternionArray, 8).splatter(r.quaternionArray, 12), r.quatDirty = !0), e.position.equals(r.position) || (r.position.copy(e.position), r.position.toArray(r.spotArray), r.position.toArray(r.spotArray, 3), r.position.toArray(r.spotArray, 6), r.position.toArray(r.spotArray, 9), r.positionDirty = !0), e.size[0] !== r.size[0] || e.size[1] !== r.size[1] || e.size[2] !== r.size[2] || r.positionDirty) {
          r.size[0] = e.size[0], r.size[1] = e.size[1], r.size[2] = e.size[2];for (var h = v.attributes.position.array, f = 0; f < h.length; f++) {
            r.vertices[f] = h[f] * e.size[f % 3] + r.spotArray[f];
          }r.verticesDirty = !0;
        }r.uv !== a.uv && (r.uv = a.uv, r.uvDirty = !0), r.tex !== a.tex && (r.tex = a.tex, r.texDirty = !0), r.light !== e.light && (r.light = e.light, r.lightDirty = !0), r.spriteObject = e, t.imageOrder[o] = r, t.imageCount++;
      }return r;
    }, b.push(this);
  }function u() {
    this.position = new t.Vector3(), this.spotArray = new Float32Array(3 * x), this.size = new Float32Array(3), this.vertices = new Float32Array(v.attributes.position.array.length), this.quaternionArray = new Float32Array(4 * x), this.indexArray = new Uint16Array(w.length);
  }function l() {
    this.imageCount = 0, r.clear();
  }function h(e) {
    var r = new t.BufferGeometry(),
        a = new Float32Array([-1, -1, 1, 1, -1, 1, 1, 1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1]);r.addAttribute("position", new t.BufferAttribute(a, 3));var s = new t.Mesh(r, new t.MeshBasicMaterial());return s.material = new t.ShaderMaterial({ uniforms: A = { texture: { type: "tv", get value() {
            return n.getTextures();
          } }, vCam: { type: "v3", get value() {
            return i.getCamera().position;
          } }, curvature: { type: "f", get value() {
            return e.curvature || 0;
          } } }, vertexShader: o.vertexShader, fragmentShader: o.fragmentShader, transparent: !0, depthWrite: !1, depthTest: !0 }), s.frustumCulled = !1, s;
  }function f(t, e) {
    for (var r = i.getCamera(), n = 0; n < e; n++) {
      t[n].zIndex = -r.position.distanceToManhattan(t[n].position);
    }I(t, e), a(t, e, d);
  }function c(t) {
    I = t ? t : function () {};
  }function d(t) {
    return t.zIndex;
  }function p() {
    var e = this.imageCount,
        r = v.attributes.position.count,
        n = void 0,
        i = this.mesh,
        a = i.geometry;if ((!a.attributes.position || a.attributes.position.count < e * r) && (n = a.attributes.position, a.attributes.position = new t.BufferAttribute(new Float32Array(e * r * 3), 3), n && a.attributes.position.copyArray(n.array), a.attributes.position.setDynamic(!0)), (!a.attributes.spot || a.attributes.spot.count < e * r) && (n = a.attributes.spot, a.attributes.spot = new t.BufferAttribute(new Float32Array(e * r * 3), 3), n && a.attributes.spot.copyArray(n.array), a.attributes.spot.setDynamic(!0)), (!a.attributes.quaternion || a.attributes.quaternion.count < e * r) && (n = a.attributes.quaternion, a.attributes.quaternion = new t.BufferAttribute(new Float32Array(e * r * 4), 4), n && a.attributes.quaternion.copyArray(n.array), a.attributes.quaternion.setDynamic(!0)), (!a.attributes.uv || a.attributes.uv.count < e * r) && (n = a.attributes.uv, a.attributes.uv = new t.BufferAttribute(new Float32Array(e * r * 2), 2), n && a.attributes.uv.copyArray(n.array), a.attributes.uv.setDynamic(!0)), (!a.attributes.tex || a.attributes.tex.count < e * r) && (n = a.attributes.tex, a.attributes.tex = new t.BufferAttribute(new Float32Array(e * r), 1), n && a.attributes.tex.copyArray(n.array), a.attributes.tex.setDynamic(!0)), (!a.attributes.light || a.attributes.light.count < e * r) && (n = a.attributes.light, a.attributes.light = new t.BufferAttribute(new Float32Array(e * r), 1), n && a.attributes.light.copyArray(n.array), a.attributes.light.setDynamic(!0)), !a.index || a.index.count < e * v.index.array.length) {
      n = a.index;var o = v.index.array;a.index = new t.BufferAttribute(new Uint16Array(e * o.length), 1), n && a.index.copyArray(n.array), a.index.setDynamic(!0);
    }f(this.imageOrder, e);
  }function g() {
    this.render();for (var t = this.images, e = this.imageOrder, r = this.imageCount, n = this.mesh.geometry, i = n.attributes.quaternion.array, a = n.attributes.spot.array, o = n.attributes.position.array, s = n.attributes.tex.array, u = n.attributes.light.array, l = n.attributes.uv.array, h = n.index.array, f = !1, c = !1, d = !1, p = !1, g = !1, y = !1, m = 0; m < r; m++) {
      var x = t[m],
          w = x.index;x.quatDirty && (x.quaternionArray.splatter(i, 16 * w), x.quatDirty = !1, f = !0), x.positionDirty && (x.spotArray.splatter(a, 12 * w), x.positionDirty = !1, c = !0), x.verticesDirty && (x.vertices.splatter(o, 12 * w), x.verticesDirty = !1, p = !0), x.uvDirty && (x.uv.splatter(l, 8 * w), x.uvDirty = !1, g = !0), x.texDirty && (s.fill(x.tex, 4 * w, 4 * w + 4), x.texDirty = !1, d = !0), x.lightDirty && (u.fill(x.light, 4 * w, 4 * w + 4), x.lightDirty = !1, y = !0);
    }for (var b = 0; b < r; b++) {
      e[b].indexArray.splatter(h, 6 * b);
    }0 === n.drawRange.start && n.drawRange.count === r * v.index.count || n.setDrawRange(0, r * v.index.count), y && (n.attributes.light.needsUpdate = !0), f && (n.attributes.quaternion.needsUpdate = !0), c && (n.attributes.spot.needsUpdate = !0), p && (n.attributes.position.needsUpdate = !0), d && (n.attributes.tex.needsUpdate = !0), g && (n.attributes.uv.needsUpdate = !0), n.index.needsUpdate = !0, this.clear();
  }function y() {
    for (var t = 0; t < b.length; t++) {
      b[t].destroy();
    }b.length = 0;
  }function m() {
    this.mesh && (this.mesh.geometry.dispose(), this.mesh.material.dispose()), this.mesh = null, this.images.length = 0, this.imageCount = 0;
  }var v = new t.PlaneBufferGeometry(1, 1),
      x = v.attributes.position.count,
      w = v.index.array,
      b = [],
      A = null,
      I = function I() {};return s.prototype.destroy = m, s.prototype.render = p, s.prototype.updateGraphics = g, s.prototype.clear = l, u.prototype.index = 0, u.prototype.position = null, u.prototype.spotArray = null, u.prototype.indexArray = null, u.prototype.tex = -1, u.prototype.size = null, u.prototype.uv = null, u.prototype.vertices = null, u.prototype.light = 1, u.prototype.zIndex = 0, u.prototype.quaternionArray = null, u.prototype.positionDirty = !0, u.prototype.verticesDirty = !0, u.prototype.texDirty = !0, u.prototype.uvDirty = !0, u.prototype.lightDirty = !0, u.prototype.quatDirty = !0, u.prototype.spriteObject = null, s.setIndexProcessor = c, e.onDestroy(y), s;
}), define("collection", ["utils", "spritesheet", "spriteobject", "camera"], function (t, e, r, n) {
  "use strict";
  function i() {}function a(e, r, n) {
    if (this.options = e || {}, this.getSprite = r ? r : i, n) this.forEach = n.bind(this);else switch (this.options.type) {case "grid":
        break;default:
        t.handleError("Collection type not recognized");}
  }function o(t) {
    for (var e = this.options.x, r = this.options.y, n = this.options.width, i = this.options.height, a = n * i, o = this.options.count || 1, s = a * o, u = 0; u < s; u++) {
      var l = e + u % n,
          h = r + Math.floor(u / n) % i,
          f = Math.floor(u / a),
          c = this.getSprite(l, h, f);c && (c.forEach ? c.forEach(t) : t(c));
    }
  }function s() {}function u(t) {
    var n = t.x,
        i = t.y,
        a = t.index,
        o = cellSize,
        s = 1,
        u = e.spritesheet.sprite[a];return r.create().init(n * cellSize, i * cellSize, o / 2, o, o, null, s, u);
  }function l(t) {
    return f.length = 0, cube.faces.push(r.create().init(x * cellSize, y * cellSize, size / 2, size, size, n.quaternions.southQuaternionArray, light, img)), f;
  }function h(t) {
    function e(t, e, r) {
      this.uid = "uid" + c++, h[this.uid] = this, this.index = r, this.enterArea(t, e);
    }function r(t, e) {
      return t = Math.floor(t / s), e = Math.floor(e / s), t + "_" + e;
    }function i() {
      var t = 64,
          e = n.getCamera(),
          r = e.position.x,
          i = e.position.y;return d.x = Math.round(r / t), d.y = Math.round(i / t) + 6, d;
    }var o = [],
        s = 50,
        h = {},
        f = function f(t) {
      switch (t.type) {case "face":
          return u(t);case "cube":
          return l(t);}
    };t.spriteFunction && (f = t.spriteFunction);var c = 0;e.prototype.leaveArea = function () {
      var t = r(this.x, this.y),
          e = o[t];if (e) {
        var n = Math.floor(this.x) + "_" + Math.floor(this.y);e[n] && delete e[n][this.uid];
      }
    }, e.prototype.enterArea = function (t, e) {
      this.x = t, this.y = e;var n = r(this.x, this.y),
          i = o[n] || (o[n] = {}),
          a = Math.floor(this.x) + "_" + Math.floor(this.y);i[a] = i[a] || (i[a] = {}), i[a][this.uid] = this;
    }, e.prototype.move = function (t, e) {
      this.leaveArea(), this.enterArea(t, e);
    };var d = { x: 0, y: 0 },
        p = new a(t, f, function (t) {
      for (var e = i(), r = Math.floor(e.x / s), n = Math.floor(e.y / s), a = 1, u = n - a; u <= n + a; u++) {
        for (var l = r - a; l <= r + a; l++) {
          var h = o[l + "_" + u];if (h) for (var f in h) {
            var c = h[f];for (var d in c) {
              var p = this.getSprite(c[d]);Array.isArray(p) ? p.forEach(t) : t(p);
            }
          }
        }
      }
    });return p.create = function (t, r, n) {
      return new e(t, r, n);
    }, p.get = function (t, e) {
      var n = r(t, e),
          i = o[n],
          a = Math.floor(t) + "_" + Math.floor(e);return i ? i[a] : null;
    }, p.find = function (t) {
      return h[t];
    }, p;
  }a.prototype.pos = null, a.prototype.size = null, a.prototype.getSprite = i, a.prototype.forEach = o, a.prototype.options = null, a.prototype.getSprite = i, a.prototype.isCollection = !0;var f = [];return a.createSpriteCollection = h, t.onDestroy(s), a;
}), define("mouse", ["utils"], function (t) {
  "use strict";
  function e(t) {
    if (void 0 === t.target.attributes.tap) {
      var e = t.changedTouches;if (e) for (var r = 0; r < e.length; r++) {
        var n = e[r];f[n.identifier] = n.pageX, c[n.identifier] = n.pageY;
      } else l.x = t.pageX, l.y = t.pageY;d = !0;for (var r = 0; r < h.length; r++) {
        h[r](null, null, !0, t.pageX, t.pageY);
      }
    }t.preventDefault();
  }function r(t) {
    var e = !1;if (t.changedTouches) {
      for (var r = 0; r < t.changedTouches.length; r++) {
        delete f[touch.identifier], delete c[touch.identifier];
      }for (var r in f) {
        e = !0;
      }
    }for (var r = 0; r < h.length; r++) {
      h[r](null, null, e, t.pageX, t.pageY);
    }d = !1, t.preventDefault();
  }function n(t) {
    t = t || event;var e = t.changedTouches;if (e) {
      if (d) {
        for (var r = 0, n = 0, i = 0; i < e.length; i++) {
          var a = e[i];r += a.pageX - f[a.identifier], n += a.pageY - c[a.identifier], f[a.identifier] = a.pageX, c[a.identifier] = a.pageY;
        }for (var i = 0; i < h.length; i++) {
          h[i](r, n, !0, t.pageX, t.pageY);
        }
      }
    } else {
      var o = "buttons" in t && 1 === t.buttons || 1 === (t.which || t.button);if (o && d) {
        var s = t.pageX,
            u = t.pageY,
            r = s - l.x,
            n = u - l.y;l.x = s, l.y = u;for (var i = 0; i < h.length; i++) {
          h[i](r, n, !0, t.pageX, t.pageY);
        }
      } else {
        d = !1;for (var i = 0; i < h.length; i++) {
          h[i](r, n, !1, t.pageX, t.pageY);
        }
      }
    }t.preventDefault();
  }function i(t) {
    o(), a(), h.push(t);
  }function a() {
    document.addEventListener("mousedown", e), document.addEventListener("touchstart", e), document.addEventListener("mouseup", r), document.addEventListener("touchend", r), document.addEventListener("touchcancel", r), document.addEventListener("mousemove", n), document.addEventListener("touchmove", n);
  }function o() {
    document.removeEventListener("mousedown", e), document.removeEventListener("touchstart", e), document.removeEventListener("mouseup", r), document.removeEventListener("touchend", r), document.removeEventListener("touchcancel", r), document.removeEventListener("mousemove", n), document.removeEventListener("touchmove", n);
  }function s() {
    h = [], o();
  }function u() {}var l = { x: 0, y: 0 },
      h = [],
      f = {},
      c = {},
      d = !1;return u.setOnTouch = i, t.onDestroy(s), u;
}), define("dobuki", ["utils", "loop", "gifHandler", "camera", "objectpool", "spriteobject", "packer", "spritesheet", "spriterenderer", "collection", "mouse", "loader"], function (t, e, r, n, i, a, o, s, u, l, h, f) {
  return { Utils: t, Loop: e, GifHandler: r, Camera: n, ObjectPool: i, SpriteObject: a, SpriteSheet: s, SpriteRenderer: u, Collection: l, Mouse: h, Loader: f };
}), requirejs.config({ paths: { threejs: "https://cdnjs.cloudflare.com/ajax/libs/three.js/85/three.min", dobuki: "dobuki", jsgif: "jsgif/gif" }, urlArgs: location.search.match(/\bdebug\b|\bdisable_cache\b/g) ? "time=" + Date.now() : "" }), require(["dobuki"], function (t) {}), define("main", function () {});
//# sourceMappingURL=dok.min.js.map