{"version":3,"sources":["../gifworkerwrapper.js"],"names":["define","gifWorkerCallbacks","GifWorker","onmessage","e","frameInfo","data","cData","header","id","plasterPixels","postMessage","buffer","img","gce","transparency","transparencyGiven","transparencyIndex","disposalMethod","ct","lctFlag","lct","gct","pixels","forEach","pixel","i","code","toString","substring","indexOf","lastIndexOf","blob","Blob","type","worker","Worker","URL","createObjectURL"],"mappings":";;AAAAA,OAAO,YAAW;AACd,QAAIC,qBAAqB,EAAzB;;AAEA,aAASC,SAAT,GAAqB;AACjBC,oBAAY,mBAASC,CAAT,EAAY;AACpB,gBAAIC,YAAYD,EAAEE,IAAF,CAAOD,SAAvB;AACA,gBAAIE,QAAQH,EAAEE,IAAF,CAAOC,KAAnB;AACA,gBAAIC,SAASJ,EAAEE,IAAF,CAAOE,MAApB;AACA,gBAAIC,KAAKL,EAAEE,IAAF,CAAOG,EAAhB;;AAEA,gBAAGJ,aAAaE,KAAb,IAAsBC,MAAzB,EAAiC;AAC7BE,8BAAcL,SAAd,EAAyBE,KAAzB,EAAgCC,MAAhC;AACH;AACDG,wBAAY,EAACF,IAAGA,EAAJ,EAAQF,OAAOA,KAAf,EAAsBF,WAAWA,SAAjC,EAAZ,EAAyD,CAACE,MAAMD,IAAN,CAAWM,MAAZ,CAAzD;AACH,SAVD;;AAYA,iBAASF,aAAT,CAAuBL,SAAvB,EAAkCE,KAAlC,EAAyCC,MAAzC,EAAiD;AAC7C,gBAAIK,MAAMR,UAAUQ,GAApB;AACA,gBAAIC,MAAMT,UAAUS,GAApB;AACA,gBAAIC,eAAeD,IAAIE,iBAAJ,GAAwBF,IAAIG,iBAA5B,GAAgD,IAAnE;AACA,gBAAIC,iBAAiBJ,IAAII,cAAzB;;AAEA,gBAAIC,KAAKN,IAAIO,OAAJ,GAAcP,IAAIQ,GAAlB,GAAwBb,OAAOc,GAAxC;;AAEAT,gBAAIU,MAAJ,CAAWC,OAAX,CAAmB,UAASC,KAAT,EAAgBC,CAAhB,EAAmB;AAClC,oBAAIX,iBAAiBU,KAArB,EAA4B;AAAE;AAC1BlB,0BAAMD,IAAN,CAAWoB,IAAI,CAAf,IAAwBP,GAAGM,KAAH,EAAU,CAAV,CAAxB;AACAlB,0BAAMD,IAAN,CAAWoB,IAAI,CAAJ,GAAQ,CAAnB,IAAwBP,GAAGM,KAAH,EAAU,CAAV,CAAxB;AACAlB,0BAAMD,IAAN,CAAWoB,IAAI,CAAJ,GAAQ,CAAnB,IAAwBP,GAAGM,KAAH,EAAU,CAAV,CAAxB;AACAlB,0BAAMD,IAAN,CAAWoB,IAAI,CAAJ,GAAQ,CAAnB,IAAwB,GAAxB,CAJwB,CAIK;AAChC,iBALD,MAKO,IAAIR,mBAAmB,CAAnB,IAAwBA,mBAAmB,CAA/C,EAAkD;AACrDX,0BAAMD,IAAN,CAAWoB,IAAI,CAAJ,GAAQ,CAAnB,IAAwB,CAAxB,CADqD,CAC1B;AAC9B;AACJ,aATD;AAUH;AACJ;;AAED,QAAIC,OAAOzB,UAAU0B,QAAV,EAAX;AACAD,WAAOA,KAAKE,SAAL,CAAeF,KAAKG,OAAL,CAAa,GAAb,IAAkB,CAAjC,EAAoCH,KAAKI,WAAL,CAAiB,GAAjB,CAApC,CAAP;;AAEA,QAAIC,OAAO,IAAIC,IAAJ,CAAS,CAACN,IAAD,CAAT,EAAiB,EAACO,MAAM,wBAAP,EAAjB,CAAX;AACA,QAAIC,SAAS,IAAIC,MAAJ,CAAWC,IAAIC,eAAJ,CAAoBN,IAApB,CAAX,CAAb;;AAEA,WAAOG,MAAP;AACH,CA5CD","file":"gifworkerwrapper.js","sourcesContent":["define(function() {\n    var gifWorkerCallbacks = {};\n\n    function GifWorker() {\n        onmessage = function(e) {\n            var frameInfo = e.data.frameInfo;\n            var cData = e.data.cData;\n            var header = e.data.header;\n            var id = e.data.id;\n\n            if(frameInfo && cData && header) {\n                plasterPixels(frameInfo, cData, header);\n            }\n            postMessage({id:id, cData: cData, frameInfo: frameInfo },[cData.data.buffer]);\n        };\n\n        function plasterPixels(frameInfo, cData, header) {\n            var img = frameInfo.img;\n            var gce = frameInfo.gce;\n            var transparency = gce.transparencyGiven ? gce.transparencyIndex : null;\n            var disposalMethod = gce.disposalMethod;\n\n            var ct = img.lctFlag ? img.lct : header.gct;\n\n            img.pixels.forEach(function(pixel, i) {\n                if (transparency !== pixel) { // This includes null, if no transparency was defined.\n                    cData.data[i * 4    ] = ct[pixel][0];\n                    cData.data[i * 4 + 1] = ct[pixel][1];\n                    cData.data[i * 4 + 2] = ct[pixel][2];\n                    cData.data[i * 4 + 3] = 255; // Opaque.\n                } else if (disposalMethod === 2 || disposalMethod === 3) {\n                    cData.data[i * 4 + 3] = 0; // Transparent.\n                }\n            });\n        }\n    }\n\n    var code = GifWorker.toString();\n    code = code.substring(code.indexOf(\"{\")+1, code.lastIndexOf(\"}\"));\n\n    var blob = new Blob([code], {type: \"application/javascript\"});\n    var worker = new Worker(URL.createObjectURL(blob));\n\n    return worker;\n});"]}