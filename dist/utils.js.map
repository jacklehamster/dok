{"version":3,"sources":["../utils.js"],"names":["define","fixPath","regex","exec","location","pathname","window","history","pushState","search","hash","changeScene","scene","htmlFile","Utils","destroyEverything","replace","handleError","error","soft","Array","isArray","array","i","length","push","console","apply","lastError","Error","combineMethods","firstMethod","secondMethod","expectParams","args","assert","arguments","type","split","indexOf","checkParams","condition","message","cleanUp","setupExit","document","onbeforeunload","onDestroy","callback","definePrototypes","String","prototype","trim","requestAnimationFrame","setupRequestAnimationFrame","Float32Array","fill","fill_compat","Uint32Array","Uint16Array","value","start","end","splatter","offset","getFrame","index","Number","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","requestAnimationFrame_compat","timeout","time","setTimeout","timeoutCallback","clearTimeout","dt","Date","now","loadAsyncHelper","src","result","binary","method","data","loadAsync","undefined","xhr","XMLHttpRequest","overrideMimeType","open","addEventListener","readyState","status","responseText","e","send","Roundabout","x","y","left","right","top","bottom","direction","point","reset","current","next","getTitle","title","makeArray","makeArrayHelper","slice","dimensions","slice_chunk","nop"],"mappings":"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","file":"utils.js","sourcesContent":["define(function() {\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function fixPath() {\n        const regex = /\\/$|index\\.html$|next\\.html$/g;\n        if (!regex.exec(location.pathname)) {\n            window.history.pushState(null,\"\", location.pathname+\"/\"+location.search+location.hash);\n        }\n    }\n\n    function changeScene(scene, htmlFile) {\n        if(typeof(htmlFile)==='undefined') {\n            htmlFile = 'scene.html';\n        }\n        Utils.destroyEverything();\n        location.replace(\"../\" + scene + \"/\" + htmlFile);\n    }\n\n    function handleError(error, soft) {\n        if(Array.isArray(error)) {\n            const array = [];\n            for(let i=0;i<error.length;i++) {\n                array.push(error[i]);\n                array.push(\"\\n \");\n            }\n            console.error.apply(null, array);\n        } else {\n            console.error(error);\n        }\n        Utils.lastError = error;\n        if(!soft) {\n            throw new Error(\"Last error terminated the process.\");\n        }\n    }\n\n    function combineMethods(firstMethod, secondMethod) {\n        return function() {\n            if(firstMethod)\n                firstMethod();\n            if(secondMethod)\n                secondMethod();\n        };\n    }\n\n    function expectParams(args) {\n        assert(typeof(args) === 'object', \"Pass 'arguments' to expectParams\");\n\n        for(let i=1; i<arguments.length; i++) {\n            const type = args[i-1]===null? 'null' : Array.isArray(args[i-1])?'array' : typeof(args[i-1]);\n            assert(\n                arguments[i].split(\"|\").indexOf(type)>=0,\n                [\"Expected argument \"+(i-1)+\" to be \"+arguments[i]+\" NOT \"+type, args]\n            );\n        }\n    }\n\n    function checkParams(args) {\n        assert(typeof(args) === 'object', \"Pass 'arguments' to expectParams\");\n\n        for(let i=1; i<arguments.length; i++) {\n            const type = args[i-1]===null? 'null' : Array.isArray(args[i-1])?'array' : typeof(args[i-1]);\n            if(arguments[i].split(\"|\").indexOf(type)<0) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    function assert(condition, message) {\n        if(!condition) {\n            handleError(message ? message: \"Assert failed: condition not met.\");\n        }\n    }\n\n    function cleanUp() {\n        Utils.destroyEverything();\n    }\n\n    function setupExit() {\n        document.onbeforeunload = window.onbeforeunload = cleanUp;\n    }\n\n    let destroyEverything = function() {};\n    function onDestroy(callback) {\n        destroyEverything = Utils.combineMethods(callback, destroyEverything);\n    }\n\n    function definePrototypes() {\n        if(typeof(String.prototype.trim) === \"undefined\") {\n            String.prototype.trim = function() {\n                return String(this).replace(/^\\s+|\\s+$/g, '');\n            };\n        }\n\n        if ( !window.requestAnimationFrame ) {\n            setupRequestAnimationFrame();\n        }\n\n        if (typeof(Float32Array.prototype.fill) === 'undefined') {\n            Float32Array.prototype.fill = fill_compat;\n        }\n\n        if (typeof(Uint32Array.prototype.fill) === 'undefined') {\n            Uint32Array.prototype.fill = fill_compat;\n        }\n\n        if (typeof(Uint16Array.prototype.fill) === 'undefined') {\n            Uint16Array.prototype.fill = fill_compat;\n        }\n\n        function fill_compat(value,start,end) {\n            start = start||0;\n            end = end||this.length;\n            for(let i=start;i<end;i++) {\n                this[i] = value;\n            }\n            return this;\n        }\n\n        function splatter(array, offset) {\n            for(let i = this.length-1; i>=0; i--) {\n                array[offset + i] = this[i];\n            }\n            return this;\n        }\n\n        Float32Array.prototype.splatter = splatter;\n        Uint32Array.prototype.splatter = splatter;\n        Uint16Array.prototype.splatter = splatter;\n\n        Array.prototype.getFrame = function (index) {\n            index = index|0;\n            return this[index % this.length];\n        };\n        Number.prototype.getFrame = function () {\n            return this;\n        }\n    }\n\n    function setupRequestAnimationFrame() {\n        window.requestAnimationFrame = ( function() {\n            return window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame ||\n                window.oRequestAnimationFrame ||\n                window.msRequestAnimationFrame ||\n                requestAnimationFrame_compat;\n\n        } )();\n\n        let timeout, time = 0;\n        function requestAnimationFrame_compat( callback) {\n            timeout = setTimeout( timeoutCallback, 1000 / 60 , callback);\n        }\n\n        function timeoutCallback(callback) {\n            clearTimeout(timeout);\n            const dt = Date.now() - time;\n            callback(dt);\n            time = Date.now();\n        }\n    }\n\n    function loadAsyncHelper(src, result, index, callback, binary, method, data) {\n        loadAsync(src, function(value) {\n            result[index] = value;\n            for(let i=0; i<result.length; i++) {\n                if(result[i]===undefined) {\n                    return;\n                }\n            }\n            callback.apply(null, result);\n        }, binary, method, data);\n    }\n\n    function loadAsync(src, callback, binary, method, data) {\n        if(Array.isArray(src)) {\n            const result = new Array(src.length);\n            for(let i=0; i<src.length; i++) {\n                loadAsyncHelper(src[i], result, i, callback);\n            }\n\n        } else {\n            const xhr = new XMLHttpRequest();\n            xhr.overrideMimeType(binary ? \"text/plain; charset=x-user-defined\" : \"text/plain; charset=UTF-8\");\n            xhr.open(method?method:\"GET\", src, true);\n            xhr.addEventListener('load',\n                function () {\n                    if (xhr.readyState === 4) {\n                        if (xhr.status === 200) {\n                            callback(xhr.responseText);\n                        } else {\n                            handleError(xhr.responseText);\n                        }\n                    }\n                }\n            );\n            xhr.addEventListener('error',\n                function (e) {\n                    handleError(e);\n                }\n            );\n            xhr.send(data);\n        }\n    }\n\n    //      C\n    //     748\n    //    B3019\n    //     625\n    //      A\n\n\n    function Roundabout() {\n        this.x = 0;\n        this.y = 0;\n        this.left = -1;\n        this.right = 1;\n        this.top = -1;\n        this.bottom = 1;\n        this.direction = 0; //  0-right, 1-bottom, 2-left, 3-up\n\n        let point = [0,0];\n\n        this.reset = function() {\n            this.x = 0;\n            this.y = 0;\n            this.left = -1;\n            this.right = 1;\n            this.top = -1;\n            this.bottom = 1;\n            this.direction = 0; //  0-right, 1-bottom, 2-left, 3-up\n        };\n\n        this.current = function() {\n            point[0] = this.x;\n            point[1] = this.y;\n            return point;\n        };\n\n        this.next = function () {\n            let point = this.current();\n            switch(this.direction) {\n                case 0:\n                    this.x++;\n                    if(this.x >= this.right) {\n                        this.right++;\n                        this.direction = (this.direction+1)%4;  //  change dir\n                    }\n                    break;\n                case 1:\n                    this.y++;\n                    if(this.y >= this.bottom) {\n                        this.bottom++;\n                        this.direction = (this.direction+1)%4;\n                    }\n                    break;\n                case 2:\n                    this.x--;\n                    if(this.x <= this.left) {\n                        this.left--;\n                        this.direction = (this.direction+1)%4;  //  change dir\n                    }\n                    break;\n                case 3:\n                    this.y--;\n                    if(this.y <= this.top) {\n                        this.top--;\n                        this.direction = (this.direction+1)%4;  //  change dir\n                    }\n                    break;\n            }\n            return point;\n        }\n    }\n\n    function getTitle() {\n        return title;\n    }\n\n    function makeArray() {  //  call like makArray(1,2) => [ [], [] ]\n        return makeArrayHelper(Array.prototype.slice.apply(arguments));\n    }\n\n    function makeArrayHelper(dimensions) {\n        const array = [];\n        array.length = dimensions[0];\n        if(dimensions.length > 1) {\n            const slice_chunk = dimensions.slice(1);\n            for(let i=0; i<array.length; i++) {\n                array[i] = makeArrayHelper(slice_chunk);\n            }\n        }\n        return array;\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    let title = \"\";\n\n\n    function Utils() {\n        this.lastError = null;\n    }\n    Utils.handleError = handleError;\n    Utils.changeScene = changeScene;\n    Utils.destroyEverything = destroyEverything;\n    Utils.combineMethods = combineMethods;\n    Utils.expectParams = expectParams;\n    Utils.checkParams = checkParams;\n    Utils.assert = assert;\n    Utils.fixPath = fixPath;\n    Utils.onDestroy = onDestroy;\n    Utils.loadAsync = loadAsync;\n    Utils.Roundabout = Roundabout;\n    Utils.getTitle = getTitle;\n    Utils.makeArray = makeArray;\n    Utils.nop = function(){};\n\n    /**\n     *   PROCESSES\n     */\n    setupExit();\n    definePrototypes();\n\n/*\n\n     function addLinkToHeadTag(rel, href) {\n         const link = document.createElement(\"link\");\n         link.setAttribute(\"rel\", rel);\n         link.href = href;\n         document.head.appendChild(link);\n     }\n\n\n     loadAsync(\"package.json\", function(str) {\n        try {\n            var object = JSON.parse(str);\n            var icon = object.window.icon || require.toUrl('images/logo.ico');\n            document.title = object.window.title || 'Dobuki Game';\n            addLinkToHeadTag(\"shortcut icon\", icon);\n            addLinkToHeadTag(\"apple-touch-icon\", object.window['apple-touch-icon'] || icon);\n        } catch(e) {\n        }\n    });\n*/\n\n    return Utils;\n});\n"]}