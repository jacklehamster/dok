{"version":3,"sources":["../utils.js"],"names":["define","fixPath","regex","exec","location","pathname","window","history","pushState","search","hash","changeScene","scene","htmlFile","Utils","destroyEverything","replace","handleError","error","soft","Array","isArray","array","i","length","push","console","apply","lastError","Error","combineMethods","firstMethod","secondMethod","expectParams","args","assert","arguments","type","split","indexOf","checkParams","condition","message","cleanUp","setupExit","document","onbeforeunload","onDestroy","callback","definePrototypes","String","prototype","trim","requestAnimationFrame","setupRequestAnimationFrame","Float32Array","fill","fill_compat","Uint32Array","getFrame","index","Number","value","start","end","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","requestAnimationFrame_compat","timeout","time","setTimeout","timeoutCallback","clearTimeout","dt","Date","now","loadAsyncHelper","src","result","binary","method","data","loadAsync","undefined","xhr","XMLHttpRequest","overrideMimeType","open","addEventListener","e","readyState","status","responseText","send","Roundabout","x","y","left","right","top","bottom","direction","point","reset","current","next","addLinkToHeadTag","rel","href","link","createElement","setAttribute","head","appendChild","getTitle","title"],"mappings":"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","file":"utils.js","sourcesContent":["define(function() {\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function fixPath() {\n        var regex = /\\/$|index\\.html$|next\\.html$/g;\n        if (!regex.exec(location.pathname)) {\n            window.history.pushState(null,\"\", location.pathname+\"/\"+location.search+location.hash);\n        }\n    }\n\n    function changeScene(scene, htmlFile) {\n        if(typeof(htmlFile)==='undefined') {\n            htmlFile = 'scene.html';\n        }\n        Utils.destroyEverything();\n        location.replace(\"../\" + scene + \"/\" + htmlFile);\n    }\n\n    function handleError(error, soft) {\n        if(Array.isArray(error)) {\n            var array = [];\n            for(var i=0;i<error.length;i++) {\n                array.push(error[i]);\n                array.push(\"\\n \");\n            }\n            console.error.apply(null, array);\n        } else {\n            console.error(error);\n        }\n        Utils.lastError = error;\n        if(!soft) {\n            throw new Error(\"Last error terminated the process.\");\n        }\n    }\n\n    function combineMethods(firstMethod, secondMethod) {\n        return function() {\n            if(firstMethod)\n                firstMethod();\n            if(secondMethod)\n                secondMethod();\n        };\n    }\n\n    function expectParams(args) {\n        assert(typeof(args) === 'object', \"Pass 'arguments' to expectParams\");\n\n        for(var i=1; i<arguments.length; i++) {\n            var type = args[i-1]===null? 'null' : Array.isArray(args[i-1])?'array' : typeof(args[i-1]);\n            assert(\n                arguments[i].split(\"|\").indexOf(type)>=0,\n                [\"Expected argument \"+(i-1)+\" to be \"+arguments[i]+\" NOT \"+type, args]\n            );\n        }\n    }\n\n    function checkParams(args) {\n        assert(typeof(args) === 'object', \"Pass 'arguments' to expectParams\");\n\n        for(var i=1; i<arguments.length; i++) {\n            var type = args[i-1]===null? 'null' : Array.isArray(args[i-1])?'array' : typeof(args[i-1]);\n            if(arguments[i].split(\"|\").indexOf(type)<0) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    function assert(condition, message) {\n        if(!condition) {\n            handleError(message ? message: \"Assert failed: condition not met.\");\n        }\n    }\n\n    function cleanUp() {\n        Utils.destroyEverything();\n    }\n\n    function setupExit() {\n        document.onbeforeunload = window.onbeforeunload = cleanUp;\n    }\n\n    var destroyEverything = function() {};\n    function onDestroy(callback) {\n        destroyEverything = Utils.combineMethods(callback, destroyEverything);\n    }\n\n    function definePrototypes() {\n        if(typeof(String.prototype.trim) === \"undefined\") {\n            String.prototype.trim = function() {\n                return String(this).replace(/^\\s+|\\s+$/g, '');\n            };\n        }\n\n        if ( !window.requestAnimationFrame ) {\n            setupRequestAnimationFrame();\n        }\n\n        if (typeof(Float32Array.prototype.fill) === 'undefined') {\n            Float32Array.prototype.fill = fill_compat;\n        }\n\n        if (typeof(Uint32Array.prototype.fill) === 'undefined') {\n            Uint32Array.prototype.fill = fill_compat;\n        }\n\n        Array.prototype.getFrame = function (index) {\n            index = index|0;\n            return this[index % this.length];\n        };\n        Number.prototype.getFrame = function () {\n            return this;\n        }\n\n    }\n\n    function fill_compat(value,start,end) {\n        start = start||0;\n        end = end||this.length;\n        for(var i=start;i<end;i++) {\n            this[i] = value;\n        }\n        return this;\n    }\n\n    function setupRequestAnimationFrame() {\n        window.requestAnimationFrame = ( function() {\n            return window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame ||\n                window.oRequestAnimationFrame ||\n                window.msRequestAnimationFrame ||\n                requestAnimationFrame_compat;\n\n        } )();\n\n        var timeout, time = 0;\n        function requestAnimationFrame_compat( callback) {\n            timeout = setTimeout( timeoutCallback, 1000 / 60 , callback);\n        }\n\n        function timeoutCallback(callback) {\n            clearTimeout(timeout);\n            var dt = Date.now() - time;\n            callback(dt);\n            time = Date.now();\n        }\n    }\n\n    function loadAsyncHelper(src, result, index, callback, binary, method, data) {\n        loadAsync(src, function(value) {\n            result[index] = value;\n            for(var i=0; i<result.length; i++) {\n                if(result[i]===undefined) {\n                    return;\n                }\n            }\n            callback.apply(null, result);\n        }, binary, method, data);\n    }\n\n    function loadAsync(src, callback, binary, method, data) {\n        if(Array.isArray(src)) {\n            var result = new Array(src.length);\n            for(var i=0; i<src.length; i++) {\n                loadAsyncHelper(src[i], result, i, callback);\n            }\n\n        } else {\n            var xhr = new XMLHttpRequest();\n            xhr.overrideMimeType(binary ? \"text/plain; charset=x-user-defined\" : \"text/plain; charset=UTF-8\");\n            xhr.open(method?method:\"GET\", src, true);\n            xhr.addEventListener('load',\n                function (e) {\n                    if (xhr.readyState === 4) {\n                        if (xhr.status === 200) {\n                            callback(xhr.responseText);\n                        } else {\n                            handleError(xhr.responseText);\n                        }\n                    }\n                }\n            );\n            xhr.addEventListener('error',\n                function (e) {\n                    handleError(e);\n                }\n            );\n            xhr.send(data);\n        }\n    }\n\n    //      C\n    //     748\n    //    B3019\n    //     625\n    //      A\n\n\n    function Roundabout() {\n        this.x = 0;\n        this.y = 0;\n        this.left = -1;\n        this.right = 1;\n        this.top = -1;\n        this.bottom = 1;\n        this.direction = 0; //  0-right, 1-bottom, 2-left, 3-up\n\n        var point = [0,0];\n\n        this.reset = function() {\n            this.x = 0;\n            this.y = 0;\n            this.left = -1;\n            this.right = 1;\n            this.top = -1;\n            this.bottom = 1;\n            this.direction = 0; //  0-right, 1-bottom, 2-left, 3-up\n        };\n\n        this.current = function() {\n            point[0] = this.x;\n            point[1] = this.y;\n            return point;\n        };\n\n        this.next = function () {\n            var point = this.current();\n            switch(this.direction) {\n                case 0:\n                    this.x++;\n                    if(this.x >= this.right) {\n                        this.right++;\n                        this.direction = (this.direction+1)%4;  //  change dir\n                    }\n                    break;\n                case 1:\n                    this.y++;\n                    if(this.y >= this.bottom) {\n                        this.bottom++;\n                        this.direction = (this.direction+1)%4;\n                    }\n                    break;\n                case 2:\n                    this.x--;\n                    if(this.x <= this.left) {\n                        this.left--;\n                        this.direction = (this.direction+1)%4;  //  change dir\n                    }\n                    break;\n                case 3:\n                    this.y--;\n                    if(this.y <= this.top) {\n                        this.top--;\n                        this.direction = (this.direction+1)%4;  //  change dir\n                    }\n                    break;\n            }\n            return point;\n        }\n    }\n\n    function addLinkToHeadTag(rel, href) {\n        var link = document.createElement(\"link\");\n        link.setAttribute(\"rel\", rel);\n        link.href = href;\n        document.head.appendChild(link);\n    }\n\n    function getTitle() {\n        return title;\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    var title = \"\";\n\n\n    function Utils() {\n        this.lastError = null;\n    }\n    Utils.handleError = handleError;\n    Utils.changeScene = changeScene;\n    Utils.destroyEverything = destroyEverything;\n    Utils.combineMethods = combineMethods;\n    Utils.expectParams = expectParams;\n    Utils.checkParams = checkParams;\n    Utils.assert = assert;\n    Utils.fixPath = fixPath;\n    Utils.onDestroy = onDestroy;\n    Utils.loadAsync = loadAsync;\n    Utils.Roundabout = Roundabout;\n    Utils.getTitle = getTitle;\n\n    /**\n     *   PROCESSES\n     */\n    setupExit();\n    definePrototypes();\n\n/*    loadAsync(\"package.json\", function(str) {\n        try {\n            var object = JSON.parse(str);\n            var icon = object.window.icon || require.toUrl('images/logo.ico');\n            document.title = object.window.title || 'Dobuki Game';\n            addLinkToHeadTag(\"shortcut icon\", icon);\n            addLinkToHeadTag(\"apple-touch-icon\", object.window['apple-touch-icon'] || icon);\n        } catch(e) {\n        }\n    });\n*/\n\n    return Utils;\n});"]}