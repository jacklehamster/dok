{"version":3,"sources":["../mouse.js"],"names":["define","Utils","spot","x","y","callbacks","touchSpotX","touchSpotY","mdown","onDown","e","target","attributes","undefined","touches","changedTouches","i","length","touch","identifier","pageX","pageY","preventDefault","onUp","hasTouch","onMove","event","buttonDown","buttons","which","button","newX","newY","dx","dy","setOnTouch","func","deactivateTouch","activateTouch","push","document","addEventListener","removeEventListener","destroyEverything","Mouse","onDestroy"],"mappings":"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","file":"mouse.js","sourcesContent":["define([ 'utils' ], function(Utils) {\n\n    'use strict';\n\n    var spot = {x:0,y:0}, callbacks = [];\n    var touchSpotX = {}, touchSpotY = {};\n    var mdown = false;\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */   \n    function onDown(e)\n    {\n        if(e.target.attributes['tap']===undefined) {\n            var touches = e.changedTouches;\n            if(touches) {\n                for(var i=0;i<touches.length;i++) {\n                    var touch = touches[i];\n                    touchSpotX[touch.identifier] =touch.pageX;\n                    touchSpotY[touch.identifier] =touch.pageY;\n                }\n            } else {\n                spot.x = e.pageX;\n                spot.y = e.pageY;\n            }\n            mdown = true;\n            for(var i=0;i<callbacks.length;i++) {\n                callbacks[i](null,null,true,e.pageX,e.pageY);\n            }\n        }\n        e.preventDefault();\n    }\n    \n    function onUp(e) {\n\n        var hasTouch = false;\n        if(e.changedTouches) {\n            for(var i=0;i<e.changedTouches.length;i++) {\n                delete touchSpotX[touch.identifier];\n                delete touchSpotY[touch.identifier];\n            }\n            for(var i in touchSpotX) {\n                hasTouch = true;\n            }\n\n        }\n\n        for(var i=0;i<callbacks.length;i++) {\n            callbacks[i](null,null, hasTouch,e.pageX,e.pageY);\n        }\n        mdown = false;\n        e.preventDefault();\n    }\n    \n    function onMove(e) {\n        e = e || event;\n        var touches = e.changedTouches;\n        if(!touches) {\n            var buttonDown = ('buttons' in e) && e.buttons===1 || (e.which || e.button) ===1;\n\n            if(buttonDown && mdown) {\n                var newX = e.pageX;\n                var newY = e.pageY;\n                var dx = newX - spot.x;\n                var dy = newY - spot.y;\n                spot.x = newX;\n                spot.y = newY;\n                for(var i=0;i<callbacks.length;i++) {\n                    callbacks[i](dx,dy,true,e.pageX,e.pageY);\n                }\n            } else {\n                mdown = false;\n                for(var i=0;i<callbacks.length;i++) {\n                    callbacks[i](dx,dy,false,e.pageX,e.pageY);\n                }\n            }\n        } else if(mdown) {\n            var dx = 0, dy = 0;\n            for(var i=0;i<touches.length;i++) {\n                var touch = touches[i];\n                dx += touch.pageX - touchSpotX[touch.identifier];\n                dy += touch.pageY - touchSpotY[touch.identifier];\n                touchSpotX[touch.identifier] = touch.pageX;\n                touchSpotY[touch.identifier] = touch.pageY;\n            }\n            for(var i=0;i<callbacks.length;i++) {\n                callbacks[i](dx,dy,true,e.pageX,e.pageY);\n            }\n        }\n        e.preventDefault();\n    }\n\n    function setOnTouch(func) {\n        deactivateTouch();\n        activateTouch();\n        callbacks.push(func);\n    }\n\n    function activateTouch() {\n\n        document.addEventListener(\"mousedown\", onDown);\n        document.addEventListener(\"touchstart\", onDown);\n        document.addEventListener(\"mouseup\", onUp);\n        document.addEventListener(\"touchend\", onUp);\n        document.addEventListener(\"touchcancel\", onUp);\n        document.addEventListener(\"mousemove\", onMove);\n        document.addEventListener(\"touchmove\", onMove);\n    }\n\n    function deactivateTouch() {\n        document.removeEventListener(\"mousedown\", onDown);\n        document.removeEventListener(\"touchstart\", onDown);\n        document.removeEventListener(\"mouseup\", onUp);\n        document.removeEventListener(\"touchend\", onUp);\n        document.removeEventListener(\"touchcancel\", onUp);\n        document.removeEventListener(\"mousemove\", onMove);\n        document.removeEventListener(\"touchmove\", onMove);\n    }\n\n    function destroyEverything() {\n        callbacks = [];\n        deactivateTouch();\n    }\n   \n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    function Mouse() {\n    }\n    Mouse.setOnTouch = setOnTouch;\n\n    Utils.onDestroy(destroyEverything);\n\n    return Mouse;\n\n });\n"]}