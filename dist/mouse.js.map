{"version":3,"sources":["../mouse.js"],"names":["define","Utils","spot","x","y","callbacks","wheelCallbacks","zoomCallbacks","touchSpotX","touchSpotY","pinchSize","mdown","onDown","e","target","attributes","undefined","touches","changedTouches","i","length","touch","identifier","pageX","pageY","dx","dy","dist","Math","sqrt","preventDefault","onUp","hasTouch","onMove","event","buttonDown","buttons","which","button","newX","newY","diff","onWheel","deltaX","deltaY","setOnTouch","func","deactivateTouch","activateTouch","push","setOnWheel","setOnZoom","document","addEventListener","removeEventListener","destroyEverything","Mouse","onDestroy"],"mappings":"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","file":"mouse.js","sourcesContent":["define([ 'utils' ], function(Utils) {\n\n    'use strict';\n\n    var spot = {x:0,y:0}, callbacks = [], wheelCallbacks = [], zoomCallbacks = [];\n    var touchSpotX = {}, touchSpotY = {}, pinchSize = 0;\n    var mdown = false;\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */   \n    function onDown(e)\n    {\n        if(e.target.attributes['tap']===undefined) {\n            var touches = e.changedTouches;\n            if(touches) {\n                for(var i=0;i<touches.length;i++) {\n                    var touch = touches[i];\n                    touchSpotX[touch.identifier] =touch.pageX;\n                    touchSpotY[touch.identifier] =touch.pageY;\n                }\n            } else {\n                spot.x = e.pageX;\n                spot.y = e.pageY;\n            }\n            mdown = true;\n            for(var i=0;i<callbacks.length;i++) {\n                callbacks[i](null,null,true,e.pageX,e.pageY);\n            }\n        }\n        if (touches.length === 2) {\n            var dx = touches[0].pageX - touches[1].pageY;\n            var dy = touches[0].pageY - touches[1].pageY;\n            var dist = Math.sqrt(dx*dx+dy*dy);\n            pinchSize = dist;\n        }\n        e.preventDefault();\n    }\n    \n    function onUp(e) {\n\n        var hasTouch = false;\n        if(e.changedTouches) {\n            var touches = e.changedTouches;\n            for(var i=0;i<touches.length;i++) {\n                var touch = touches[i];\n                delete touchSpotX[touch.identifier];\n                delete touchSpotY[touch.identifier];\n            }\n            for(var i in touchSpotX) {\n                hasTouch = true;\n            }\n\n        }\n\n        for(var i=0;i<callbacks.length;i++) {\n            callbacks[i](null,null, hasTouch,e.pageX,e.pageY);\n        }\n        mdown = false;\n        e.preventDefault();\n    }\n    \n    function onMove(e) {\n        e = e || event;\n        var touches = e.changedTouches;\n        if(!touches) {\n            var buttonDown = ('buttons' in e) && e.buttons===1 || (e.which || e.button) ===1;\n\n            if(buttonDown && mdown) {\n                var newX = e.pageX;\n                var newY = e.pageY;\n                var dx = newX - spot.x;\n                var dy = newY - spot.y;\n                spot.x = newX;\n                spot.y = newY;\n                for(var i=0;i<callbacks.length;i++) {\n                    callbacks[i](dx,dy,true,e.pageX,e.pageY);\n                }\n            } else {\n                mdown = false;\n                for(var i=0;i<callbacks.length;i++) {\n                    callbacks[i](dx,dy,false,e.pageX,e.pageY);\n                }\n            }\n        } else if(mdown) {\n            var dx = 0, dy = 0;\n            for(var i=0;i<touches.length;i++) {\n                var touch = touches[i];\n                dx += touch.pageX - touchSpotX[touch.identifier];\n                dy += touch.pageY - touchSpotY[touch.identifier];\n                touchSpotX[touch.identifier] = touch.pageX;\n                touchSpotY[touch.identifier] = touch.pageY;\n            }\n            for(var i=0;i<callbacks.length;i++) {\n                callbacks[i](dx,dy,true,e.pageX,e.pageY);\n            }\n            if (zoomCallbacks.length && touches.length === 2) {\n                var dx = touches[0].pageX - touches[1].pageY;\n                var dy = touches[0].pageY - touches[1].pageY;\n                var dist = Math.sqrt(dx*dx+dy*dy);\n                var diff = dist-pinchSize;\n                for(var i=0;i<zoomCallbacks.length;i++) {\n                    zoomCallbacks[i](diff);\n                }\n                pinchSize = dist;\n            }\n        }\n        e.preventDefault();\n    }\n\n    function onWheel(e) {\n        e = e || event;\n        for(var i=0;i<wheelCallbacks.length;i++) {\n            wheelCallbacks[i](e.deltaX,e.deltaY);\n        }\n    }\n\n    function setOnTouch(func) {\n        deactivateTouch();\n        activateTouch();\n        callbacks.push(func);\n    }\n\n    function setOnWheel(func) {\n        deactivateTouch();\n        activateTouch();\n        wheelCallbacks.push(func);\n    }\n\n    function setOnZoom(func) {\n        deactivateTouch();\n        activateTouch();\n        zoomCallbacks.push(func);\n    }\n\n    function activateTouch() {\n        document.addEventListener(\"mousedown\", onDown);\n        document.addEventListener(\"touchstart\", onDown);\n        document.addEventListener(\"mouseup\", onUp);\n        document.addEventListener(\"touchend\", onUp);\n        document.addEventListener(\"touchcancel\", onUp);\n        document.addEventListener(\"mousemove\", onMove);\n        document.addEventListener(\"touchmove\", onMove);\n        document.addEventListener(\"wheel\", onWheel);\n    }\n\n    function deactivateTouch() {\n        document.removeEventListener(\"mousedown\", onDown);\n        document.removeEventListener(\"touchstart\", onDown);\n        document.removeEventListener(\"mouseup\", onUp);\n        document.removeEventListener(\"touchend\", onUp);\n        document.removeEventListener(\"touchcancel\", onUp);\n        document.removeEventListener(\"mousemove\", onMove);\n        document.removeEventListener(\"touchmove\", onMove);\n        document.removeEventListener(\"wheel\", onWheel);\n    }\n\n    function destroyEverything() {\n        callbacks = [];\n        wheelCallbacks = [];\n        zoomCallbacks = [];\n        deactivateTouch();\n    }\n   \n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    function Mouse() {\n    }\n    Mouse.setOnTouch = setOnTouch;\n    Mouse.setOnWheel = setOnWheel;\n    Mouse.setOnZoom = setOnZoom;\n\n    Utils.onDestroy(destroyEverything);\n\n    return Mouse;\n\n });\n"]}