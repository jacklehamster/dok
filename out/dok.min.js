var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};define("utils",[],function(){function t(){var t=/\/$|index\.html$|next\.html$/g;t.exec(location.pathname)||window.history.pushState(null,"",location.pathname+"/"+location.search+location.hash)}function e(t,e){"undefined"==typeof e&&(e="scene.html"),y.destroyEverything(),location.replace("../"+t+"/"+e)}function r(t,e){if(Array.isArray(t)){for(var r=[],i=0;i<t.length;i++)r.push(t[i]),r.push("\n ");console.error.apply(null,r)}else console.error(t);if(y.lastError=t,!e)throw new Error("Last error terminated the process.")}function i(t,e){return function(){t&&t(),e&&e()}}function n(t){a("object"===("undefined"==typeof t?"undefined":_typeof(t)),"Pass 'arguments' to expectParams");for(var e=1;e<arguments.length;e++){var r=null===t[e-1]?"null":Array.isArray(t[e-1])?"array":_typeof(t[e-1]);a(arguments[e].split("|").indexOf(r)>=0,["Expected argument "+(e-1)+" to be "+arguments[e]+" NOT "+r,t])}}function o(t){a("object"===("undefined"==typeof t?"undefined":_typeof(t)),"Pass 'arguments' to expectParams");for(var e=1;e<arguments.length;e++){var r=null===t[e-1]?"null":Array.isArray(t[e-1])?"array":_typeof(t[e-1]);if(arguments[e].split("|").indexOf(r)<0)return!1}return!0}function a(t,e){t||r(e?e:"Assert failed: condition not met.")}function s(){y.destroyEverything()}function u(){document.onbeforeunload=window.onbeforeunload=s}function h(t){v=y.combineMethods(t,v)}function l(){"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}),window.requestAnimationFrame||c(),"undefined"==typeof Float32Array.prototype.fill&&(Float32Array.prototype.fill=f),"undefined"==typeof Uint32Array.prototype.fill&&(Uint32Array.prototype.fill=f),Array.prototype.getFrame=function(t){return t|=0,this[t%this.length]},Number.prototype.getFrame=function(){return this}}function f(t,e,r){e=e||0,r=r||this.length;for(var i=e;i<r;i++)this[i]=t;return this}function c(){function t(t){r=setTimeout(e,1e3/60,t)}function e(t){clearTimeout(r);var e=Date.now()-i;t(e),i=Date.now()}window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||t}();var r,i=0}function d(t,e,r,i,n,o,a){p(t,function(t){e[r]=t;for(var n=0;n<e.length;n++)if(void 0===e[n])return;i.apply(null,e)},n,o,a)}function p(t,e,i,n,o){if(Array.isArray(t))for(var a=new Array(t.length),s=0;s<t.length;s++)d(t[s],a,s,e);else{var u=new XMLHttpRequest;u.overrideMimeType(i?"text/plain; charset=x-user-defined":"text/plain; charset=UTF-8"),u.open(n?n:"GET",t,!0),u.addEventListener("load",function(t){4===u.readyState&&(200===u.status?e(u.responseText):r(u.responseText))}),u.addEventListener("error",function(t){r(t)}),u.send(o)}}function m(){this.x=0,this.y=0,this.left=-1,this.right=1,this.top=-1,this.bottom=1,this.direction=0;var t=[0,0];this.reset=function(){this.x=0,this.y=0,this.left=-1,this.right=1,this.top=-1,this.bottom=1,this.direction=0},this.current=function(){return t[0]=this.x,t[1]=this.y,t},this.next=function(){var t=this.current();switch(this.direction){case 0:this.x++,this.x>=this.right&&(this.right++,this.direction=(this.direction+1)%4);break;case 1:this.y++,this.y>=this.bottom&&(this.bottom++,this.direction=(this.direction+1)%4);break;case 2:this.x--,this.x<=this.left&&(this.left--,this.direction=(this.direction+1)%4);break;case 3:this.y--,this.y<=this.top&&(this.top--,this.direction=(this.direction+1)%4)}return t}}function g(){return b}function y(){this.lastError=null}var v=function(){},b="";return y.handleError=r,y.changeScene=e,y.destroyEverything=v,y.combineMethods=i,y.expectParams=n,y.checkParams=o,y.assert=a,y.fixPath=t,y.onDestroy=h,y.loadAsync=p,y.Roundabout=m,y.getTitle=g,u(),l(),y}),define("loop",["utils"],function(t){"use strict";function e(t){if(a){if(requestAnimationFrame(e),t<=o.time+u)return;o.time=Math.floor(t/u)*u;for(var r=0;a&&r<a.length;r++)a[r]();l++,t-h>1e3&&(s=l,l=0,h=t)}}function r(t){null===a&&(a=[],n()),a.push(t)}function i(t){if(a){var e=a.indexOf(t);a.splice(e,1),0===a.length&&(a=null)}}function n(){e(0)}function o(){}var a=null,s=0,u=Math.floor(1e3/60),h=0,l=0;return o.addLoop=r,o.removeLoop=i,t.onDestroy(o),Object.defineProperty(o,"fps",{enumerable:!1,configurable:!1,get:function(){return s},set:function(t){u=Math.floor(1e3/t)}}),o.time=0,o}),define("gifHandler",["utils","loop"],function(t,e){"use strict";function r(t){return f[t]&&f[t].block||".gif"===t.split("?")[0].slice(-4).toLowerCase()||0===t.indexOf("data:image/gif;")}function i(t){return f[t]||(f[t]=n(t)),f[t]}function n(r){var i=0,n=0,o=0,s={framesProcessed:0,header:null,frameInfos:[],block:null,canvases:[],callbacks:[],processNextFrame:function(){var t=this.framesProcessed,e=this.frameInfos[t];if(e&&e.gce&&e.img&&this.header){var r=document.createElement("canvas");r.style.position="absolute",r.style.left=0,r.style.top=0,r.width=this.header.width,r.height=this.header.height;var i=r.getContext("2d");i.webkitImageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1,i.msImageSmoothingEnabled=!1,this.canvases[t]=r,t>0&&i.drawImage(this.canvases[t-1],0,0);var s=i.getImageData(0,0,r.width,r.height),u=this,h=this.processNextFrame.bind(this);a(e,s,this.header,function(t,e){i.putImageData(t,0,0),u.callbacks[e.frame]&&u.callbacks[e.frame](),o=e.frame,u.frameInfos[e.frame].ready=!0,h()}),n=this.framesProcessed,this.framesProcessed++}},hdr:function(t){this.header=t},gce:function(t){(0==this.frameInfos.length||this.frameInfos[this.frameInfos.length-1].gce)&&this.frameInfos.push({gce:null,cycleTime:null,img:null,frame:this.frameInfos.length,ready:!1});var e=this.frameInfos.length-1;this.frameInfos[e].gce=t,t.delayTime||(t.delayTime=1),this.frameInfos[e].cycleTime=10*t.delayTime+(0===e?0:this.frameInfos[e-1].cycleTime),this.processNextFrame()},img:function(t){(0===this.frameInfos.length||this.frameInfos[this.frameInfos.length-1].img)&&this.frameInfos.push({}),this.frameInfos[this.frameInfos.length-1].img=t,this.processNextFrame()},getFrame:function(){if(this.block&&e.time>i){n=(n+1)%this.frameInfos.length;var t=this.frameInfos[this.frameInfos.length-1].cycleTime;i=Math.floor(e.time/t)*t+this.frameInfos[n].cycleTime}return Math.min(n,o)},eof:function(t){this.block=t,this.processNextFrame()}};return t.loadAsync(r,function(t){require(["https://jacklehamster.github.io/jsgif/gif.js"],function(){parseGIF(new Stream(t),s)})},!0),s}function o(){h=new Worker("https://jacklehamster.github.io/dok/dist/workers/gifworker.js"),h.onmessage=function(t){l[t.data.id](t.data.cData,t.data.frameInfo),delete l[t.data.id]}}function a(t,r,i,n){h||o(),require([" https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.7.0/js/md5.min.js"],function(o){var a=o(Math.random()+""+e.time);l[a]=n,h.postMessage({frameInfo:t,cData:r,header:i,id:a},[r.data.buffer])})}function s(){h&&h.terminate(),h=null,l=null,f={}}function u(){}var h,l={},f={};return u.getGif=i,u.isGif=r,t.onDestroy(s),u}),define("camera",["threejs","loop"],function(t,e){"use strict";function r(){return m}function i(t){t&&m!==y?(m=y,u(g,m)):t||m!==y||(m=g,u(y,m)),n()}function n(){m.quaternion.toArray(v.array),v.forwardMovement.set(0,0,1),v.forwardMovement.applyQuaternion(m.quaternion)}function o(){return m.quaternion.equals(b)||(n(),b.copy(m.quaternion)),v}function a(){g.position.set(0,0,400),y.position.set(0,0,400)}function s(){return m===y}function u(t,e){e.position.copy(t.position),e.quaternion.copy(t.quaternion)}function h(){return{is3d:s(),position:m.position.toArray(),quaternion:m.quaternion.toArray()}}function l(t){i(t.is3d),m.quaternion.fromArray(t.quaternion),m.position.fromArray(t.position),m.updateProjectionMatrix()}function f(t,e){var r=-Math.atan2(e-m.position.z,t-m.position.x)-Math.PI/2;return w.setFromAxisAngle(A,r),w.multiply(I),w.toArray(x)}function c(){var e={};return e.groundQuaternionArray=(new t.Quaternion).setFromAxisAngle(new t.Vector3(1,0,0),-Math.PI/2).toArray(new Float32Array(4)),e.southQuaternionArray=(new t.Quaternion).toArray(new Float32Array(4)),e.northQuaternionArray=(new t.Quaternion).setFromAxisAngle(new t.Vector3(0,1,0),-Math.PI).toArray(new Float32Array(4)),e.westQuaternionArray=(new t.Quaternion).setFromAxisAngle(new t.Vector3(0,1,0),-Math.PI/2).toArray(new Float32Array(4)),e.eastQuaternionArray=(new t.Quaternion).setFromAxisAngle(new t.Vector3(0,1,0),Math.PI/2).toArray(new Float32Array(4)),e.ceilingQuaternionArray=(new t.Quaternion).setFromAxisAngle(new t.Vector3(1,0,0),Math.PI/2).toArray(new Float32Array(4)),e}function d(){var t=innerWidth,e=innerHeight;g.left=-t/2,g.right=t/2,g.top=e/2,g.bottom=-e/2,g.updateProjectionMatrix(),y.aspect=t/e,y.updateProjectionMatrix()}function p(){}var m,g=new t.OrthographicCamera(-innerWidth/2,innerWidth/2,innerHeight/2,-innerHeight/2,.1,1e6),y=new t.PerspectiveCamera(75,innerWidth/innerHeight,.1,1e6),v={array:new Float32Array(4),forwardMovement:new t.Vector3(0,0,1),version:0},b=new t.Quaternion,w=new t.Quaternion,x=new Float32Array(4),A=new t.Vector3(0,1,0),I=(new t.Quaternion).setFromAxisAngle(new t.Vector3(1,0,0),-Math.PI/2);return p.setCamera3d=i,p.isCamera3d=s,p.getCamera=r,p.setCameraPosition=l,p.getCameraPosition=h,p.getCameraQuaternionData=o,p.shadowQuatArray=f,p.quaternions=c(),a(),i(!0),e.addLoop(d),p}),define("objectpool",["utils"],function(t){function e(t){this.pool=[],this.classObject=t}function r(){return this.index>=this.pool.length&&this.pool.push(new this.classObject),this.pool[this.index++]}function i(){this.index=0}function n(t){return t.pool||(t.pool=new e(t)),t.pool.create()}function o(t){t.pool&&t.pool.recycleAll()}return e.prototype.classObject=null,e.prototype.pool=null,e.prototype.index=0,e.prototype.create=r,e.prototype.recycleAll=i,e.create=n,e.recycleAll=o,e}),define("spriteobject",["threejs","objectpool"],function(t,e){"use strict";function r(){this.position=new t.Vector3,this.size=new Float32Array([0,0,1]),this.quaternionArray=new Float32Array(4).fill(0)}return r.prototype.init=function(t,e,r,i,n,o,a,s){return this.position.set(t,e,r),this.size[0]=i,this.size[1]=n,this.hasQuaternionArray=null!==o,o&&this.quaternionArray.set(o),this.light=a,this.img=s,this},r.prototype.position=null,r.prototype.size=null,r.prototype.hasQuaternionArray=!1,r.prototype.quaternionArray=null,r.prototype.light=1,r.prototype.img=-1,r.prototype.offset=null,r.create=function(t,i,n,o,a,s,u,h){return e.create(r).init(t,i,n,o,a,s,u,h)},r}),define("packer",["utils"],function(t){"use strict";function e(t,e,r,i,n){if(e+i>u||r+n>u)return!1;if(l[t])for(var o=0;o<i;o++)if(l[t][e+o])for(var a=0;a<n;a++)if(l[t][e+o][r+a])return!1;return!0}function r(t){if(t.width<=1&&t.height<=1)return null;if(t.width>u||t.height>u)return null;for(var r=Math.ceil(t.width/h),i=Math.ceil(t.height/h),n=0;n<s;n++)for(var o=0;o<u/h-r;o++)for(var a=0;a<u/h-i;a++)if(e(n,o,a,r,i))return{tex:n,x:o*h,y:a*h};return null}function i(t,e,r,i){l[t]||(l[t]=[]);for(var n=Math.ceil((i.width+1)/h),o=Math.ceil((i.height+1)/h),a=0;a<n;a++){l[t][e/h+a]||(l[t][e/h+a]=[]);for(var s=0;s<o;s++)l[t][e/h+a][r/h+s]=i}}function n(t){var e=r(t);return e&&i(e.tex,e.x,e.y,t),e}function o(){l.length=0}function a(){}var s=16,u=2048,h=8,l=[];return a.getSlot=n,t.onDestroy(o),a}),define("gifhandler",["utils","loop"],function(t,e){"use strict";function r(t){return f[t]&&f[t].block||".gif"===t.split("?")[0].slice(-4).toLowerCase()||0===t.indexOf("data:image/gif;")}function i(t){return f[t]||(f[t]=n(t)),f[t]}function n(r){var i=0,n=0,o=0,s={framesProcessed:0,header:null,frameInfos:[],block:null,canvases:[],callbacks:[],processNextFrame:function(){var t=this.framesProcessed,e=this.frameInfos[t];if(e&&e.gce&&e.img&&this.header){var r=document.createElement("canvas");r.style.position="absolute",r.style.left=0,r.style.top=0,r.width=this.header.width,r.height=this.header.height;var i=r.getContext("2d");i.webkitImageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1,i.msImageSmoothingEnabled=!1,this.canvases[t]=r,t>0&&i.drawImage(this.canvases[t-1],0,0);var s=i.getImageData(0,0,r.width,r.height),u=this,h=this.processNextFrame.bind(this);a(e,s,this.header,function(t,e){i.putImageData(t,0,0),u.callbacks[e.frame]&&u.callbacks[e.frame](),o=e.frame,u.frameInfos[e.frame].ready=!0,h()}),n=this.framesProcessed,this.framesProcessed++}},hdr:function(t){this.header=t},gce:function(t){(0==this.frameInfos.length||this.frameInfos[this.frameInfos.length-1].gce)&&this.frameInfos.push({gce:null,cycleTime:null,img:null,frame:this.frameInfos.length,ready:!1});var e=this.frameInfos.length-1;this.frameInfos[e].gce=t,t.delayTime||(t.delayTime=1),this.frameInfos[e].cycleTime=10*t.delayTime+(0===e?0:this.frameInfos[e-1].cycleTime),this.processNextFrame()},img:function(t){(0===this.frameInfos.length||this.frameInfos[this.frameInfos.length-1].img)&&this.frameInfos.push({}),this.frameInfos[this.frameInfos.length-1].img=t,this.processNextFrame()},getFrame:function(){if(this.block&&e.time>i){n=(n+1)%this.frameInfos.length;var t=this.frameInfos[this.frameInfos.length-1].cycleTime;i=Math.floor(e.time/t)*t+this.frameInfos[n].cycleTime}return Math.min(n,o)},eof:function(t){this.block=t,this.processNextFrame()}};return t.loadAsync(r,function(t){require(["https://jacklehamster.github.io/jsgif/gif.js"],function(){parseGIF(new Stream(t),s)})},!0),s}function o(){h=new Worker("https://jacklehamster.github.io/dok/dist/workers/gifworker.js"),h.onmessage=function(t){l[t.data.id](t.data.cData,t.data.frameInfo),delete l[t.data.id]}}function a(t,r,i,n){h||o(),require([" https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.7.0/js/md5.min.js"],function(o){var a=o(Math.random()+""+e.time);l[a]=n,h.postMessage({frameInfo:t,cData:r,header:i,id:a},[r.data.buffer])})}function s(){h&&h.terminate(),h=null,l=null,f={}}function u(){}var h,l={},f={};return u.getGif=i,u.isGif=r,t.onDestroy(s),u}),define("loader",["utils","loop"],function(t,e){"use strict";function r(t){y=t,document.body.removeChild(u())}function i(t,e){var r=new Image;return r.onload=function(t){e.call(r,t),p--,v++,o()},r.crossOrigin="",c.push({image:r,url:t}),b++,o(),r}function n(e,r){b++,t.loadAsync(e,function(t){v++,r(t)})}function o(){for(;f<c.length&&p<d;)c[f].image.src=c[f].url,f++,p++;f===c.length&&(f=0,c.length=0,v=0,b=0)}function a(){return b?v/b:1}function s(){if(m){var t=m.getContext("2d"),r=a();g=Math.max(0,g+(r-g)/10),r>=1&&(g=1,e.removeLoop(s)),t.fillRect(10,10,(m.width-20)*g,m.height-20),r>=1&&y&&setTimeout(y,100)}}function u(){if(!m){m=document.createElement("canvas"),m.id="loading",m.width=Math.round(2*innerWidth*2/3),m.height=50,m.style.left=innerWidth/2-m.width/4+"px",m.style.top=innerHeight/2-m.height/4+"px",m.style.width=m.width/2+"px",m.style.height=m.height/2+"px",m.style.position="absolute",m.style.backgroundColor="white",m.style.border="10px double #00DDDD";var t=m.getContext("2d");t.fillStyle="#0066aa",e.addLoop(s)}return document.body.appendChild(m),m}function h(){c.length=0}function l(){}var f=0,c=[],d=3,p=0,m=null,g=0,y=null,v=0,b=0;return l.loadImage=i,l.loadFile=n,l.getLoadingProgress=a,l.getLoadingBar=u,l.setOnLoad=r,t.onDestroy(h),l}),define("spritesheet",["threejs","utils","gifhandler","loader","packer"],function(t,e,r,i,n){"use strict";function o(e,r){if(!b[e]&&r){var i=b[e]=document.createElement("canvas");if(i.setAttribute("url",e),0===e.indexOf("tex-")){i.width=i.height=D;var n=parseInt(e.split("-").pop()),o=new t.Texture(i);o.magFilter=t.NearestFilter,o.minFilter=t.LinearMipMapLinearFilter,i.addEventListener("update",m),I[n]=o,i.setAttribute("texture",n.toString()),i.style.position="absolute",i.style.left=0,i.style.top=0}else i.width=i.height=1;a(i)}return b[e]}function a(t){var e=t.getContext("2d");e.webkitImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1}function s(t,e){var r=document.createEvent("CustomEvent");return r.initCustomEvent(t,!1,!1,e||{}),r}function u(t,e){var n=o(e+":"+t.join("|"));if(n)return n;if(t.length>1){n=o(e+":"+t.join("|"),!0);var f=t.slice(0,t.length-1),c=t[t.length-1],d=u(f,e);return n.setAttribute("base-url",d.getAttribute("base-url")),l(d,c,n),d.addEventListener("update",function(t){var e=t.currentTarget;l(e,c,n),n.dispatchEvent(s("update"))}),n}var p=t[0];n=o(e+":"+p,!0);var m=p.split("x");if(2!==m.length||isNaN(parseInt(m[0]))||isNaN(parseInt(m[1])))if(r.isGif(p)){var g=r.getGif(p);n.setAttribute("animated",!0),n.setAttribute("base-url",p),g.frameInfos[e]&&g.frameInfos[e].ready?h(g,e,n):g.callbacks[e]=h.bind(null,g,e,n)}else{n.setAttribute("base-url",p);var y=i.loadImage(p,function(){n.width=y.naturalWidth,n.height=y.naturalHeight,a(n),n.getContext("2d").drawImage(y,0,0),n.dispatchEvent(s("update"))})}else n.width=parseInt(m[0]),n.height=parseInt(m[1]);return n}function h(t,e,r){r.width=t.header.width,r.height=t.header.height,a(r),r.getContext("2d").drawImage(t.canvases[e],0,0),r.dispatchEvent(s("update"))}function l(t,e,r){var i=r.getContext("2d"),n=e.split(",");if(4===n.length&&n.every(function(t){return!isNaN(t)})){n=n.map(function(t){return parseInt(t)});var o=Math.min(t.width-n[0],n[2]),s=Math.min(t.height-n[1],n[3]);o>0&&s>0&&(r.width=o,r.height=s,a(r),i.drawImage(t,n[0],n[1],o,s,0,0,o,s))}else if(0===e.indexOf("scale:")){if(t.width>1&&t.height>1){var u=e.split(":")[1].split(",");if(r.width=Math.ceil(t.width*Math.abs(u[0])),r.height=Math.ceil(t.height*Math.abs(u[1%u.length])),a(r),u[0]<0||u[1%u.length]<0){var h=[u[0]<0?-1:1,u[1%u.length]<0?-1:1];i.translate(h[0]<0?r.width:0,h[1]<0?r.height:0),i.scale(h[0],h[1])}i.drawImage(t,0,0,t.width,t.height,0,0,r.width,r.height),i.restore()}}else if(0===e.indexOf("border")){r.width=t.width,r.height=t.height,a(r);var l=e.split(":")[1]||1;l.indexOf("%")>0&&(l=Math.round(parseFloat(l.split("%")[0])/100*Math.min(r.width,r.height))),i.drawImage(t,0,0),i.beginPath();for(var f=0;f<l;f++)i.rect(f,f,t.width-1-2*f,t.height-1-2*f);i.stroke()}else if(0===e.indexOf("text:"))r.width=t.width,r.height=t.height,a(r),i.fillStyle="#000000",i.font="18px Comic",i.fillText(e.split("text:")[1],0,t.height);else if(0===e.indexOf("shadow")){r.width=t.width,r.height=t.height,a(r);for(var c=t.getContext("2d"),d=c.getImageData(0,0,t.width,t.height),f=0;f<d.data.length;f+=4)0!==d.data[f+3]&&(d.data[f]=0,d.data[f+1]=0,d.data[f+2]=0,d.data[f+3]=127);i.putImageData(d,0,0)}else 0===e.indexOf("cross")&&(r.width=t.width,r.height=t.height,a(r),i.drawImage(t,0,0),i.beginPath(),i.moveTo(t.width/2,0),i.lineTo(t.width/2,t.height),i.moveTo(0,t.height/2),i.lineTo(t.width,t.height/2),i.stroke())}function f(t){var e=x[t],i=e&&e.animated?r.getGif(e.url).getFrame():0;return e&&e.cut[i]&&e.cut[i].ready?e.cut[i]:e&&e.url?(e=c(e.url,i),e.cut[i]):null}function c(t,e){if(w[t]&&w[t].cut[e]&&w[t].cut[e].ready)return w[t];var r=u(t.split("|"),e),i=n.getSlot(r),o=w[t];if(o||(o={index:A++,url:t,baseUrl:null,cut:[],animated:!1},w[t]=o,x[o.index]=o),o.cut[e]||(o.cut[e]={tex:0,uv:null,ready:!1,url:t,baseUrl:null}),i){M[r.getAttribute("url")]=i,r.addEventListener("update",p),r.dispatchEvent(s("update"));var a=i.x/D,h=i.y/D,l=r.width/D,f=r.height/D,c=F.attributes.uv.array,d=[a,1-h-f,a+l,1-h];o.animated="true"===r.getAttribute("animated"),o.cut[e].baseUrl=o.baseUrl=r.getAttribute("base-url"),o.cut[e].tex=i.tex,o.cut[e].uv=new Float32Array(c.length);for(var m=0;m<c.length;m++)o.cut[e].uv[m]=d[2*c[m]+m%2];return o.cut[e].ready=!0,o}return o}function d(t,e){if(void 0===e&&(e=v.spritesheet),"string"!=typeof t){for(var r in t)if(t.hasOwnProperty(r)){e[r]||(e[r]=[]);var i=v.preLoad(t[r],e[r]);null!==i&&(e[r]=i)}return console.log(e),e}var n=c(t,0);if(n)return n.index}function p(t){var e=t.currentTarget,r=e.getAttribute("url"),i=M[r],n=o("tex-"+i.tex,!0);n.getContext("2d").drawImage(e,i.x,i.y),n.dispatchEvent(s("update"))}function m(t){var e=t.currentTarget;I[parseInt(e.getAttribute("texture"))].needsUpdate=!0}function g(){I.forEach(function(t){t&&t.dispose()}),b={},w={},M={},I=[null]}function y(){return I}function v(){}var b={},w={},x=[],A=0,I=[null],M={},D=2048,F=new t.PlaneBufferGeometry(1,1);return v.getCut=f,v.getTextures=y,v.preLoad=d,v.fetchCanvas=u,v.spritesheet={},e.onDestroy(g),v}),define("turbosort",[],function(){function t(t){h||(h=new Uint32Array(t+1),l=new Uint32Array(t+1))}function e(t,r,i){for(var n=f(t[r]),o=n,a=n,s=n,u=!0,h=1;h<i;h++){var l=f(t[r+h]);s>l?(u=!1,l<o&&(o=l)):l>a&&(a=l),s=l}return e.result.min=o,e.result.max=a,e.result.inOrder=u,e.result}function r(t){return t}function i(t,e,i){t&&(e=e?Math.min(e,t.length):t.length,e>1&&(f=i?i:r,o(t,0,e?e:t.length)))}function n(t,e){return f(t)-f(e)}function o(t,r,i){if(i<500)return void s(t,r,r+i-1,n);var u=e(t,r,i);if(!u.inOrder){var d=u.min,p=u.max,m=p-d;if(0!==m){var g,y;for(l.fill(0),l[c]=1,g=0;g<i;g++)y=Math.floor((c-1)*(f(t[g+r])-d)/m),l[y]++;for(h.fill(0),h[c]=i,h[0]=r,g=1;g<c;g++)h[g]=h[g-1]+l[g-1];for(var v=r,b=0;b<c;){y=Math.floor((c-1)*(f(t[v])-d)/m);var w=h[y]+--l[y];for(a(t,v,w);!l[b];)b++;v=h[b]}for(g=0;g<c;g++)l[g]=h[g+1]-h[g];for(g=0;g<c;g++)l[g]>1&&o(t,h[g],l[g])}}}function a(t,e,r){if(e!==r){var i=t[e];t[e]=t[r],t[r]=i}}function s(t,e,r,i){var n,o;t.length;return e<r&&(n=r,o=u(t,n,e,r,i),s(t,e,o-1,i),s(t,o+1,r,i)),t}function u(t,e,r,i,n){for(var o=t[e],s=r,u=r;u<i;u++)n(t[u],o)<0&&(a(t,u,s),s++);return a(t,i,s),s}var h,l,f,c=1e3;return e.result={min:0,max:0,inOrder:!1},t(c),i}),define("spriterenderer",["threejs","utils","spriteobject","spritesheet","objectpool","camera","turbosort"],function(t,e,r,i,n,o,a){"use strict";function s(){this.images=[],this.imageOrder=[],this.imageCount=0,this.mesh=l();var t=this;this.display=function(e){var r=null,n=e&&e.visible!==!1?i.getCut(e.img):null;if(n&&n.ready){var a=t.imageCount;t.images[a]||(t.images[a]=new u,t.images[a].index=a),r=t.images[a];for(var s=0;s<w.length;s++)r.indexArray[s]=w[s]+4*r.index;var h=e.hasQuaternionArray?e.quaternionArray:o.getCameraQuaternionData().array;if(r.quaternionArray[0]===h[0]&&r.quaternionArray[1]===h[1]&&r.quaternionArray[2]===h[2]&&r.quaternionArray[3]===h[3]||(r.quaternionArray.set(h),r.quaternionArray.set(h,4),r.quaternionArray.set(h,8),r.quaternionArray.set(h,12),r.quatDirty=!0),e.position.equals(r.position)||(r.position.copy(e.position),r.position.toArray(r.spotArray),r.position.toArray(r.spotArray,3),r.position.toArray(r.spotArray,6),r.position.toArray(r.spotArray,9),r.positionDirty=!0),e.size[0]!==r.size[0]||e.size[1]!==r.size[1]||e.size[2]!==r.size[2]||r.positionDirty){r.size[0]=e.size[0],r.size[1]=e.size[1],r.size[2]=e.size[2];for(var l=v.attributes.position.array,f=0;f<l.length;f++)r.vertices[f]=l[f]*e.size[f%3]+r.spotArray[f];r.verticesDirty=!0}r.uv!==n.uv&&(r.uv=n.uv,r.uvDirty=!0),r.tex!==n.tex&&(r.tex=n.tex,r.texDirty=!0),r.light!==e.light&&(r.light=e.light,r.lightDirty=!0),r.spriteObject=e,t.imageOrder[a]=r,t.imageCount++}return r},x.push(this)}function u(){this.position=new t.Vector3,this.spotArray=new Float32Array(3*b),this.size=new Float32Array(3),this.vertices=new Float32Array(v.attributes.position.array.length),this.quaternionArray=new Float32Array(4*b),this.indexArray=new Uint16Array(w.length)}function h(){this.imageCount=0,n.recycleAll(r)}function l(){var r=new t.BufferGeometry,n=new Float32Array([-1,-1,1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1]);r.addAttribute("position",new t.BufferAttribute(n,3));var a=new t.Mesh(r,new t.MeshBasicMaterial);return e.loadAsync([require.toUrl("glsl/vertex-shader.glsl"),require.toUrl("glsl/fragment-shader.glsl"),require.toUrl("glsl/vertex-shader-common.glsl")],function(e,r,n){a.material=new t.ShaderMaterial({uniforms:A={texture:{type:"tv",get value(){return i.getTextures()}},vCam:{type:"v3",get value(){return o.getCamera().position}}},vertexShader:n+e,fragmentShader:r,transparent:!0,depthWrite:!1,depthTest:!0})}),a.frustumCulled=!1,a}function f(t,e){for(var r=o.getCamera(),i=0;i<e;i++)t[i].zIndex=-r.position.distanceToManhattan(t[i].position);I(t,e),a(t,e,d)}function c(t){I=t?t:function(){}}function d(t){return t.zIndex}function p(){var e,r=this.imageCount,i=v.attributes.position.count,n=this.mesh,o=n.geometry;if((!o.attributes.position||o.attributes.position.count<r*i)&&(e=o.attributes.position,o.attributes.position=new t.BufferAttribute(new Float32Array(r*i*3),3),e&&o.attributes.position.copyArray(e.array),o.attributes.position.setDynamic(!0)),(!o.attributes.spot||o.attributes.spot.count<r*i)&&(e=o.attributes.spot,o.attributes.spot=new t.BufferAttribute(new Float32Array(r*i*3),3),e&&o.attributes.spot.copyArray(e.array),o.attributes.spot.setDynamic(!0)),(!o.attributes.quaternion||o.attributes.quaternion.count<r*i)&&(e=o.attributes.quaternion,o.attributes.quaternion=new t.BufferAttribute(new Float32Array(r*i*4),4),e&&o.attributes.quaternion.copyArray(e.array),o.attributes.quaternion.setDynamic(!0)),(!o.attributes.uv||o.attributes.uv.count<r*i)&&(e=o.attributes.uv,o.attributes.uv=new t.BufferAttribute(new Float32Array(r*i*2),2),e&&o.attributes.uv.copyArray(e.array),o.attributes.uv.setDynamic(!0)),(!o.attributes.tex||o.attributes.tex.count<r*i)&&(e=o.attributes.tex,o.attributes.tex=new t.BufferAttribute(new Float32Array(r*i),1),e&&o.attributes.tex.copyArray(e.array),o.attributes.tex.setDynamic(!0)),(!o.attributes.light||o.attributes.light.count<r*i)&&(e=o.attributes.light,o.attributes.light=new t.BufferAttribute(new Float32Array(r*i),1),e&&o.attributes.light.copyArray(e.array),o.attributes.light.setDynamic(!0)),!o.index||o.index.count<r*v.index.array.length){e=o.index;var a=v.index.array;o.index=new t.BufferAttribute(new Uint16Array(r*a.length),1),e&&o.index.copyArray(e.array),o.index.setDynamic(!0)}f(this.imageOrder,r)}function m(){this.render();for(var t=this.images,e=this.imageOrder,r=this.imageCount,i=this.mesh.geometry,n=i.attributes.quaternion.array,o=i.attributes.spot.array,a=i.attributes.position.array,s=i.attributes.tex.array,u=i.attributes.light.array,h=i.attributes.uv.array,l=i.index.array,f=!1,c=!1,d=!1,p=!1,m=!1,g=!1,y=0;y<r;y++){var b=t[y],w=b.index;if(b.quatDirty){var x=b.quaternionArray;n.set(x,16*w),b.quatDirty=!1,f=!0}b.positionDirty&&(o.set(b.spotArray,12*w),b.positionDirty=!1,c=!0),b.verticesDirty&&(a.set(b.vertices,12*w),b.verticesDirty=!1,p=!0),b.uvDirty&&(h.set(b.uv,8*w),b.uvDirty=!1,m=!0),b.texDirty&&(s.fill(b.tex,4*w,4*w+4),b.texDirty=!1,d=!0),b.lightDirty&&(u.fill(b.light,4*w,4*w+4),b.lightDirty=!1,g=!0)}for(y=0;y<r;y++)l.set(e[y].indexArray,6*y);0===i.drawRange.start&&i.drawRange.count===r*v.index.count||i.setDrawRange(0,r*v.index.count),g&&(i.attributes.light.needsUpdate=!0),f&&(i.attributes.quaternion.needsUpdate=!0),c&&(i.attributes.spot.needsUpdate=!0),p&&(i.attributes.position.needsUpdate=!0),d&&(i.attributes.tex.needsUpdate=!0),m&&(i.attributes.uv.needsUpdate=!0),i.index.needsUpdate=!0,this.clear()}function g(){for(var t=0;t<x.length;t++)x[t].destroy();x.length=0}function y(){this.mesh&&(this.mesh.geometry.dispose(),this.mesh.material.dispose()),this.mesh=null,this.images.length=0,this.imageCount=0}var v=new t.PlaneBufferGeometry(1,1),b=v.attributes.position.count,w=v.index.array,x=[],A=null,I=function(){};return s.prototype.destroy=y,s.prototype.render=p,s.prototype.updateGraphics=m,s.prototype.clear=h,u.prototype.index=0,u.prototype.position=null,u.prototype.spotArray=null,u.prototype.indexArray=null,u.prototype.tex=-1,u.prototype.size=null,u.prototype.uv=null,u.prototype.vertices=null,u.prototype.light=1,u.prototype.zIndex=0,u.prototype.quaternionArray=null,u.prototype.positionDirty=!0,u.prototype.verticesDirty=!0,u.prototype.texDirty=!0,u.prototype.uvDirty=!0,u.prototype.lightDirty=!0,u.prototype.quatDirty=!0,u.prototype.spriteObject=null,s.setIndexProcessor=c,e.onDestroy(g),s}),define("collection",["utils","spritesheet","spriteobject","camera"],function(t,e,r,i){"use strict";function n(){}function o(e,r,i){if(this.options=e||{},this.getSprite=r?r:n,i)this.forEach=i.bind(this);else switch(this.options.type){case"grid":this.forEach=a.bind(this);break;default:t.handleError("Collection type not recognized")}}function a(t){for(var e=this.options.count||1,r=this.options.width*this.options.height,i=r*e,n=0;n<i;n++){var o=this.options.x+n%this.options.width,a=this.options.y+Math.floor(n/this.options.width)%this.options.height,s=Math.floor(n/r),u=this.getSprite(o,a,s);u&&(u.forEach?u.forEach(t):t(u))}}function s(){}function u(t){var i=t.x,n=t.y,o=t.index,a=cellSize,s=1,u=e.spritesheet.sprite[o];return r.create().init(i*cellSize,n*cellSize,a/2,a,a,null,s,u)}function h(t){return f.length=0,cube.faces.push(r.create().init(x*cellSize,y*cellSize,size/2,size,size,i.quaternions.southQuaternionArray,light,img)),f}function l(t){function e(t,e,r){this.uid="uid"+c++,l[this.uid]=this,this.index=r,this.enterArea(t,e)}function r(t,e){return t=Math.floor(t/s),e=Math.floor(e/s),t+"_"+e}function n(){var t=64,e=i.getCamera(),r=e.position.x,n=e.position.y;return d.x=Math.round(r/t),d.y=Math.round(n/t)+6,d}var a=[],s=50,l={},f=function(t){switch(t.type){case"face":return u(t);case"cube":return h(t)}};t.spriteFunction&&(f=t.spriteFunction);var c=0;e.prototype.leaveArea=function(){var t=r(this.x,this.y),e=a[t];if(e){var i=Math.floor(this.x)+"_"+Math.floor(this.y);e[i]&&delete e[i][this.uid]}},e.prototype.enterArea=function(t,e){this.x=t,this.y=e;var i=r(this.x,this.y),n=a[i]||(a[i]={}),o=Math.floor(this.x)+"_"+Math.floor(this.y);n[o]=n[o]||(n[o]={}),n[o][this.uid]=this},e.prototype.move=function(t,e){this.leaveArea(),this.enterArea(t,e)};var d={x:0,y:0},p=new o(t,f,function(t){for(var e=n(),r=Math.floor(e.x/s),i=Math.floor(e.y/s),o=1,u=i-o;u<=i+o;u++)for(var h=r-o;h<=r+o;h++){var l=a[h+"_"+u];if(l)for(var f in l){var c=l[f];for(var d in c){var p=this.getSprite(c[d]);Array.isArray(p)?p.forEach(t):t(p)}}}});return p.create=function(t,r,i){return new e(t,r,i)},p.get=function(t,e){var i=r(t,e),n=a[i],o=Math.floor(t)+"_"+Math.floor(e);return n?n[o]:null},p.find=function(t){return l[t]},p}o.prototype.pos=null,o.prototype.size=null,o.prototype.getSprite=n,o.prototype.forEach=n,o.prototype.options=null,o.prototype.getSprite=n,o.prototype.isCollection=!0;var f=[];return o.createSpriteCollection=l,t.onDestroy(s),o}),define("mouse",["utils"],function(t){"use strict";function e(t){if(void 0===t.target.attributes.tap){var e=t.changedTouches;if(e)for(var r=0;r<e.length;r++){var i=e[r];f[i.identifier]=i.pageX,c[i.identifier]=i.pageY}else h.x=t.pageX,h.y=t.pageY;d=!0;for(var r=0;r<l.length;r++)l[r](null,null,!0,t.pageX,t.pageY)}t.preventDefault()}function r(t){var e=!1;if(t.changedTouches){for(var r=0;r<t.changedTouches.length;r++)delete f[touch.identifier],delete c[touch.identifier];for(var r in f)e=!0}for(var r=0;r<l.length;r++)l[r](null,null,e,t.pageX,t.pageY);d=!1,t.preventDefault()}function i(t){t=t||event;var e=t.changedTouches;if(e){if(d){for(var r=0,i=0,n=0;n<e.length;n++){var o=e[n];r+=o.pageX-f[o.identifier],i+=o.pageY-c[o.identifier],f[o.identifier]=o.pageX,c[o.identifier]=o.pageY}for(var n=0;n<l.length;n++)l[n](r,i,!0,t.pageX,t.pageY)}}else{var a="buttons"in t&&1===t.buttons||1===(t.which||t.button);if(a&&d){var s=t.pageX,u=t.pageY,r=s-h.x,i=u-h.y;h.x=s,h.y=u;for(var n=0;n<l.length;n++)l[n](r,i,!0,t.pageX,t.pageY)}else{d=!1;for(var n=0;n<l.length;n++)l[n](r,i,!1,t.pageX,t.pageY)}}t.preventDefault()}function n(t){a(),o(),l.push(t)}function o(){document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),document.addEventListener("mouseup",r),document.addEventListener("touchend",r),document.addEventListener("touchcancel",r),document.addEventListener("mousemove",i),document.addEventListener("touchmove",i)}function a(){document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e),document.removeEventListener("mouseup",r),document.removeEventListener("touchend",r),document.removeEventListener("touchcancel",r),document.removeEventListener("mousemove",i),document.removeEventListener("touchmove",i)}function s(){l=[],a()}function u(){}var h={x:0,y:0},l=[],f={},c={},d=!1;
return u.setOnTouch=n,t.onDestroy(s),u}),define("dobuki",["utils","loop","gifHandler","camera","objectpool","spriteobject","packer","spritesheet","spriterenderer","collection","mouse","loader"],function(t,e,r,i,n,o,a,s,u,h,l,f){return{Utils:t,Loop:e,GifHandler:r,Camera:i,ObjectPool:n,SpriteObject:o,SpriteSheet:s,SpriteRenderer:u,Collection:h,Mouse:l,Loader:f}}),requirejs.config({paths:{threejs:"https://cdnjs.cloudflare.com/ajax/libs/three.js/85/three.min",dobuki:"dobuki",jsgif:"jsgif/gif"},urlArgs:"bust="+Date.now()}),require(["dobuki"],function(t){}),define("main",function(){});